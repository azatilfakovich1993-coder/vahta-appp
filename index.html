<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Good_–í–∞—Ö—Ç–∞</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;700;900&family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --c1:#0f172a;--c2:#1e293b;
  --accent:#f97316;--accent2:#fb923c;
  --green:#16a34a;--green2:#22c55e;
  --red:#ef4444;--blue:#2563eb;--blue2:#3b82f6;
  --gold:#f59e0b;--purple:#7c3aed;
  --bg:#f8fafc;--card:#ffffff;
  --text:#0f172a;--text2:#475569;--text3:#94a3b8;
  --border:#e2e8f0;
  --shadow:0 1px 3px rgba(0,0,0,0.06),0 4px 16px rgba(0,0,0,0.06);
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{font-family:'Manrope',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;overflow-x:hidden;}
.hidden{display:none!important;}

/* –¢–û–ü–ë–ê–† */
.topbar{background:linear-gradient(135deg,var(--c1),var(--c2));padding:14px 16px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:200;}
.topbar-left{display:flex;align-items:center;gap:10px;}
.topbar-back{background:rgba(255,255,255,0.12);border:none;color:white;width:36px;height:36px;border-radius:50%;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;}
.topbar-title{font-family:'Unbounded',sans-serif;font-size:15px;font-weight:900;color:white;letter-spacing:-0.5px;}
.topbar-title span{color:var(--accent);}
.topbar-subtitle{font-size:11px;color:rgba(255,255,255,0.55);margin-top:1px;}
.topbar-actions{display:flex;gap:8px;}
.topbar-btn{background:rgba(255,255,255,0.12);border:1px solid rgba(255,255,255,0.15);color:white;padding:7px 12px;border-radius:20px;font-size:13px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:5px;position:relative;}
.topbar-btn .cnt{background:var(--red);color:white;font-size:10px;padding:1px 5px;border-radius:8px;font-weight:700;}

/* –ì–õ–ê–í–ù–ê–Ø */
.welcome-wrap{min-height:100vh;background:var(--bg);}
.welcome-hero{background:white;padding:32px 20px 24px;text-align:center;border-bottom:1px solid var(--border);}
.welcome-logo{font-family:'Unbounded',sans-serif;font-size:26px;font-weight:900;color:var(--c1);margin-bottom:6px;}
.welcome-logo span{color:var(--accent);}
.welcome-tagline{font-size:14px;color:var(--text2);margin-bottom:0;}
.welcome-notifs{padding:16px;}
.notif-card{background:white;border-radius:12px;padding:14px 16px;margin-bottom:10px;box-shadow:var(--shadow);display:flex;align-items:center;gap:12px;border-left:4px solid var(--accent);}
.notif-card-ico{font-size:24px;}
.notif-card-text{flex:1;}
.notif-card-title{font-weight:700;font-size:14px;}
.notif-card-sub{font-size:12px;color:var(--text2);}
.notif-cnt{background:var(--red);color:white;font-size:12px;padding:2px 8px;border-radius:10px;font-weight:700;}
.role-section{padding:0 16px 24px;}
.role-section-title{font-size:12px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:12px;}
.role-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.role-card{background:white;border-radius:16px;padding:20px 14px;text-align:center;cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;box-shadow:var(--shadow);}
.role-card:active{transform:scale(0.97);}
.role-card-ico{font-size:40px;margin-bottom:10px;}
.role-card-title{font-family:'Unbounded',sans-serif;font-size:12px;font-weight:700;margin-bottom:5px;}
.role-card-desc{font-size:11px;color:var(--text2);line-height:1.4;}
.role-card-badge{background:var(--red);color:white;font-size:10px;padding:2px 7px;border-radius:10px;font-weight:700;display:inline-block;margin-top:6px;}

/* –í–ö–õ–ê–î–ö–ò */
.tabs-wrap{background:white;border-bottom:1px solid var(--border);display:flex;overflow-x:auto;position:sticky;top:58px;z-index:100;}
.tabs-wrap::-webkit-scrollbar{display:none;}
.tab-btn{flex:1;min-width:75px;padding:13px 6px;background:none;border:none;color:var(--text3);font-size:12px;font-weight:700;cursor:pointer;border-bottom:3px solid transparent;white-space:nowrap;font-family:'Manrope',sans-serif;position:relative;}
.tab-btn.active{color:var(--accent);border-bottom-color:var(--accent);}
.tab-btn .tbadge{position:absolute;top:8px;right:6px;background:var(--red);color:white;font-size:9px;padding:1px 4px;border-radius:6px;font-weight:700;}

/* –ü–û–ò–°–ö */
.search-bar{padding:12px 16px;background:white;border-bottom:1px solid var(--border);}
.search-input-wrap{position:relative;margin-bottom:10px;}
.search-input-wrap input{width:100%;padding:11px 42px 11px 42px;border:2px solid var(--border);border-radius:12px;font-size:14px;font-family:'Manrope',sans-serif;transition:border-color 0.2s;background:white;}
.search-input-wrap input:focus{outline:none;border-color:var(--accent);}
.s-ico{position:absolute;left:14px;top:50%;transform:translateY(-50%);font-size:17px;color:var(--text3);}
.filter-toggle-btn{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:var(--accent);border:none;color:white;width:28px;height:28px;border-radius:8px;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;}
.filter-panel{background:var(--bg);border-radius:12px;padding:12px;margin-top:8px;}
.filter-panel-title{font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:0.6px;margin-bottom:8px;}
.filters-row{display:flex;gap:6px;overflow-x:auto;padding-bottom:4px;flex-wrap:wrap;}
.filters-row::-webkit-scrollbar{display:none;}
.fchip{padding:6px 12px;border-radius:20px;background:white;border:2px solid var(--border);font-size:12px;font-weight:600;white-space:nowrap;cursor:pointer;color:var(--text2);}
.fchip.on{background:var(--accent);color:white;border-color:var(--accent);}
.sort-row{display:flex;gap:6px;margin-top:8px;overflow-x:auto;}
.sort-row::-webkit-scrollbar{display:none;}
.sort-chip{padding:6px 12px;border-radius:20px;background:white;border:2px solid var(--border);font-size:12px;font-weight:600;white-space:nowrap;cursor:pointer;color:var(--text2);}
.sort-chip.on{background:var(--c1);color:white;border-color:var(--c1);}

/* –ö–ê–†–¢–û–ß–ö–ò */
.list-wrap{padding:12px 16px 90px;}
.vcard{background:white;border-radius:14px;margin-bottom:12px;overflow:hidden;box-shadow:var(--shadow);cursor:pointer;transition:transform 0.15s;}
.vcard:active{transform:scale(0.99);}
.vcard-top{padding:14px 14px 10px;}
.vcard-head{display:flex;justify-content:space-between;align-items:start;margin-bottom:6px;}
.vcard-title{font-family:'Unbounded',sans-serif;font-size:13px;font-weight:700;color:var(--text);line-height:1.3;flex:1;padding-right:8px;}
.vcard-fav{background:none;border:none;font-size:22px;cursor:pointer;padding:2px;transition:transform 0.2s;flex-shrink:0;}
.vcard-fav:active{transform:scale(1.3);}
.vcard-company{font-size:13px;color:var(--text2);margin-bottom:6px;display:flex;align-items:center;gap:6px;flex-wrap:wrap;font-weight:700;}
.vcard-rating{color:var(--gold);font-weight:700;font-size:12px;}
.vcard-salary{font-size:19px;font-weight:700;color:var(--green);margin-bottom:8px;}
.vcard-tags{display:flex;flex-wrap:wrap;gap:5px;margin-bottom:6px;}
.vtag{background:var(--bg);padding:4px 9px;border-radius:7px;font-size:11px;color:var(--text2);font-weight:600;}
.vtag-blue{background:#dbeafe;color:#1d4ed8;}
.vtag-green{background:#dcfce7;color:#15803d;}
.vtag-orange{background:#fff7ed;color:#c2410c;}
.vtag-red{background:#fee2e2;color:#991b1b;font-weight:700;}
.vtag-purple{background:#f3e8ff;color:#7c3aed;}
.vcard-desc{font-size:12px;color:var(--text2);padding:8px 14px;border-top:1px solid var(--bg);display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;line-height:1.5;}
.vcard-footer{padding:9px 14px;background:var(--bg);display:flex;justify-content:space-between;align-items:center;}
.vcard-date{font-size:11px;color:var(--text3);}
.vcard-views{font-size:11px;color:var(--text3);}

/* –ö–ù–û–ü–ö–ò */
.btn{display:flex;align-items:center;justify-content:center;gap:8px;padding:13px 20px;border-radius:12px;font-size:14px;font-weight:700;cursor:pointer;border:none;font-family:'Manrope',sans-serif;width:100%;transition:all 0.15s;}
.btn:active{transform:scale(0.98);}
.btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:white;}
.btn-green{background:linear-gradient(135deg,var(--green),var(--green2));color:white;}
.btn-blue{background:linear-gradient(135deg,var(--blue),var(--blue2));color:white;}
.btn-outline{background:transparent;border:2px solid var(--border);color:var(--text);}
.btn-danger{background:linear-gradient(135deg,#ef4444,#dc2626);color:white;}
.btn-warn{background:linear-gradient(135deg,#f59e0b,#d97706);color:white;}
.btn-dark{background:linear-gradient(135deg,var(--c1),var(--c2));color:white;}
.btn-sm{padding:9px 14px;font-size:12px;}
.btn-row{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px;}
.btn-row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;margin-top:10px;}

/* FAB */
.fab{position:fixed;bottom:80px;right:16px;width:54px;height:54px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));color:white;border:none;font-size:28px;box-shadow:0 4px 16px rgba(249,115,22,0.4);cursor:pointer;z-index:50;display:flex;align-items:center;justify-content:center;}

/* –ù–ò–ñ–ù–Ø–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø */
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:white;border-top:1px solid var(--border);display:flex;z-index:150;padding-bottom:env(safe-area-inset-bottom);}
.bnav-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;padding:9px 6px;background:none;border:none;color:var(--text3);font-size:10px;font-weight:600;cursor:pointer;font-family:'Manrope',sans-serif;position:relative;}
.bnav-item.active{color:var(--accent);}
.bnav-ico{font-size:22px;}
.bnav-cnt{position:absolute;top:5px;right:calc(50% - 20px);background:var(--red);color:white;font-size:9px;padding:1px 5px;border-radius:8px;font-weight:700;}

/* –§–û–†–ú–´ */
.form-wrap{padding:16px;}
.fg{margin-bottom:16px;}
.fg label{display:block;font-size:13px;font-weight:700;margin-bottom:6px;color:var(--text);}
.req{color:var(--red);margin-left:3px;}
.fg input,.fg select,.fg textarea{width:100%;padding:11px 13px;border:2px solid var(--border);border-radius:10px;font-size:14px;font-family:'Manrope',sans-serif;color:var(--text);transition:border-color 0.2s;background:white;}
.fg input:focus,.fg select:focus,.fg textarea:focus{outline:none;border-color:var(--accent);}
.fg textarea{min-height:85px;resize:vertical;}
.fg-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.toggle-row{display:flex;align-items:center;justify-content:space-between;padding:13px;background:var(--bg);border-radius:10px;margin-bottom:14px;}
.toggle-label{font-size:13px;font-weight:600;flex:1;padding-right:10px;}
.toggle{width:46px;height:24px;background:var(--border);border-radius:12px;border:none;cursor:pointer;position:relative;transition:background 0.2s;flex-shrink:0;}
.toggle::after{content:'';position:absolute;width:18px;height:18px;background:white;border-radius:50%;top:3px;left:3px;transition:transform 0.2s;box-shadow:0 1px 4px rgba(0,0,0,0.2);}
.toggle.on{background:var(--green2);}
.toggle.on::after{transform:translateX(22px);}

/* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û */
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:500;display:flex;align-items:flex-end;}
.modal-box{background:white;border-radius:22px 22px 0 0;width:100%;max-height:92vh;overflow-y:auto;padding:18px 18px 40px;}
.modal-handle{width:38px;height:4px;background:var(--border);border-radius:2px;margin:0 auto 18px;}
.modal-title{font-family:'Unbounded',sans-serif;font-size:17px;font-weight:700;margin-bottom:4px;}
.modal-sub{font-size:13px;color:var(--text2);margin-bottom:18px;}

/* –î–ï–¢–ê–õ–ò */
.detail-section{margin-bottom:18px;}
.detail-section-title{font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:10px;}
.detail-row{display:flex;align-items:flex-start;gap:10px;padding:11px;background:var(--bg);border-radius:10px;margin-bottom:7px;}
.detail-ico{font-size:20px;width:28px;text-align:center;flex-shrink:0;}
.detail-info{flex:1;min-width:0;}
.detail-label{font-size:11px;color:var(--text3);margin-bottom:1px;}
.detail-value{font-size:14px;font-weight:600;color:var(--text);word-break:break-word;}

/* –ü–£–°–¢–´–ï –°–û–°–¢–û–Ø–ù–ò–Ø */
.empty{text-align:center;padding:48px 20px;}
.empty-ico{font-size:52px;margin-bottom:12px;opacity:0.35;}
.empty-title{font-family:'Unbounded',sans-serif;font-size:15px;font-weight:700;margin-bottom:7px;}
.empty-text{font-size:13px;color:var(--text2);margin-bottom:22px;line-height:1.5;}

/* –ó–í–Å–ó–î–´ */
.star{font-size:24px;cursor:pointer;transition:transform 0.1s;}
.star:active{transform:scale(1.2);}
.stars-row{display:flex;gap:4px;margin-bottom:10px;}

/* –¢–û–°–¢ */
.toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:var(--c1);color:white;padding:11px 20px;border-radius:12px;font-size:13px;font-weight:600;z-index:9999;box-shadow:0 4px 14px rgba(0,0,0,0.25);white-space:nowrap;animation:toastIn 0.25s ease;}
@keyframes toastIn{from{transform:translate(-50%,-16px);opacity:0;}to{transform:translate(-50%,0);opacity:1;}}

/* –£–í–ï–î–û–ú–õ–ï–ù–ò–ï */
.notif-banner{position:fixed;top:0;left:0;right:0;background:linear-gradient(135deg,var(--c1),#1a2744);color:white;padding:14px 16px;z-index:8000;transform:translateY(-100%);transition:transform 0.3s;border-bottom:2px solid var(--accent);}
.notif-banner.show{transform:translateY(0);}

/* –ü–†–û–§–ò–õ–¨ */
.profile-hero{background:linear-gradient(135deg,var(--c1),var(--c2));padding:26px 20px;text-align:center;color:white;}
.profile-avatar{width:70px;height:70px;border-radius:50%;object-fit:cover;border:3px solid var(--accent);margin:0 auto;}
.avatar-placeholder{width:70px;height:70px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:28px;margin:0 auto;}
.profile-name{font-family:'Unbounded',sans-serif;font-size:15px;font-weight:700;margin-top:10px;margin-bottom:3px;}
.profile-role{font-size:12px;opacity:0.65;}

/* –ó–ê–ì–†–£–ó–ö–ê */
.loading{text-align:center;padding:36px;color:var(--text3);}
.spin{width:30px;height:30px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto 10px;}
@keyframes spin{to{transform:rotate(360deg);}}

/* –§–û–¢–û */
.photo-upload-area{border:2px dashed var(--border);border-radius:12px;padding:20px;text-align:center;cursor:pointer;margin-bottom:16px;transition:border-color 0.2s;}
.photo-upload-area:hover{border-color:var(--accent);}

/* –ê–î–ú–ò–ù */
.admin-section{background:linear-gradient(135deg,#7c3aed,#6d28d9);border-radius:14px;padding:16px;margin-bottom:12px;color:white;}
.admin-section-title{font-family:'Unbounded',sans-serif;font-size:13px;font-weight:700;margin-bottom:12px;}
</style>
</head>
<body>
<div id="app">

<!-- –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù -->
<div id="welcomeScreen" class="welcome-wrap">
  <div class="welcome-hero">
    <div class="welcome-logo">Good_<span>–í–∞—Ö—Ç–∞</span></div>
    <div class="welcome-tagline">–†–∞–±–æ—Ç–∞ –º–µ—á—Ç—ã ‚Äî –Ω–∞ –≤–∞—Ö—Ç–µ!</div>
  </div>
  <div class="welcome-notifs" id="welcomeNotifs"></div>
  <div class="role-section">
    <div class="role-section-title">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</div>
    <div class="role-grid">
      <div class="role-card" onclick="goRole('employer')">
        <div class="role-card-ico">üëî</div>
        <div class="role-card-title">–†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å</div>
        <div class="role-card-desc">–ù–∞–π—Ç–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –¥–ª—è –æ–±—ä–µ–∫—Ç–∞</div>
        <div class="role-card-badge hidden" id="empWelcomeBadge">0 –Ω–æ–≤—ã—Ö</div>
      </div>
      <div class="role-card" onclick="goRole('worker')">
        <div class="role-card-ico">üë∑</div>
        <div class="role-card-title">–°–æ–∏—Å–∫–∞—Ç–µ–ª—å</div>
        <div class="role-card-desc">–ù–∞–π—Ç–∏ –≤–∞—Ö—Ç–æ–≤—É—é —Ä–∞–±–æ—Ç—É</div>
        <div class="role-card-badge hidden" id="wrkWelcomeBadge">0 –Ω–æ–≤—ã—Ö</div>
      </div>
    </div>
  </div>
</div>

<!-- –†–ê–ë–û–¢–û–î–ê–¢–ï–õ–¨ -->
<div id="employerScreen" class="hidden">
  <div class="topbar">
    <div class="topbar-left">
      <button class="topbar-back" onclick="goWelcome()">‚Üê</button>
      <div>
        <div class="topbar-title">Good_<span>–í–∞—Ö—Ç–∞</span></div>
        <div class="topbar-subtitle" id="empTabLabel">–ú–æ–∏ –≤–∞–∫–∞–Ω—Å–∏–∏</div>
      </div>
    </div>
    <div class="topbar-actions">
      <button class="topbar-btn" onclick="openFavs()">‚ù§Ô∏è <span class="cnt" id="empFavCnt" style="display:none">0</span></button>
    </div>
  </div>
  <div class="tabs-wrap">
    <button class="tab-btn active" onclick="empTab('vacancies',this)">–í–∞–∫–∞–Ω—Å–∏–∏</button>
    <button class="tab-btn" onclick="empTab('candidates',this)">–ö–∞–Ω–¥–∏–¥–∞—Ç—ã</button>
    <button class="tab-btn" onclick="empTab('incoming',this)">–í—Ö–æ–¥—è—â–∏–µ<span class="tbadge hidden" id="incomingBadge">0</span></button>
    <button class="tab-btn" onclick="empTab('profile',this)">–ü—Ä–æ—Ñ–∏–ª—å</button>
  </div>
  <div id="empVacanciesTab"><div class="list-wrap" id="empVacList"></div></div>
  <div id="empCandidatesTab" class="hidden">
    <div class="search-bar">
      <div class="search-input-wrap">
        <span class="s-ico">üîç</span>
        <input type="text" placeholder="–ü–æ–∏—Å–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤..." id="candSearch" oninput="applyFilters('cand')">
        <button class="filter-toggle-btn" onclick="toggleFilterPanel('cand')">‚öô</button>
      </div>
      <div id="candFilterPanel" class="filter-panel hidden">
        <div class="filter-panel-title">–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</div>
        <div class="filters-row" id="candSpecFilters"></div>
        <div class="filter-panel-title" style="margin-top:10px">–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã</div>
        <div class="filters-row" id="candExpFilters">
          <div class="fchip" onclick="toggleFilter(this,'candExp','–ë–µ–∑ –æ–ø—ã—Ç–∞')">–ë–µ–∑ –æ–ø—ã—Ç–∞</div>
          <div class="fchip" onclick="toggleFilter(this,'candExp','–î–æ 1 –≥–æ–¥–∞')">–î–æ 1 –≥–æ–¥–∞</div>
          <div class="fchip" onclick="toggleFilter(this,'candExp','1‚Äì3 –≥–æ–¥–∞')">1‚Äì3 –≥–æ–¥–∞</div>
          <div class="fchip" onclick="toggleFilter(this,'candExp','3‚Äì5 –ª–µ—Ç')">3‚Äì5 –ª–µ—Ç</div>
          <div class="fchip" onclick="toggleFilter(this,'candExp','5+ –ª–µ—Ç')">5+ –ª–µ—Ç</div>
        </div>
        <div class="filter-panel-title" style="margin-top:10px">–†–µ–≥–∏–æ–Ω</div>
        <div class="filters-row" id="candRegFilters"></div>
      </div>
    </div>
    <div class="list-wrap" id="empCandList"></div>
  </div>
  <div id="empIncomingTab" class="hidden"><div class="list-wrap" id="empIncomingList"></div></div>
  <div id="empProfileTab" class="hidden"><div id="empProfileView"></div></div>
  <button class="fab" onclick="showCreateVacancy()">+</button>
  <div class="bottom-nav">
    <button class="bnav-item active" id="empBnav0" onclick="empTab('vacancies',this);setActiveBnav('empBnav0','emp')"><span class="bnav-ico">üíº</span><span>–í–∞–∫–∞–Ω—Å–∏–∏</span></button>
    <button class="bnav-item" id="empBnav1" onclick="openFavs()"><span class="bnav-ico">‚ù§Ô∏è</span><span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span><span class="bnav-cnt" id="empFavBadge" style="display:none">0</span></button>
    <button class="bnav-item" id="empBnav2" onclick="empTab('profile',this);setActiveBnav('empBnav2','emp')"><span class="bnav-ico">üë§</span><span>–ü—Ä–æ—Ñ–∏–ª—å</span></button>
  </div>
</div>

<!-- –°–û–ò–°–ö–ê–¢–ï–õ–¨ -->
<div id="workerScreen" class="hidden">
  <div class="topbar">
    <div class="topbar-left">
      <button class="topbar-back" onclick="goWelcome()">‚Üê</button>
      <div>
        <div class="topbar-title">Good_<span>–í–∞—Ö—Ç–∞</span></div>
        <div class="topbar-subtitle" id="wrkTabLabel">–í–∞–∫–∞–Ω—Å–∏–∏</div>
      </div>
    </div>
    <div class="topbar-actions">
      <button class="topbar-btn" onclick="openFavs()">‚ù§Ô∏è <span class="cnt" id="wrkFavCnt" style="display:none">0</span></button>
    </div>
  </div>
  <div class="tabs-wrap">
    <button class="tab-btn active" onclick="wrkTab('vacancies',this)">–í–∞–∫–∞–Ω—Å–∏–∏</button>
    <button class="tab-btn" onclick="wrkTab('profile',this)">–ü—Ä–æ—Ñ–∏–ª—å</button>
  </div>
  <div id="wrkVacanciesTab">
    <div class="search-bar">
      <div class="search-input-wrap">
        <span class="s-ico">üîç</span>
        <input type="text" placeholder="–ü–æ–∏—Å–∫ –≤–∞–∫–∞–Ω—Å–∏–π..." id="vacSearch" oninput="applyFilters('vac')">
        <button class="filter-toggle-btn" onclick="toggleFilterPanel('vac')">‚öô</button>
      </div>
      <div id="vacFilterPanel" class="filter-panel hidden">
        <div class="filter-panel-title">–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</div>
        <div class="filters-row" id="vacSpecFilters"></div>
        <div class="filter-panel-title" style="margin-top:10px">–ó–∞—Ä–ø–ª–∞—Ç–∞</div>
        <div class="filters-row" id="vacSalFilters">
          <div class="fchip" onclick="toggleFilter(this,'vacSal','50')">–æ—Ç 50 000 ‚ÇΩ</div>
          <div class="fchip" onclick="toggleFilter(this,'vacSal','80')">–æ—Ç 80 000 ‚ÇΩ</div>
          <div class="fchip" onclick="toggleFilter(this,'vacSal','100')">–æ—Ç 100 000 ‚ÇΩ</div>
          <div class="fchip" onclick="toggleFilter(this,'vacSal','150')">–æ—Ç 150 000 ‚ÇΩ</div>
        </div>
        <div class="filter-panel-title" style="margin-top:10px">–†–µ–≥–∏–æ–Ω</div>
        <div class="filters-row" id="vacRegFilters"></div>
        <div class="filter-panel-title" style="margin-top:10px">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</div>
        <div class="sort-row">
          <div class="sort-chip on" onclick="setSort(this,'date')">–ü–æ –¥–∞—Ç–µ</div>
          <div class="sort-chip" onclick="setSort(this,'salary')">–ü–æ –∑–∞—Ä–ø–ª–∞—Ç–µ</div>
          <div class="sort-chip" onclick="setSort(this,'rating')">–ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É</div>
        </div>
      </div>
    </div>
    <div class="list-wrap" id="wrkVacList"></div>
  </div>
  <div id="wrkProfileTab" class="hidden"><div id="wrkProfileView"></div></div>
  <div class="bottom-nav">
    <button class="bnav-item active" id="wrkBnav0" onclick="wrkTab('vacancies',this);setActiveBnav('wrkBnav0','wrk')"><span class="bnav-ico">üíº</span><span>–í–∞–∫–∞–Ω—Å–∏–∏</span></button>
    <button class="bnav-item" id="wrkBnav1" onclick="openFavs()"><span class="bnav-ico">‚ù§Ô∏è</span><span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span><span class="bnav-cnt" id="wrkFavBadge" style="display:none">0</span></button>
    <button class="bnav-item" id="wrkBnav2" onclick="wrkTab('profile',this);setActiveBnav('wrkBnav2','wrk')"><span class="bnav-ico">üë§</span><span>–ü—Ä–æ—Ñ–∏–ª—å</span></button>
  </div>
</div>

<!-- –£–í–ï–î–û–ú–õ–ï–ù–ò–ï -->
<div class="notif-banner" id="notifBanner">
  <div style="font-weight:700;font-size:14px;margin-bottom:3px" id="notifTitle"></div>
  <div style="font-size:12px;opacity:0.8" id="notifText"></div>
</div>

</div>
<script>
const tg = window.Telegram.WebApp;
tg.ready(); tg.expand();

const BOT_TOKEN = '8406340321:AAE6pjKfFflkF4V2peKKWZ6-vPljslWZjlA';
const SB_URL = 'https://zutiselchauekvvoirgw.supabase.co';
const SB_KEY = 'sb_publishable__IqzaQ_ICdfryInqnfmRZg_KK_aFton';
const ADMIN_ID = '805705211';

const UID = String(tg.initDataUnsafe?.user?.id || 'demo_' + Math.random().toString(36).slice(2,8));
const UNAME = tg.initDataUnsafe?.user?.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
const TG_USERNAME = tg.initDataUnsafe?.user?.username || null;
const IS_ADMIN = UID === ADMIN_ID;

let ROLE = null;
let allVacsCache = [];
let allCandsCache = [];
let currentSort = 'date';
let activeFilters = { vacSpec:[], vacSal:[], vacReg:[], candSpec:[], candExp:[], candReg:[] };

const SPECS = ['–°–≤–∞—Ä—â–∏–∫','–ú–æ–Ω—Ç–∞–∂–Ω–∏–∫','–≠–ª–µ–∫—Ç—Ä–∏–∫','–°–ª–µ—Å–∞—Ä—å','–¢–æ–∫–∞—Ä—å','–§—Ä–µ–∑–µ—Ä–æ–≤—â–∏–∫','–ú–∞–ª—è—Ä','–®—Ç—É–∫–∞—Ç—É—Ä','–ö–∞–º–µ–Ω—â–∏–∫','–ë–µ—Ç–æ–Ω—â–∏–∫','–ê—Ä–º–∞—Ç—É—Ä—â–∏–∫','–ö—Ä–∞–Ω–æ–≤—â–∏–∫','–°—Ç—Ä–æ–ø–∞–ª—å—â–∏–∫','–û–ø–µ—Ä–∞—Ç–æ—Ä —Å—Ç–∞–Ω–∫–æ–≤'];
const SCHEDS = ['15/15','30/30','45/15','45/45','60/30','2/2','3/3','–î—Ä—É–≥–æ–π –≥—Ä–∞—Ñ–∏–∫'];
const REGIONS = ['–ú–æ—Å–∫–≤–∞','–ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª.','–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥','–¢—é–º–µ–Ω—Å–∫–∞—è –æ–±–ª.','–•–ú–ê–û','–Ø–ù–ê–û','–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π –∫—Ä–∞–π','–ò—Ä–∫—É—Ç—Å–∫–∞—è –æ–±–ª.','–Ø–∫—É—Ç–∏—è','–¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω','–ë–∞—à–∫–æ—Ä—Ç–æ—Å—Ç–∞–Ω','–°–≤–µ—Ä–¥–ª–æ–≤—Å–∫–∞—è –æ–±–ª.','–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª.','–ü–µ—Ä–º—Å–∫–∏–π –∫—Ä–∞–π','–î—Ä—É–≥–æ–π —Ä–µ–≥–∏–æ–Ω'];

// ‚îÄ‚îÄ SUPABASE ‚îÄ‚îÄ
async function sbGet(table, id) {
  try {
    const r = await fetch(`${SB_URL}/rest/v1/${table}?id=eq.${encodeURIComponent(id)}&select=data`, { headers:{'apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY} });
    const d = await r.json(); return d&&d[0]?d[0].data:null;
  } catch(e){return null;}
}
async function sbSet(table, id, data) {
  try {
    await fetch(`${SB_URL}/rest/v1/${table}`, { method:'POST', headers:{'apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY,'Content-Type':'application/json','Prefer':'resolution=merge-duplicates'}, body:JSON.stringify({id,data}) });
  } catch(e){}
}
async function sbDelete(table, id) {
  try { await fetch(`${SB_URL}/rest/v1/${table}?id=eq.${encodeURIComponent(id)}`, { method:'DELETE', headers:{'apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY} }); } catch(e){}
}
async function sbList(table, prefix) {
  try {
    const r = await fetch(`${SB_URL}/rest/v1/${table}?id=like.${encodeURIComponent(prefix+'%')}&select=data&order=id.desc`, { headers:{'apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY} });
    const d = await r.json(); return Array.isArray(d)?d.map(x=>x.data).filter(Boolean):[];
  } catch(e){return[];}
}

// ‚îÄ‚îÄ –ò–ó–ë–†–ê–ù–ù–û–ï (Supabase) ‚îÄ‚îÄ
async function loadFavs() {
  const f = await sbGet('favorites','favs_'+UID);
  return f || {vacancies:[],candidates:[]};
}
async function saveFavs(favs) {
  await sbSet('favorites','favs_'+UID,favs);
  updateFavUI(favs);
}
function updateFavUI(favs) {
  const cnt = favs.vacancies.length + favs.candidates.length;
  ['empFavCnt','wrkFavCnt'].forEach(id=>{const el=document.getElementById(id);if(el){el.textContent=cnt;el.style.display=cnt>0?'inline':'none';}});
  ['empFavBadge','wrkFavBadge'].forEach(id=>{const el=document.getElementById(id);if(el){el.textContent=cnt;el.style.display=cnt>0?'inline':'none';}});
}
async function isFav(type, id) {
  const f = await loadFavs(); return (type==='v'?f.vacancies:f.candidates).includes(id);
}
async function toggleFav(type, id, e) {
  if(e) e.stopPropagation();
  const f = await loadFavs();
  const list = type==='v'?f.vacancies:f.candidates;
  const idx = list.indexOf(id);
  if(idx>-1){list.splice(idx,1);toast('–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');}
  else{list.push(id);toast('–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ ‚ù§Ô∏è');}
  await saveFavs(f);
  if(ROLE==='employer') loadEmpVacancies();
  else loadWrkVacancies();
}

// ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ
function toast(msg){document.querySelectorAll('.toast').forEach(t=>t.remove());const t=document.createElement('div');t.className='toast';t.textContent=msg;document.body.appendChild(t);setTimeout(()=>t.remove(),2800);}
function showNotif(title,text){document.getElementById('notifTitle').textContent=title;document.getElementById('notifText').textContent=text;const b=document.getElementById('notifBanner');b.classList.add('show');setTimeout(()=>b.classList.remove('show'),4000);}
function timeAgo(iso){const diff=Math.floor((new Date()-new Date(iso))/60000);if(diff<1)return'—Ç–æ–ª—å–∫–æ —á—Ç–æ';if(diff<60)return diff+'–º –Ω–∞–∑–∞–¥';if(diff<1440)return Math.floor(diff/60)+'—á –Ω–∞–∑–∞–¥';return Math.floor(diff/1440)+'–¥ –Ω–∞–∑–∞–¥';}
function yrs(n){n=parseInt(n);if(n===1)return'–≥–æ–¥';if(n>=2&&n<=4)return'–≥–æ–¥–∞';return'–ª–µ—Ç';}
function salStr(a,b){if(a&&b)return`${parseInt(a).toLocaleString()} ‚Äî ${parseInt(b).toLocaleString()} ‚ÇΩ`;if(a)return`–æ—Ç ${parseInt(a).toLocaleString()} ‚ÇΩ`;return'‚Äî';}
function starsSmall(r,c){if(!r||!c)return'';return`<span class="vcard-rating">‚òÖ ${parseFloat(r).toFixed(1)}</span><span style="font-size:11px;color:var(--text3)"> (${c})</span>`;}
function starsHtml(r,c){if(!r)return'';const full=Math.round(r);let s='';for(let i=1;i<=5;i++)s+=i<=full?'‚≠ê':'‚òÜ';return`<div style="display:flex;align-items:center;gap:6px;margin-bottom:8px">${s} <b style="color:var(--gold)">${parseFloat(r).toFixed(1)}</b><span style="font-size:12px;color:var(--text3)">(${c||0})</span></div>`;}
function isVerified(p){return p&&p.companyName&&p.inn&&p.address&&p.about;}
function expRange(y){const n=parseInt(y)||0;if(n===0)return'–ë–µ–∑ –æ–ø—ã—Ç–∞';if(n<1)return'–î–æ 1 –≥–æ–¥–∞';if(n<=3)return'1‚Äì3 –≥–æ–¥–∞';if(n<=5)return'3‚Äì5 –ª–µ—Ç';return'5+ –ª–µ—Ç';}
function setActiveBnav(id,prefix){document.querySelectorAll(`#${prefix==='emp'?'employerScreen':'workerScreen'} .bnav-item`).forEach(b=>b.classList.remove('active'));const el=document.getElementById(id);if(el)el.classList.add('active');}

// ‚îÄ‚îÄ –§–û–¢–û (—Å–∂–∞—Ç–∏–µ) ‚îÄ‚îÄ
function compressImage(file, maxSize=300) {
  return new Promise(resolve => {
    const reader = new FileReader();
    reader.onload = e => {
      const img = new Image();
      img.onload = () => {
        const canvas = document.createElement('canvas');
        let w=img.width, h=img.height;
        if(w>h){if(w>maxSize){h=h*maxSize/w;w=maxSize;}}else{if(h>maxSize){w=w*maxSize/h;h=maxSize;}}
        canvas.width=w; canvas.height=h;
        canvas.getContext('2d').drawImage(img,0,0,w,h);
        resolve(canvas.toDataURL('image/jpeg',0.7));
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(file);
  });
}
function previewPhoto(inputId, previewId, placeholderId){
  const input=document.getElementById(inputId);
  const file=input.files[0]; if(!file) return;
  const reader=new FileReader();
  reader.onload=e=>{const p=document.getElementById(previewId);p.src=e.target.result;p.style.display='block';document.getElementById(placeholderId).style.display='none';};
  reader.readAsDataURL(file);
}
async function getPhotoData(inputId){
  return new Promise(resolve=>{
    const input=document.getElementById(inputId);
    if(!input||!input.files[0]){resolve(null);return;}
    compressImage(input.files[0]).then(resolve);
  });
}

// ‚îÄ‚îÄ –§–ò–õ–¨–¢–†–´ ‚îÄ‚îÄ
function toggleFilterPanel(type){document.getElementById(type+'FilterPanel').classList.toggle('hidden');}
function toggleFilter(chip, key, val){
  chip.classList.toggle('on');
  const isOn = chip.classList.contains('on');
  if(!activeFilters[key]) activeFilters[key]=[];
  if(isOn){if(!activeFilters[key].includes(val))activeFilters[key].push(val);}
  else{activeFilters[key]=activeFilters[key].filter(v=>v!==val);}
  applyFilters(key.startsWith('vac')?'vac':'cand');
}
function setSort(chip, val){
  document.querySelectorAll('.sort-chip').forEach(c=>c.classList.remove('on'));
  chip.classList.add('on'); currentSort=val; applyFilters('vac');
}
function applyFilters(type){
  if(type==='vac'||type==='vacSearch'){
    const search=document.getElementById('vacSearch').value.toLowerCase();
    let res=[...allVacsCache];
    if(activeFilters.vacSpec?.length) res=res.filter(v=>activeFilters.vacSpec.includes(v.specialty));
    if(activeFilters.vacSal?.length){const minSal=Math.max(...activeFilters.vacSal.map(Number));res=res.filter(v=>parseInt(v.salFrom||0)>=minSal*1000);}
    if(activeFilters.vacReg?.length) res=res.filter(v=>activeFilters.vacReg.some(r=>v.region?.includes(r)));
    if(search) res=res.filter(v=>`${v.specialty} ${v.region} ${v.object} ${v.shortDesc||''} ${v.desc||''}`.toLowerCase().includes(search));
    if(currentSort==='salary') res.sort((a,b)=>parseInt(b.salFrom||0)-parseInt(a.salFrom||0));
    else if(currentSort==='date') res.sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt));
    renderVacs(res);
  } else {
    const search=document.getElementById('candSearch').value.toLowerCase();
    let res=[...allCandsCache];
    if(activeFilters.candSpec?.length) res=res.filter(c=>activeFilters.candSpec.includes(c.specialty));
    if(activeFilters.candExp?.length) res=res.filter(c=>activeFilters.candExp.includes(expRange(c.experience)));
    if(activeFilters.candReg?.length) res=res.filter(c=>activeFilters.candReg.some(r=>c.region?.includes(r)));
    if(search) res=res.filter(c=>`${c.name} ${c.specialty} ${c.about||''} ${c.region||''}`.toLowerCase().includes(search));
    renderCands(res);
  }
}

// ‚îÄ‚îÄ NAV ‚îÄ‚îÄ
function hideAll(){['welcomeScreen','employerScreen','workerScreen'].forEach(id=>document.getElementById(id).classList.add('hidden'));}
function goWelcome(){hideAll();document.getElementById('welcomeScreen').classList.remove('hidden');ROLE=null;loadWelcomeNotifs();}
async function goRole(role){
  ROLE=role;hideAll();
  const bl=await sbGet('blacklist','bl_'+UID);
  if(bl&&bl.banned){toast('–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');hideAll();document.getElementById('welcomeScreen').classList.remove('hidden');return;}
  if(role==='employer'){document.getElementById('employerScreen').classList.remove('hidden');loadEmpVacancies();loadIncomingCount();}
  else{document.getElementById('workerScreen').classList.remove('hidden');loadWrkVacancies();}
  loadFavs().then(f=>updateFavUI(f));
}

async function loadWelcomeNotifs(){
  const el=document.getElementById('welcomeNotifs'); el.innerHTML='';
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–∫–ª–∏–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è
  const allResp=await sbList('responses','resp_');
  const allVacs=await sbList('vacancies','vac_');
  const myVacIds=allVacs.filter(v=>v.eid===UID).map(v=>v.id);
  const myRespCnt=allResp.filter(r=>myVacIds.includes(r.vid)&&!r.read).length;
  if(myRespCnt>0){
    document.getElementById('empWelcomeBadge').textContent=myRespCnt+' –Ω–æ–≤—ã—Ö';
    document.getElementById('empWelcomeBadge').classList.remove('hidden');
    el.innerHTML+=`<div class="notif-card"><div class="notif-card-ico">üì¨</div><div class="notif-card-text"><div class="notif-card-title">–ù–æ–≤—ã–µ –æ—Ç–∫–ª–∏–∫–∏</div><div class="notif-card-sub">–£ –≤–∞—Å ${myRespCnt} –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –æ—Ç–∫–ª–∏–∫–æ–≤ –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏–∏</div></div><span class="notif-cnt">${myRespCnt}</span></div>`;
  }
  if(IS_ADMIN) el.innerHTML+=`<div class="notif-card" style="border-left-color:var(--purple)" onclick="goAdmin()"><div class="notif-card-ico">üõ°</div><div class="notif-card-text"><div class="notif-card-title">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</div><div class="notif-card-sub">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π</div></div></div>`;
}

function empTab(tab,btn){
  document.querySelectorAll('#employerScreen .tab-btn').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  ['empVacanciesTab','empCandidatesTab','empIncomingTab','empProfileTab'].forEach(id=>document.getElementById(id).classList.add('hidden'));
  const labels={vacancies:'–ú–æ–∏ –≤–∞–∫–∞–Ω—Å–∏–∏',candidates:'–ö–∞–Ω–¥–∏–¥–∞—Ç—ã',incoming:'–í—Ö–æ–¥—è—â–∏–µ –æ—Ç–∫–ª–∏–∫–∏',profile:'–ü—Ä–æ—Ñ–∏–ª—å –∫–æ–º–ø–∞–Ω–∏–∏'};
  document.getElementById('empTabLabel').textContent=labels[tab]||tab;
  if(tab==='vacancies'){document.getElementById('empVacanciesTab').classList.remove('hidden');loadEmpVacancies();}
  else if(tab==='candidates'){document.getElementById('empCandidatesTab').classList.remove('hidden');loadCandidates();}
  else if(tab==='incoming'){document.getElementById('empIncomingTab').classList.remove('hidden');loadIncoming();}
  else if(tab==='profile'){document.getElementById('empProfileTab').classList.remove('hidden');loadEmpProfile();}
}
function wrkTab(tab,btn){
  document.querySelectorAll('#workerScreen .tab-btn').forEach(b=>b.classList.remove('active'));
  if(btn)btn.classList.add('active');
  ['wrkVacanciesTab','wrkProfileTab'].forEach(id=>document.getElementById(id).classList.add('hidden'));
  document.getElementById('wrkTabLabel').textContent=tab==='vacancies'?'–í–∞–∫–∞–Ω—Å–∏–∏':'–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å';
  if(tab==='vacancies'){document.getElementById('wrkVacanciesTab').classList.remove('hidden');loadWrkVacancies();}
  else{document.getElementById('wrkProfileTab').classList.remove('hidden');loadWrkProfile();}
}

// ‚îÄ‚îÄ –°–ß–Å–¢–ß–ò–ö –í–•–û–î–Ø–©–ò–• ‚îÄ‚îÄ
async function loadIncomingCount(){
  const allResp=await sbList('responses','resp_');
  const allVacs=await sbList('vacancies','vac_');
  const myVacIds=allVacs.filter(v=>v.eid===UID).map(v=>v.id);
  const cnt=allResp.filter(r=>myVacIds.includes(r.vid)&&!r.read).length;
  const badge=document.getElementById('incomingBadge');
  if(badge){badge.textContent=cnt;badge.classList.toggle('hidden',cnt===0);}
}

// ‚îÄ‚îÄ –í–ê–ö–ê–ù–°–ò–ò –†–ê–ë–û–¢–û–î–ê–¢–ï–õ–Ø ‚îÄ‚îÄ
async function loadEmpVacancies(){
  const el=document.getElementById('empVacList');
  el.innerHTML='<div class="loading"><div class="spin"></div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
  const all=await sbList('vacancies','vac_');
  const mine=all.filter(v=>v.eid===UID);
  if(!mine.length){el.innerHTML=`<div class="empty"><div class="empty-ico">üìã</div><div class="empty-title">–ù–µ—Ç –≤–∞–∫–∞–Ω—Å–∏–π</div><div class="empty-text">–ù–∞–∂–º–∏—Ç–µ + —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –≤–∞–∫–∞–Ω—Å–∏—é</div></div>`;return;}
  const allResp=await sbList('responses','resp_');
  const favs=await loadFavs();
  const ratingMap={};
  for(const v of mine){if(!ratingMap[v.eid]){const r=await sbGet('ratings','rating_'+v.eid);if(r)ratingMap[v.eid]=r;}}
  el.innerHTML=mine.map(v=>{
    const rc=allResp.filter(r=>r.vid===v.id).length;
    const rat=ratingMap[v.eid];
    const sc={active:'status-active',paused:'status-paused',closed:'status-closed'}[v.status||'active'];
    const isFaved=favs.vacancies.includes(v.id);
    return`<div class="vcard" onclick="openVacancy('${v.id}','employer')">
      <div class="vcard-top">
        <div class="vcard-head"><div class="vcard-title">${v.specialty}${v.urgent?' <span class="vtag vtag-red">üî• –°—Ä–æ—á–Ω–æ</span>':''}</div><button class="vcard-fav" onclick="toggleFav('v','${v.id}',event)">${isFaved?'‚ù§Ô∏è':'ü§ç'}</button></div>
        <div class="vcard-company">${v.companyName||UNAME} ${v.verified?'‚úÖ':''} ${rat&&rat.cnt?starsSmall(rat.avg,rat.cnt):''}</div>
        <div class="vcard-salary">${salStr(v.salFrom,v.salTo)}</div>
        <div class="vcard-tags"><span class="vtag vtag-blue">üìç ${v.region}</span><span class="vtag">üìÖ ${v.schedule}</span>${v.workSchedule?`<span class="vtag vtag-orange">‚è∞ ${v.workSchedule}</span>`:''}<span class="${sc}">${{active:'–ê–∫—Ç–∏–≤–Ω–∞',paused:'–ü–∞—É–∑–∞',closed:'–ó–∞–∫—Ä—ã—Ç–∞'}[v.status||'active']}</span></div>
      </div>
      ${v.shortDesc?`<div class="vcard-desc">${v.shortDesc}</div>`:''}
      <div class="vcard-footer"><span class="vcard-date">${timeAgo(v.createdAt)}</span><span class="vcard-views">üë• ${rc} ¬∑ üëÅ ${v.views||0}</span></div>
    </div>`;
  }).join('');
}

// ‚îÄ‚îÄ –°–û–ó–î–ê–¢–¨/–†–ï–î–ê–ö–¢–ò–†–û–í–ê–¢–¨ –í–ê–ö–ê–ù–°–ò–Æ ‚îÄ‚îÄ
async function showCreateVacancy(editId){
  const profile=await sbGet('profiles','emp_'+UID);
  if(!profile||!profile.companyName){toast('–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å –∫–æ–º–ø–∞–Ω–∏–∏!');empTab('profile',document.querySelectorAll('#employerScreen .tab-btn')[3]);return;}
  let ev=null; if(editId) ev=await sbGet('vacancies',editId);
  const specVal=ev?(SPECS.includes(ev.specialty)?ev.specialty:'custom'):'';
  const schedVal=ev?(SCHEDS.includes(ev.schedule)?ev.schedule:'–î—Ä—É–≥–æ–π –≥—Ä–∞—Ñ–∏–∫'):'';
  openModal(`<div class="modal-handle"></div>
    <div class="modal-title">${editId?'–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å':'–ù–æ–≤–∞—è'} –≤–∞–∫–∞–Ω—Å–∏—è</div>
    <div class="modal-sub">–æ—Ç ${profile.companyName}</div>
    <form onsubmit="submitVacancy(event,'${editId||''}')">
    <div class="form-wrap">
      <div class="fg"><label>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å<span class="req">*</span></label>
        <select id="vSpec" required onchange="toggleCustomSpec()">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
          ${SPECS.map(s=>`<option value="${s}" ${specVal===s?'selected':''}>${s}</option>`).join('')}
          <option value="custom" ${specVal==='custom'?'selected':''}>–î—Ä—É–≥–æ–µ</option>
        </select></div>
      <div class="fg ${specVal==='custom'?'':'hidden'}" id="vSpecCustomWrap"><label>–£–∫–∞–∂–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å<span class="req">*</span></label><input type="text" id="vSpecCustom" value="${ev&&!SPECS.includes(ev.specialty)?ev.specialty:''}"></div>
      <div class="fg"><label>–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label><input type="text" id="vShortDesc" value="${ev?.shortDesc||''}" placeholder="–í–∏–¥–Ω–æ –≤ —Å–ø–∏—Å–∫–µ"></div>
      <div class="fg-row">
        <div class="fg"><label>–ó–ü –æ—Ç (‚ÇΩ)<span class="req">*</span></label><input type="number" id="vSalFrom" value="${ev?.salFrom||''}" required></div>
        <div class="fg"><label>–ó–ü –¥–æ (‚ÇΩ)</label><input type="number" id="vSalTo" value="${ev?.salTo||''}"></div>
      </div>
      <div class="fg"><label>–û–±—ä–µ–∫—Ç<span class="req">*</span></label><input type="text" id="vObject" value="${ev?.object||''}" required></div>
      <div class="fg"><label>–†–µ–≥–∏–æ–Ω<span class="req">*</span></label>
        <select id="vRegion" required>
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
          ${REGIONS.map(r=>`<option value="${r}" ${ev?.region===r?'selected':''}>${r}</option>`).join('')}
        </select></div>
      <div class="fg"><label>–ì—Ä–∞—Ñ–∏–∫ –≤–∞—Ö—Ç—ã<span class="req">*</span></label>
        <select id="vSchedule" required onchange="toggleCustomSchedule()">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
          ${SCHEDS.map(s=>`<option value="${s}" ${schedVal===s?'selected':''}>${s}</option>`).join('')}
        </select></div>
      <div class="fg ${schedVal==='–î—Ä—É–≥–æ–π –≥—Ä–∞—Ñ–∏–∫'?'':'hidden'}" id="vScheduleCustomWrap"><label>–£–∫–∞–∂–∏—Ç–µ –≥—Ä–∞—Ñ–∏–∫</label><input type="text" id="vScheduleCustom" value="${ev&&!SCHEDS.includes(ev.schedule)?ev.schedule:''}" placeholder="20/10"></div>
      <div class="fg"><label>–ì—Ä–∞—Ñ–∏–∫ —Å–º–µ–Ω</label><input type="text" id="vWorkSchedule" value="${ev?.workSchedule||''}" placeholder="12/12, –¥–Ω–µ–≤–Ω—ã–µ..."></div>
      <div class="fg"><label>–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è</label><textarea id="vDesc">${ev?.desc||''}</textarea></div>
      <div class="fg"><label>–ü—Ä–æ–∂–∏–≤–∞–Ω–∏–µ</label><textarea id="vHousing">${ev?.housing||''}</textarea></div>
      <div class="fg"><label>–ü–∏—Ç–∞–Ω–∏–µ</label><textarea id="vFood">${ev?.food||''}</textarea></div>
      <div class="fg"><label>–°–ø–µ—Ü–æ–¥–µ–∂–¥–∞</label><textarea id="vClothing">${ev?.clothing||''}</textarea></div>
      <div class="fg"><label>–ü—Ä–æ–µ–∑–¥ –¥–æ –æ–±—ä–µ–∫—Ç–∞</label><textarea id="vTransport">${ev?.transport||''}</textarea></div>
      <div style="background:var(--bg);border-radius:10px;padding:14px;margin-bottom:14px">
        <div style="font-size:13px;font-weight:700;margin-bottom:12px">üë§ –ö–æ–Ω—Ç–∞–∫—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞</div>
        <div class="fg" style="margin-bottom:10px"><label>–§–ò–û –º–µ–Ω–µ–¥–∂–µ—Ä–∞</label><input type="text" id="vMgrName" value="${ev?.mgrName||''}"></div>
        <div class="fg" style="margin-bottom:10px"><label>–¢–µ–ª–µ—Ñ–æ–Ω –º–µ–Ω–µ–¥–∂–µ—Ä–∞</label><input type="tel" id="vMgrPhone" value="${ev?.mgrPhone||''}"></div>
        <div class="toggle-row" style="margin-bottom:6px"><span class="toggle-label">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω –≤ –≤–∞–∫–∞–Ω—Å–∏–∏</span><button type="button" class="toggle ${ev?.showPhone?'on':''}" id="vShowPhone" onclick="this.classList.toggle('on')"></button></div>
        <div class="toggle-row"><span class="toggle-label">–†–∞–∑—Ä–µ—à–∏—Ç—å –ø–∏—Å–∞—Ç—å –≤ Telegram</span><button type="button" class="toggle ${ev?.allowTg?'on':''}" id="vAllowTg" onclick="this.classList.toggle('on')"></button></div>
      </div>
      <div class="toggle-row"><span class="toggle-label">üî• –ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ —Å—Ä–æ—á–Ω—É—é</span><button type="button" class="toggle ${ev?.urgent?'on':''}" id="vUrgent" onclick="this.classList.toggle('on')"></button></div>
      <button type="submit" class="btn btn-primary">${editId?'–°–æ—Ö—Ä–∞–Ω–∏—Ç—å':'–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å'}</button>
    </div></form>`);
}
function toggleCustomSpec(){document.getElementById('vSpecCustomWrap').classList.toggle('hidden',document.getElementById('vSpec').value!=='custom');}
function toggleCustomSchedule(){document.getElementById('vScheduleCustomWrap').classList.toggle('hidden',document.getElementById('vSchedule').value!=='–î—Ä—É–≥–æ–π –≥—Ä–∞—Ñ–∏–∫');}

async function submitVacancy(e,editId){
  e.preventDefault();
  const profile=await sbGet('profiles','emp_'+UID);
  let spec=document.getElementById('vSpec').value; if(spec==='custom') spec=document.getElementById('vSpecCustom').value;
  let sched=document.getElementById('vSchedule').value; if(sched==='–î—Ä—É–≥–æ–π –≥—Ä–∞—Ñ–∏–∫') sched=document.getElementById('vScheduleCustom').value;
  const id=editId||('vac_'+Date.now());
  const existing=editId?await sbGet('vacancies',editId):null;
  const v={
    id,eid:UID,companyName:profile.companyName,verified:isVerified(profile),
    specialty:spec,shortDesc:document.getElementById('vShortDesc').value,
    salFrom:document.getElementById('vSalFrom').value,salTo:document.getElementById('vSalTo').value,
    object:document.getElementById('vObject').value,region:document.getElementById('vRegion').value,
    schedule:sched,workSchedule:document.getElementById('vWorkSchedule').value,
    desc:document.getElementById('vDesc').value,housing:document.getElementById('vHousing').value,
    food:document.getElementById('vFood').value,clothing:document.getElementById('vClothing').value,
    transport:document.getElementById('vTransport').value,
    mgrName:document.getElementById('vMgrName').value,
    mgrPhone:document.getElementById('vMgrPhone').value,
    showPhone:document.getElementById('vShowPhone').classList.contains('on'),
    allowTg:document.getElementById('vAllowTg').classList.contains('on'),
    urgent:document.getElementById('vUrgent').classList.contains('on'),
    status:existing?.status||'active',views:existing?.views||0,
    createdAt:existing?.createdAt||new Date().toISOString()
  };
  await sbSet('vacancies',id,v);
  closeModal();toast(editId?'–í–∞–∫–∞–Ω—Å–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞! ‚úÖ':'–í–∞–∫–∞–Ω—Å–∏—è –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞! ‚úÖ');
  loadEmpVacancies();
}
async function deleteVacancy(vid){if(!confirm('–£–¥–∞–ª–∏—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é?'))return;await sbDelete('vacancies',vid);closeModal();toast('–í–∞–∫–∞–Ω—Å–∏—è —É–¥–∞–ª–µ–Ω–∞');loadEmpVacancies();}
async function pauseVacancy(vid){
  const v=await sbGet('vacancies',vid); if(!v)return;
  v.status=v.status==='paused'?'active':'paused';
  await sbSet('vacancies',vid,v);closeModal();
  toast(v.status==='paused'?'–í–∞–∫–∞–Ω—Å–∏—è –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞':'–í–∞–∫–∞–Ω—Å–∏—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∞! ‚úÖ');loadEmpVacancies();
}

// ‚îÄ‚îÄ –ö–ê–ù–î–ò–î–ê–¢–´ ‚îÄ‚îÄ
async function loadCandidates(){
  const el=document.getElementById('empCandList');
  el.innerHTML='<div class="loading"><div class="spin"></div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
  allCandsCache=await sbList('profiles','wrk_');
  const specs=[...new Set(allCandsCache.map(c=>c.specialty).filter(Boolean))];
  const regs=[...new Set(allCandsCache.map(c=>c.region).filter(Boolean))];
  document.getElementById('candSpecFilters').innerHTML=specs.map(s=>`<div class="fchip" onclick="toggleFilter(this,'candSpec','${s}')">${s}</div>`).join('');
  document.getElementById('candRegFilters').innerHTML=regs.map(r=>`<div class="fchip" onclick="toggleFilter(this,'candReg','${r}')">${r}</div>`).join('');
  renderCands(allCandsCache);
}
async function renderCands(list){
  const el=document.getElementById('empCandList');
  if(!list.length){el.innerHTML=`<div class="empty"><div class="empty-ico">üë•</div><div class="empty-title">–ö–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –Ω–µ—Ç</div></div>`;return;}
  const favs=await loadFavs();
  el.innerHTML=list.map(c=>{
    const ava=c.photo?`<img src="${c.photo}" style="width:44px;height:44px;border-radius:50%;object-fit:cover;flex-shrink:0">`:`<div style="width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0">üë§</div>`;
    return`<div class="vcard" onclick="openCandidate('${c.uid}')">
      <div class="vcard-top">
        <div class="vcard-head">
          <div style="display:flex;align-items:center;gap:10px;flex:1">${ava}<div><div class="vcard-title">${c.name}</div><div style="font-size:13px;font-weight:700;color:var(--text2)">${c.specialty}</div></div></div>
          <button class="vcard-fav" onclick="toggleFav('c','${c.uid}',event)">${favs.candidates.includes(c.uid)?'‚ù§Ô∏è':'ü§ç'}</button>
        </div>
        <div class="vcard-tags" style="margin-top:6px"><span class="vtag vtag-green">üìä ${c.experience} ${yrs(c.experience)}</span><span class="vtag vtag-blue">üìç ${c.region||'‚Äî'}</span><span class="vtag">${expRange(c.experience)}</span></div>
        ${c.about?`<div style="font-size:12px;color:var(--text2);margin-top:6px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden">${c.about}</div>`:''}
      </div>
      <div class="vcard-footer"><span class="vcard-date">üìû ${c.phone}</span></div>
    </div>`;
  }).join('');
}

// ‚îÄ‚îÄ –í–•–û–î–Ø–©–ò–ï ‚îÄ‚îÄ
async function loadIncoming(){
  const el=document.getElementById('empIncomingList');
  el.innerHTML='<div class="loading"><div class="spin"></div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
  const allResp=await sbList('responses','resp_');
  const allVacs=await sbList('vacancies','vac_');
  const myVacIds=allVacs.filter(v=>v.eid===UID).map(v=>v.id);
  const mine=allResp.filter(r=>myVacIds.includes(r.vid));
  // –û—Ç–º–µ—á–∞–µ–º –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
  for(const r of mine){if(!r.read){r.read=true;await sbSet('responses',r.id,r);}}
  document.getElementById('incomingBadge').classList.add('hidden');
  if(!mine.length){el.innerHTML=`<div class="empty"><div class="empty-ico">üì¨</div><div class="empty-title">–û—Ç–∫–ª–∏–∫–æ–≤ –Ω–µ—Ç</div><div class="empty-text">–ö–æ–≥–¥–∞ —Å–æ–∏—Å–∫–∞—Ç–µ–ª–∏ –æ—Ç–∫–ª–∏–∫–Ω—É—Ç—Å—è ‚Äî –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å</div></div>`;return;}
  const profiles=await sbList('profiles','wrk_');
  el.innerHTML=mine.map(r=>{
    const prof=profiles.find(p=>p.uid===r.wid);
    const vac=allVacs.find(v=>v.id===r.vid);
    if(!prof||!vac)return'';
    const ava=prof.photo?`<img src="${prof.photo}" style="width:40px;height:40px;border-radius:50%;object-fit:cover;flex-shrink:0">`:`<div style="width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0">üë§</div>`;
    return`<div class="vcard" onclick="openCandidate('${prof.uid}')">
      <div class="vcard-top">
        <div style="display:flex;align-items:center;gap:10px">${ava}<div><div class="vcard-title">${prof.name}</div><div style="font-size:12px;color:var(--text2)">–û—Ç–∫–ª–∏–∫ –Ω–∞: <b>${vac.specialty}</b></div></div></div>
        <div class="vcard-tags" style="margin-top:8px"><span class="vtag vtag-green">üìä ${prof.experience} ${yrs(prof.experience)}</span><span class="vtag vtag-blue">üìç ${prof.region||'‚Äî'}</span></div>
      </div>
      <div class="vcard-footer"><span class="vcard-date">üìû ${prof.phone}</span><span class="vcard-date">${timeAgo(r.createdAt)}</span></div>
    </div>`;
  }).join('');
}

// ‚îÄ‚îÄ –ü–†–û–§–ò–õ–¨ –†–ê–ë–û–¢–û–î–ê–¢–ï–õ–Ø ‚îÄ‚îÄ
async function loadEmpProfile(){
  const el=document.getElementById('empProfileView');
  const profile=await sbGet('profiles','emp_'+UID);
  if(!profile){el.innerHTML=`<div class="empty"><div class="empty-ico">üè¢</div><div class="empty-title">–ü—Ä–æ—Ñ–∏–ª—å –∫–æ–º–ø–∞–Ω–∏–∏</div><div class="empty-text">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å —á—Ç–æ–±—ã –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏–∏. –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—É—á–∞–µ—Ç –∑–Ω–∞—á–æ–∫ ‚úÖ</div><button class="btn btn-primary" style="margin:0 20px;width:calc(100% - 40px)" onclick="showEmpProfileForm()">–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button></div>`;return;}
  const verified=isVerified(profile);
  const rating=await sbGet('ratings','rating_'+UID)||{avg:0,cnt:0};
  const ava=profile.photo?`<img src="${profile.photo}" class="profile-avatar">`:`<div class="avatar-placeholder">üè¢</div>`;
  el.innerHTML=`<div class="profile-hero">${ava}<div class="profile-name">${profile.companyName} ${verified?'‚úÖ':''}</div><div class="profile-role">${profile.sphere||'–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ / –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ'}</div>${rating.cnt?`<div style="margin-top:8px">${starsHtml(rating.avg,rating.cnt)}</div>`:''}</div>
    <div class="form-wrap">
      <div class="detail-section"><div class="detail-section-title">–†–µ–∫–≤–∏–∑–∏—Ç—ã</div>
        <div class="detail-row"><span class="detail-ico">üìã</span><div class="detail-info"><div class="detail-label">–ò–ù–ù</div><div class="detail-value">${profile.inn||'‚Äî'}</div></div></div>
        <div class="detail-row"><span class="detail-ico">üìç</span><div class="detail-info"><div class="detail-label">–Æ—Ä. –∞–¥—Ä–µ—Å</div><div class="detail-value">${profile.address||'‚Äî'}</div></div></div>
        ${profile.phone?`<div class="detail-row"><span class="detail-ico">üìû</span><div class="detail-info"><div class="detail-label">–¢–µ–ª–µ—Ñ–æ–Ω</div><div class="detail-value">${profile.phone}</div></div></div>`:''}
      </div>
      ${profile.about?`<div class="detail-section"><div class="detail-section-title">–û –∫–æ–º–ø–∞–Ω–∏–∏</div><p style="font-size:14px;line-height:1.6;color:var(--text2)">${profile.about}</p></div>`:''}
      <button class="btn btn-outline" onclick="showEmpProfileForm()">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
      ${IS_ADMIN?`<button class="btn btn-dark" style="margin-top:10px" onclick="goAdmin()">üõ° –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>`:''}
    </div>`;
}
function showEmpProfileForm(){
  openModal(`<div class="modal-handle"></div><div class="modal-title">–ü—Ä–æ—Ñ–∏–ª—å –∫–æ–º–ø–∞–Ω–∏–∏</div>
    <form onsubmit="submitEmpProfile(event)"><div class="form-wrap">
      <div class="fg"><label>–§–æ—Ç–æ / –ª–æ–≥–æ—Ç–∏–ø</label>
        <div class="photo-upload-area" onclick="document.getElementById('empPhotoInput').click()">
          <img id="empPhotoPreview" style="width:70px;height:70px;border-radius:50%;object-fit:cover;margin:0 auto;display:none">
          <div id="empPhotoPlaceholder">üì∑ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</div>
          <input type="file" id="empPhotoInput" accept="image/*" style="display:none" onchange="previewPhoto('empPhotoInput','empPhotoPreview','empPhotoPlaceholder')">
        </div></div>
      <div class="fg"><label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏<span class="req">*</span></label><input type="text" id="epName" required></div>
      <div class="fg"><label>–ò–ù–ù<span class="req">*</span></label><input type="text" id="epInn" required></div>
      <div class="fg"><label>–Æ—Ä. –∞–¥—Ä–µ—Å<span class="req">*</span></label><input type="text" id="epAddr" required></div>
      <div class="fg"><label>–°—Ñ–µ—Ä–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</label><input type="text" id="epSphere"></div>
      <div class="fg"><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input type="tel" id="epPhone"></div>
      <div class="fg"><label>Email</label><input type="email" id="epEmail"></div>
      <div class="fg"><label>–û –∫–æ–º–ø–∞–Ω–∏–∏<span class="req">*</span></label><textarea id="epAbout" required></textarea></div>
      <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div></form>`);
}
async function submitEmpProfile(e){
  e.preventDefault();
  const photo=await getPhotoData('empPhotoInput');
  const p={uid:UID,companyName:document.getElementById('epName').value,inn:document.getElementById('epInn').value,address:document.getElementById('epAddr').value,sphere:document.getElementById('epSphere').value,phone:document.getElementById('epPhone').value,email:document.getElementById('epEmail').value,about:document.getElementById('epAbout').value,photo};
  await sbSet('profiles','emp_'+UID,p);closeModal();toast('–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω! ‚úÖ');loadEmpProfile();
}

// ‚îÄ‚îÄ –í–ê–ö–ê–ù–°–ò–ò –°–û–ò–°–ö–ê–¢–ï–õ–Ø ‚îÄ‚îÄ
async function loadWrkVacancies(){
  const el=document.getElementById('wrkVacList');
  el.innerHTML='<div class="loading"><div class="spin"></div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
  const all=await sbList('vacancies','vac_');
  allVacsCache=all.filter(v=>v.status!=='closed'&&v.status!=='paused');
  const specs=[...new Set(allVacsCache.map(v=>v.specialty).filter(Boolean))];
  const regs=[...new Set(allVacsCache.map(v=>v.region).filter(Boolean))];
  document.getElementById('vacSpecFilters').innerHTML=specs.map(s=>`<div class="fchip" onclick="toggleFilter(this,'vacSpec','${s}')">${s}</div>`).join('');
  document.getElementById('vacRegFilters').innerHTML=regs.map(r=>`<div class="fchip" onclick="toggleFilter(this,'vacReg','${r}')">${r}</div>`).join('');
  renderVacs(allVacsCache);
}
async function renderVacs(list){
  const el=document.getElementById('wrkVacList');
  if(!list.length){el.innerHTML=`<div class="empty"><div class="empty-ico">üíº</div><div class="empty-title">–í–∞–∫–∞–Ω—Å–∏–π –Ω–µ—Ç</div></div>`;return;}
  const favs=await loadFavs();
  const ratingCache={};
  el.innerHTML=(await Promise.all(list.map(async v=>{
    if(!ratingCache[v.eid]){const r=await sbGet('ratings','rating_'+v.eid);ratingCache[v.eid]=r||{avg:0,cnt:0};}
    const rat=ratingCache[v.eid];
    return`<div class="vcard" onclick="openVacancy('${v.id}','worker')">
      <div class="vcard-top">
        <div class="vcard-head"><div class="vcard-title">${v.specialty}${v.urgent?' <span class="vtag vtag-red" style="font-size:10px">üî• –°—Ä–æ—á–Ω–æ</span>':''}</div><button class="vcard-fav" onclick="toggleFav('v','${v.id}',event)">${favs.vacancies.includes(v.id)?'‚ù§Ô∏è':'ü§ç'}</button></div>
        <div class="vcard-company">${v.companyName} ${v.verified?'‚úÖ':''} ${rat&&rat.cnt?starsSmall(rat.avg,rat.cnt):''}</div>
        <div class="vcard-salary">${salStr(v.salFrom,v.salTo)}</div>
        <div class="vcard-tags"><span class="vtag vtag-blue">üìç ${v.region}</span><span class="vtag">üìÖ ${v.schedule}</span>${v.workSchedule?`<span class="vtag vtag-orange">‚è∞ ${v.workSchedule}</span>`:''}</div>
      </div>
      ${v.shortDesc?`<div class="vcard-desc">${v.shortDesc}</div>`:''}
      <div class="vcard-footer"><span class="vcard-date">${timeAgo(v.createdAt)}</span><span class="vcard-views">üëÅ ${v.views||0}</span></div>
    </div>`;
  }))).join('');
}

// ‚îÄ‚îÄ –ü–†–û–§–ò–õ–¨ –°–û–ò–°–ö–ê–¢–ï–õ–Ø ‚îÄ‚îÄ
async function loadWrkProfile(){
  const el=document.getElementById('wrkProfileView');
  const p=await sbGet('profiles','wrk_'+UID);
  if(!p){el.innerHTML=`<div class="empty"><div class="empty-ico">üë§</div><div class="empty-title">–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å</div><div class="empty-text">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–∏ –º–æ–≥–ª–∏ –Ω–∞–π—Ç–∏ –≤–∞—Å</div><button class="btn btn-primary" style="margin:0 20px;width:calc(100% - 40px)" onclick="showWrkProfileForm()">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button></div>`;return;}
  const ava=p.photo?`<img src="${p.photo}" class="profile-avatar">`:`<div class="avatar-placeholder">üë∑</div>`;
  el.innerHTML=`<div class="profile-hero">${ava}<div class="profile-name">${p.name}</div><div class="profile-role">${p.specialty}</div></div>
    <div class="form-wrap">
      <div class="detail-section"><div class="detail-section-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
        <div class="detail-row"><span class="detail-ico">üìû</span><div class="detail-info"><div class="detail-label">–¢–µ–ª–µ—Ñ–æ–Ω</div><div class="detail-value">${p.phone}</div></div></div>
        <div class="detail-row"><span class="detail-ico">üìä</span><div class="detail-info"><div class="detail-label">–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã</div><div class="detail-value">${p.experience} ${yrs(p.experience)} (${expRange(p.experience)})</div></div></div>
        <div class="detail-row"><span class="detail-ico">üìç</span><div class="detail-info"><div class="detail-label">–†–µ–≥–∏–æ–Ω</div><div class="detail-value">${p.region||'‚Äî'}</div></div></div>
        ${p.tg?`<div class="detail-row"><span class="detail-ico">‚úàÔ∏è</span><div class="detail-info"><div class="detail-label">Telegram</div><div class="detail-value">@${p.tg}</div></div></div>`:''}
      </div>
      ${p.about?`<div class="detail-section"><div class="detail-section-title">–û —Å–µ–±–µ –∏ –Ω–∞–≤—ã–∫–∏</div><p style="font-size:14px;line-height:1.6;color:var(--text2)">${p.about}</p></div>`:''}
      ${p.docs?`<div class="detail-section"><div class="detail-section-title">–î–æ–∫—É–º–µ–Ω—Ç—ã</div><p style="font-size:14px;line-height:1.6;color:var(--text2)">${p.docs}</p></div>`:''}
      <div class="btn-row">
        <button class="btn btn-outline" onclick="showWrkProfileForm()">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
        <button class="btn btn-danger btn-sm" onclick="deleteWrkProfile()">üóë –£–¥–∞–ª–∏—Ç—å</button>
      </div>
    </div>`;
}
function showWrkProfileForm(){
  openModal(`<div class="modal-handle"></div><div class="modal-title">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</div>
    <form onsubmit="submitWrkProfile(event)"><div class="form-wrap">
      <div class="fg"><label>–§–æ—Ç–æ</label>
        <div class="photo-upload-area" onclick="document.getElementById('wrkPhotoInput').click()">
          <img id="wrkPhotoPreview" style="width:70px;height:70px;border-radius:50%;object-fit:cover;margin:0 auto;display:none">
          <div id="wrkPhotoPlaceholder">üì∑ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</div>
          <input type="file" id="wrkPhotoInput" accept="image/*" style="display:none" onchange="previewPhoto('wrkPhotoInput','wrkPhotoPreview','wrkPhotoPlaceholder')">
        </div></div>
      <div class="fg"><label>–§–ò–û<span class="req">*</span></label><input type="text" id="wpName" required></div>
      <div class="fg"><label>–¢–µ–ª–µ—Ñ–æ–Ω<span class="req">*</span></label><input type="tel" id="wpPhone" required></div>
      <div class="fg"><label>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å<span class="req">*</span></label>
        <select id="wpSpec" required onchange="toggleWrkCustomSpec()">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
          ${SPECS.map(s=>`<option value="${s}">${s}</option>`).join('')}
          <option value="custom">–î—Ä—É–≥–æ–µ</option>
        </select></div>
      <div class="fg hidden" id="wpSpecCustomWrap"><label>–£–∫–∞–∂–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å<span class="req">*</span></label><input type="text" id="wpSpecCustom"></div>
      <div class="fg-row">
        <div class="fg"><label>–û–ø—ã—Ç (–ª–µ—Ç)<span class="req">*</span></label><input type="number" id="wpExp" min="0" required></div>
        <div class="fg"><label>–†–µ–≥–∏–æ–Ω<span class="req">*</span></label>
          <select id="wpRegion" required>
            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
            ${REGIONS.map(r=>`<option value="${r}">${r}</option>`).join('')}
          </select></div>
      </div>
      <div class="fg"><label>Telegram username</label><input type="text" id="wpTg" placeholder="username (–±–µ–∑ @)"></div>
      <div class="fg"><label>–û —Å–µ–±–µ –∏ –Ω–∞–≤—ã–∫–∏<span class="req">*</span></label><textarea id="wpAbout" required></textarea></div>
      <div class="fg"><label>–î–æ–∫—É–º–µ–Ω—Ç—ã –∏ –¥–æ–ø—É—Å–∫–∏</label><textarea id="wpDocs"></textarea></div>
      <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
    </div></form>`);
}
function toggleWrkCustomSpec(){document.getElementById('wpSpecCustomWrap').classList.toggle('hidden',document.getElementById('wpSpec').value!=='custom');}
async function submitWrkProfile(e){
  e.preventDefault();
  let spec=document.getElementById('wpSpec').value; if(spec==='custom') spec=document.getElementById('wpSpecCustom').value;
  const photo=await getPhotoData('wrkPhotoInput');
  const p={uid:UID,name:document.getElementById('wpName').value,phone:document.getElementById('wpPhone').value,specialty:spec,experience:parseInt(document.getElementById('wpExp').value),region:document.getElementById('wpRegion').value,tg:document.getElementById('wpTg').value||TG_USERNAME||'',about:document.getElementById('wpAbout').value,docs:document.getElementById('wpDocs').value,photo};
  await sbSet('profiles','wrk_'+UID,p);closeModal();toast('–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω! ‚úÖ');loadWrkProfile();
}
async function deleteWrkProfile(){if(!confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å?'))return;await sbDelete('profiles','wrk_'+UID);toast('–ü—Ä–æ—Ñ–∏–ª—å —É–¥–∞–ª—ë–Ω');loadWrkProfile();}

// ‚îÄ‚îÄ –û–¢–ö–†–´–¢–¨ –í–ê–ö–ê–ù–°–ò–Æ ‚îÄ‚îÄ
async function openVacancy(vid, viewAs){
  const v=await sbGet('vacancies',vid); if(!v)return;
  // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
  v.views=(v.views||0)+1; await sbSet('vacancies',vid,v);
  const profile=await sbGet('profiles','emp_'+v.eid);
  const rating=await sbGet('ratings','rating_'+v.eid)||{avg:0,cnt:0};
  const allResp=await sbList('responses','resp_');
  const rc=allResp.filter(r=>r.vid===vid).length;
  const myResp=allResp.find(r=>r.vid===vid&&r.wid===UID);
  const favs=await loadFavs();
  const compAva=profile?.photo?`<img src="${profile.photo}" style="width:46px;height:46px;border-radius:50%;object-fit:cover">`:`<div style="width:46px;height:46px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:22px">üè¢</div>`;
  let actions='';
  if(viewAs==='worker'){
    if(myResp) actions=`<button class="btn btn-outline" disabled>‚úÖ –í—ã —É–∂–µ –æ—Ç–∫–ª–∏–∫–Ω—É–ª–∏—Å—å</button>`;
    else actions=`<button class="btn btn-primary" onclick="sendResponse('${vid}')">üì© –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é</button>`;
    if(v.mgrPhone&&v.showPhone){
      actions+=`<div class="btn-row"><a href="tel:${v.mgrPhone}" class="btn btn-green" style="text-decoration:none">üìû ${v.mgrName||'–ü–æ–∑–≤–æ–Ω–∏—Ç—å'}</a>${v.allowTg&&(v.mgrTg||TG_USERNAME)?`<a href="https://t.me/${v.mgrTg||''}" class="btn btn-blue" style="text-decoration:none" target="_blank">‚úàÔ∏è Telegram</a>`:''}</div>`;
    }
    actions+=`<button class="btn btn-outline btn-sm" style="margin-top:8px" onclick="reportVacancy('${vid}')">‚ö†Ô∏è –ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è</button>`;
  } else if(viewAs==='employer'){
    const isPaused=v.status==='paused';
    actions=`<div class="btn-row3"><button class="btn btn-outline btn-sm" onclick="showCreateVacancy('${vid}')">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å</button><button class="btn btn-warn btn-sm" onclick="pauseVacancy('${vid}')">${isPaused?'‚ñ∂Ô∏è –í–æ–∑–æ–±–Ω.':'‚è∏ –ü–∞—É–∑–∞'}</button><button class="btn btn-danger btn-sm" onclick="deleteVacancy('${vid}')">üóë –£–¥–∞–ª–∏—Ç—å</button></div>`;
  }
  openModal(`<div class="modal-handle"></div>
    <div style="display:flex;gap:12px;align-items:start;margin-bottom:12px">
      ${compAva}
      <div style="flex:1">
        <div class="modal-title" style="font-size:15px;margin-bottom:2px">${v.specialty}${v.urgent?' üî•':''}</div>
        <div style="font-size:13px;color:var(--text2);font-weight:700">${v.companyName} ${v.verified?'‚úÖ':''}</div>
        ${rating.cnt?starsHtml(rating.avg,rating.cnt):''}
      </div>
      <button class="vcard-fav" onclick="toggleFav('v','${vid}',event)">${favs.vacancies.includes(vid)?'‚ù§Ô∏è':'ü§ç'}</button>
    </div>
    <div style="font-size:22px;font-weight:700;color:var(--green);margin-bottom:14px">${salStr(v.salFrom,v.salTo)}</div>
    <div class="detail-section">
      <div class="detail-row"><span class="detail-ico">üìç</span><div class="detail-info"><div class="detail-label">–†–µ–≥–∏–æ–Ω</div><div class="detail-value">${v.region}</div></div></div>
      <div class="detail-row"><span class="detail-ico">üè¢</span><div class="detail-info"><div class="detail-label">–û–±—ä–µ–∫—Ç</div><div class="detail-value">${v.object}</div></div></div>
      <div class="detail-row"><span class="detail-ico">üìÖ</span><div class="detail-info"><div class="detail-label">–ì—Ä–∞—Ñ–∏–∫ –≤–∞—Ö—Ç—ã</div><div class="detail-value">${v.schedule}</div></div></div>
      ${v.workSchedule?`<div class="detail-row"><span class="detail-ico">‚è∞</span><div class="detail-info"><div class="detail-label">–ì—Ä–∞—Ñ–∏–∫ —Å–º–µ–Ω</div><div class="detail-value">${v.workSchedule}</div></div></div>`:''}
      <div class="detail-row"><span class="detail-ico">üë•</span><div class="detail-info"><div class="detail-label">–û—Ç–∫–ª–∏–∫–æ–≤ / –ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</div><div class="detail-value">${rc} / ${v.views||0}</div></div></div>
    </div>
    ${v.mgrName&&v.showPhone?`<div class="detail-section"><div class="detail-section-title">–ö–æ–Ω—Ç–∞–∫—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞</div><div class="detail-row"><span class="detail-ico">üë§</span><div class="detail-info"><div class="detail-label">–§–ò–û</div><div class="detail-value">${v.mgrName}</div></div></div><div class="detail-row"><span class="detail-ico">üìû</span><div class="detail-info"><div class="detail-label">–¢–µ–ª–µ—Ñ–æ–Ω</div><div class="detail-value">${v.mgrPhone||'‚Äî'}</div></div></div></div>`:''}
    ${v.desc?`<div class="detail-section"><div class="detail-section-title">–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è</div><p style="font-size:14px;line-height:1.6;color:var(--text2)">${v.desc}</p></div>`:''}
    ${v.housing||v.food||v.clothing||v.transport?`<div class="detail-section"><div class="detail-section-title">–£—Å–ª–æ–≤–∏—è</div>
      ${v.housing?`<div class="detail-row"><span class="detail-ico">üè†</span><div class="detail-info"><div class="detail-label">–ü—Ä–æ–∂–∏–≤–∞–Ω–∏–µ</div><div class="detail-value">${v.housing}</div></div></div>`:''}
      ${v.food?`<div class="detail-row"><span class="detail-ico">üçΩÔ∏è</span><div class="detail-info"><div class="detail-label">–ü–∏—Ç–∞–Ω–∏–µ</div><div class="detail-value">${v.food}</div></div></div>`:''}
      ${v.clothing?`<div class="detail-row"><span class="detail-ico">üëî</span><div class="detail-info"><div class="detail-label">–°–ø–µ—Ü–æ–¥–µ–∂–¥–∞</div><div class="detail-value">${v.clothing}</div></div></div>`:''}
      ${v.transport?`<div class="detail-row"><span class="detail-ico">üöó</span><div class="detail-info"><div class="detail-label">–ü—Ä–æ–µ–∑–¥</div><div class="detail-value">${v.transport}</div></div></div>`:''}
    </div>`:''}
    ${profile?.about?`<div class="detail-section"><div class="detail-section-title">–û –∫–æ–º–ø–∞–Ω–∏–∏</div><p style="font-size:14px;line-height:1.6;color:var(--text2)">${profile.about}</p></div>`:''}
    ${viewAs==='worker'?`<div class="detail-section"><div class="detail-section-title">–û—Ü–µ–Ω–∏—Ç—å —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è</div><div class="stars-row" id="ratingStars">${[1,2,3,4,5].map(i=>`<span class="star" onclick="rateEmployer('${v.eid}',${i})">‚òÜ</span>`).join('')}</div></div>`:''}
    <div style="padding-bottom:8px">${actions}</div>`);
}

// ‚îÄ‚îÄ –û–¢–ö–†–´–¢–¨ –ö–ê–ù–î–ò–î–ê–¢–ê ‚îÄ‚îÄ
async function openCandidate(uid){
  const p=await sbGet('profiles','wrk_'+uid); if(!p)return;
  const ava=p.photo?`<img src="${p.photo}" style="width:70px;height:70px;border-radius:50%;object-fit:cover;margin:0 auto;display:block;border:3px solid var(--accent)">`:`<div class="avatar-placeholder" style="margin:0 auto">üë∑</div>`;
  const tgLink=p.tg?`<a href="https://t.me/${p.tg}" class="btn btn-blue" style="text-decoration:none" target="_blank">‚úàÔ∏è Telegram</a>`:'';
  openModal(`<div class="modal-handle"></div>
    <div style="text-align:center;margin-bottom:14px">${ava}<div class="modal-title" style="margin-top:10px">${p.name}</div><div style="font-size:13px;font-weight:700;color:var(--text2)">${p.specialty}</div></div>
    <div class="detail-section">
      <div class="detail-row"><span class="detail-ico">üìû</span><div class="detail-info"><div class="detail-label">–¢–µ–ª–µ—Ñ–æ–Ω</div><div class="detail-value">${p.phone}</div></div></div>
      <div class="detail-row"><span class="detail-ico">üìä</span><div class="detail-info"><div class="detail-label">–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã</div><div class="detail-value">${p.experience} ${yrs(p.experience)} (${expRange(p.experience)})</div></div></div>
      <div class="detail-row"><span class="detail-ico">üìç</span><div class="detail-info"><div class="detail-label">–†–µ–≥–∏–æ–Ω</div><div class="detail-value">${p.region||'‚Äî'}</div></div></div>
      ${p.tg?`<div class="detail-row"><span class="detail-ico">‚úàÔ∏è</span><div class="detail-info"><div class="detail-label">Telegram</div><div class="detail-value">@${p.tg}</div></div></div>`:''}
    </div>
    ${p.about?`<div class="detail-section"><div class="detail-section-title">–û —Å–µ–±–µ –∏ –Ω–∞–≤—ã–∫–∏</div><p style="font-size:14px;line-height:1.6;color:var(--text2)">${p.about}</p></div>`:''}
    ${p.docs?`<div class="detail-section"><div class="detail-section-title">–î–æ–∫—É–º–µ–Ω—Ç—ã</div><p style="font-size:14px;line-height:1.6;color:var(--text2)">${p.docs}</p></div>`:''}
    <div class="btn-row"><a href="tel:${p.phone}" class="btn btn-green" style="text-decoration:none">üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å</a>${tgLink}</div>
    ${ROLE==='employer'?`<button class="btn btn-primary" style="margin-top:10px" onclick="sendOffer('${uid}')">üì© –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>`:''}
    <div style="height:8px"></div>`);
}

// ‚îÄ‚îÄ –û–¢–ö–õ–ò–ö–ò ‚îÄ‚îÄ
async function sendResponse(vid){
  const wp=await sbGet('profiles','wrk_'+UID);
  if(!wp){toast('–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å!');closeModal();wrkTab('profile',null);return;}
  const r={id:'resp_'+Date.now(),vid,wid:UID,read:false,createdAt:new Date().toISOString()};
  await sbSet('responses',r.id,r);
  const vac=await sbGet('vacancies',vid);
  if(vac){
    const kb={inline_keyboard:[[{text:'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å',url:`tel:${wp.phone}`},{text:'‚úàÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å',url:`https://t.me/${wp.tg||''}`}]]};
    await sendBotMsg(vac.eid,`üîî –ù–æ–≤—ã–π –æ—Ç–∫–ª–∏–∫ –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é!\n\nüë∑ ${wp.name}\nüîß ${wp.specialty}\nüìç ${wp.region||'‚Äî'}\nüìû ${wp.phone}\n\n–í–∞–∫–∞–Ω—Å–∏—è: ${vac.specialty}`,kb);
  }
  showNotif('–û—Ç–∫–ª–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!','–†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram');
  toast('–û—Ç–∫–ª–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! ‚úÖ');closeModal();
}
async function sendOffer(wid){
  const wp=await sbGet('profiles','wrk_'+wid);
  const ep=await sbGet('profiles','emp_'+UID);
  if(!wp||!ep)return;
  const kb={inline_keyboard:[[{text:'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å',url:`tel:${ep.phone||''}`},{text:'‚úàÔ∏è Telegram',url:`https://t.me/${TG_USERNAME||''}`}]]};
  await sendBotMsg(wid,`üíº –í–∞–º –ø–æ—Å—Ç—É–ø–∏–ª–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ!\n\nüè¢ ${ep.companyName}\nüìû ${ep.phone||'‚Äî'}\n\n–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ`,kb);
  toast('–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! ‚úÖ');closeModal();
}
async function reportVacancy(vid){
  const v=await sbGet('vacancies',vid); if(!v)return;
  await sendBotMsg(ADMIN_ID,`‚ö†Ô∏è –ñ–∞–ª–æ–±–∞ –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é!\n\nID: ${vid}\n–ö–æ–º–ø–∞–Ω–∏—è: ${v.companyName}\n–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å: ${v.specialty}\n–û—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${UID}`);
  toast('–ñ–∞–ª–æ–±–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É');closeModal();
}
async function sendBotMsg(userId,text,replyMarkup){
  try{const body={chat_id:userId,text,parse_mode:'HTML'};if(replyMarkup)body.reply_markup=replyMarkup;await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});}catch(e){}
}

// ‚îÄ‚îÄ –†–ï–ô–¢–ò–ù–ì ‚îÄ‚îÄ
async function rateEmployer(eid,score){
  document.querySelectorAll('#ratingStars .star').forEach((s,i)=>{s.textContent=i<score?'‚≠ê':'‚òÜ';});
  let r=await sbGet('ratings','rating_'+eid)||{avg:0,cnt:0,sum:0};
  r.sum=(r.sum||0)+score;r.cnt++;r.avg=r.sum/r.cnt;
  await sbSet('ratings','rating_'+eid,r);toast(`–û—Ü–µ–Ω–∫–∞ ${score}‚≠ê —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!`);
}

// ‚îÄ‚îÄ –ò–ó–ë–†–ê–ù–ù–û–ï –°–¢–†–ê–ù–ò–¶–ê ‚îÄ‚îÄ
async function openFavs(){
  let html='<div class="modal-handle"></div><div class="modal-title">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div>';
  const f=await loadFavs(); let has=false;
  if(f.vacancies.length){
    html+='<div class="detail-section-title" style="margin:14px 0 8px">–í–∞–∫–∞–Ω—Å–∏–∏</div>';
    for(const vid of f.vacancies){const v=await sbGet('vacancies',vid);if(v){has=true;html+=`<div class="vcard" onclick="closeModal();openVacancy('${v.id}','${ROLE}')"><div class="vcard-top"><div class="vcard-title">${v.specialty}</div><div class="vcard-company">${v.companyName}</div><div class="vcard-salary">${salStr(v.salFrom,v.salTo)}</div></div></div>`;}}
  }
  if(f.candidates.length&&ROLE==='employer'){
    html+='<div class="detail-section-title" style="margin:14px 0 8px">–ö–∞–Ω–¥–∏–¥–∞—Ç—ã</div>';
    for(const cid of f.candidates){const c=await sbGet('profiles','wrk_'+cid);if(c){has=true;html+=`<div class="vcard" onclick="closeModal();openCandidate('${c.uid}')"><div class="vcard-top"><div class="vcard-title">${c.name}</div><div class="vcard-company">${c.specialty}</div></div></div>`;}}
  }
  if(!has) html+=`<div class="empty"><div class="empty-ico">‚ù§Ô∏è</div><div class="empty-title">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ –ø—É—Å—Ç–æ</div><div class="empty-text">–ù–∞–∂–∏–º–∞–π—Ç–µ ü§ç –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö</div></div>`;
  html+='<div style="height:20px"></div>';
  openModal(html);
}

// ‚îÄ‚îÄ –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ ‚îÄ‚îÄ
async function goAdmin(){
  if(!IS_ADMIN){toast('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞');return;}
  openModal(`<div class="modal-handle"></div>
    <div class="modal-title">üõ° –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
    <div class="form-wrap">
      <div class="admin-section">
        <div class="admin-section-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
        <div id="adminStats" style="font-size:13px;opacity:0.85">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      </div>
      <div style="margin-bottom:14px">
        <div style="font-size:13px;font-weight:700;margin-bottom:10px">üóë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
        <div class="fg"><label>ID –≤–∞–∫–∞–Ω—Å–∏–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è</label><input type="text" id="adminDelVac" placeholder="vac_..."></div>
        <button class="btn btn-danger btn-sm" onclick="adminDeleteVac()">–£–¥–∞–ª–∏—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é</button>
        <div class="fg" style="margin-top:12px"><label>ID –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è</label><input type="text" id="adminDelProf" placeholder="wrk_... –∏–ª–∏ emp_..."></div>
        <button class="btn btn-danger btn-sm" onclick="adminDeleteProf()">–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
        <div class="fg" style="margin-top:12px"><label>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏</label><input type="text" id="adminBanId" placeholder="Telegram ID"></div>
        <button class="btn btn-warn btn-sm" onclick="adminBan()">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
      </div>
      <div style="margin-bottom:14px">
        <div style="font-size:13px;font-weight:700;margin-bottom:10px">üì¢ –†–∞—Å—Å—ã–ª–∫–∞</div>
        <div class="fg"><textarea id="adminMsgText" placeholder="–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è..."></textarea></div>
        <div class="btn-row">
          <button class="btn btn-blue btn-sm" onclick="adminBroadcast('wrk')">üë∑ –°–æ–∏—Å–∫–∞—Ç–µ–ª—è–º</button>
          <button class="btn btn-dark btn-sm" onclick="adminBroadcast('emp')">üëî –†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è–º</button>
        </div>
      </div>
    </div>`);
  loadAdminStats();
}
async function loadAdminStats(){
  const vacs=await sbList('vacancies','vac_');
  const profs=await sbList('profiles','wrk_');
  const emps=await sbList('profiles','emp_');
  const resp=await sbList('responses','resp_');
  document.getElementById('adminStats').innerHTML=`üíº –í–∞–∫–∞–Ω—Å–∏–π: <b>${vacs.length}</b><br>üë∑ –°–æ–∏—Å–∫–∞—Ç–µ–ª–µ–π: <b>${profs.length}</b><br>üè¢ –†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ–π: <b>${emps.length}</b><br>üì© –û—Ç–∫–ª–∏–∫–æ–≤: <b>${resp.length}</b>`;
}
async function adminDeleteVac(){const id=document.getElementById('adminDelVac').value.trim();if(!id)return;await sbDelete('vacancies',id);toast('–í–∞–∫–∞–Ω—Å–∏—è —É–¥–∞–ª–µ–Ω–∞');}
async function adminDeleteProf(){const id=document.getElementById('adminDelProf').value.trim();if(!id)return;await sbDelete('profiles',id);toast('–ü—Ä–æ—Ñ–∏–ª—å —É–¥–∞–ª—ë–Ω');}
async function adminBan(){
  const id=document.getElementById('adminBanId').value.trim();if(!id)return;
  await sbSet('blacklist','bl_'+id,{uid:id,banned:true,bannedAt:new Date().toISOString()});
  await sendBotMsg(id,'‚õî –í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã Good_–í–∞—Ö—Ç–∞.');
  toast('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');
}
async function adminBroadcast(role){
  const text=document.getElementById('adminMsgText').value.trim();if(!text){toast('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç');return;}
  const profiles=await sbList('profiles',role+'_');
  let sent=0;
  for(const p of profiles){if(p.uid){await sendBotMsg(p.uid,`üì¢ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç Good_–í–∞—Ö—Ç–∞:\n\n${text}`);sent++;await new Promise(r=>setTimeout(r,100));}}
  toast(`–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${sent} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º`);
}

// ‚îÄ‚îÄ –ú–û–î–ê–õ ‚îÄ‚îÄ
function openModal(html){
  let m=document.getElementById('globalModal');
  if(!m){m=document.createElement('div');m.id='globalModal';m.className='modal';m.onclick=e=>{if(e.target===m)closeModal();};document.body.appendChild(m);}
  m.innerHTML=`<div class="modal-box">${html}</div>`;
  m.classList.remove('hidden');
}
function closeModal(){const m=document.getElementById('globalModal');if(m)m.classList.add('hidden');}

// ‚îÄ‚îÄ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ‚îÄ‚îÄ
document.addEventListener('DOMContentLoaded',()=>{
  document.getElementById('welcomeScreen').classList.remove('hidden');
  loadWelcomeNotifs();
});
</script>
</body>
</html>
