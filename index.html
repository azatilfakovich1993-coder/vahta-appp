<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>Good_–í–∞—Ö—Ç–∞</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@700;900&family=Manrope:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{--c1:#0f172a;--c2:#1e293b;--accent:#f97316;--green:#16a34a;--red:#ef4444;--blue:#2563eb;--gold:#f59e0b;--bg:#f8fafc;--card:#fff;--text:#0f172a;--text2:#475569;--text3:#94a3b8;--border:#e2e8f0}
body.dark{--bg:#0f172a;--card:#1e293b;--text:#f1f5f9;--text2:#cbd5e1;--border:#334155}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Manrope,sans-serif;background:var(--bg);color:var(--text);transition:all .3s}
.hidden{display:none!important}
.topbar{background:linear-gradient(135deg,var(--c1),var(--c2));padding:14px 16px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:200}
.topbar-back{background:rgba(255,255,255,.1);border:none;color:#fff;width:36px;height:36px;border-radius:50%;font-size:18px;cursor:pointer}
.topbar-title{font-family:Unbounded,sans-serif;font-size:15px;font-weight:900;color:#fff}
.topbar-title span{color:var(--accent)}
.topbar-role{background:rgba(255,255,255,.15);padding:3px 10px;border-radius:12px;font-size:11px;color:#fff;margin-top:2px}
.topbar-btn{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.15);color:#fff;padding:7px 12px;border-radius:20px;font-size:13px;font-weight:600;cursor:pointer}
.topbar-btn .cnt{background:var(--red);color:#fff;font-size:10px;padding:1px 5px;border-radius:8px;font-weight:700}
.hero{background:var(--card);padding:32px 20px 24px;text-align:center;border-bottom:1px solid var(--border)}
.hero-logo{font-family:Unbounded,sans-serif;font-size:26px;font-weight:900;margin-bottom:6px}
.hero-logo span{color:var(--accent)}
.theme-btns{display:flex;gap:8px;justify-content:center;margin-top:16px}
.theme-btn{padding:8px 16px;border-radius:20px;border:2px solid var(--border);background:var(--card);color:var(--text2);font-size:12px;font-weight:600;cursor:pointer}
.theme-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}
.role-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:20px 16px 90px}
.role-card{background:var(--card);border-radius:16px;padding:20px;text-align:center;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,.08)}
.role-card-ico{font-size:40px;margin-bottom:10px}
.role-card-title{font-family:Unbounded,sans-serif;font-size:13px;font-weight:700;margin-bottom:5px}
.tabs-wrap{background:var(--card);border-bottom:1px solid var(--border);display:flex;position:sticky;top:58px;z-index:100}
.tab-btn{flex:1;padding:13px 6px;background:none;border:none;color:var(--text3);font-size:12px;font-weight:700;cursor:pointer;border-bottom:3px solid transparent;position:relative}
.tab-btn.active{color:var(--accent);border-bottom-color:var(--accent)}
.tab-btn .badge{position:absolute;top:8px;right:6px;background:var(--red);color:#fff;font-size:9px;padding:1px 4px;border-radius:6px}
.list-wrap{padding:12px 16px 90px}
.vcard{background:var(--card);border-radius:14px;margin-bottom:12px;box-shadow:0 2px 8px rgba(0,0,0,.08);cursor:pointer}
.vcard-top{padding:14px}
.vcard-head{display:flex;justify-content:space-between;margin-bottom:6px}
.vcard-title{font-family:Unbounded,sans-serif;font-size:13px;font-weight:700;flex:1}
.vcard-fav{background:none;border:none;font-size:22px;cursor:pointer}
.vcard-company{font-size:13px;color:var(--text2);margin-bottom:6px;font-weight:700;cursor:pointer}
.vcard-salary{font-size:19px;font-weight:700;color:var(--green);margin-bottom:8px}
.vcard-tags{display:flex;flex-wrap:wrap;gap:5px}
.vtag{background:var(--bg);padding:4px 9px;border-radius:7px;font-size:11px;font-weight:600}
.vtag-blue{background:#dbeafe;color:#1d4ed8}
.vtag-green{background:#dcfce7;color:#15803d}
.vtag-red{background:#fee2e2;color:#991b1b}
.vcard-footer{padding:9px 14px;background:var(--bg);display:flex;justify-content:space-between;font-size:11px;color:var(--text3)}
.btn{padding:13px 20px;border-radius:12px;font-size:14px;font-weight:700;cursor:pointer;border:none;width:100%;text-align:center}
.btn-primary{background:linear-gradient(135deg,var(--accent),#fb923c);color:#fff}
.btn-green{background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff}
.btn-blue{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff}
.btn-outline{background:transparent;border:2px solid var(--border);color:var(--text)}
.btn-danger{background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff}
.btn-dark{background:linear-gradient(135deg,var(--c1),var(--c2));color:#fff}
.btn-sm{padding:9px 14px;font-size:12px}
.btn-row{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}
.fab{position:fixed;bottom:80px;right:16px;width:54px;height:54px;border-radius:50%;background:linear-gradient(135deg,var(--accent),#fb923c);color:#fff;border:none;font-size:28px;box-shadow:0 4px 16px rgba(249,115,22,.4);cursor:pointer;z-index:50}
.support-btn{position:fixed;bottom:150px;right:16px;width:54px;height:54px;border-radius:50%;background:var(--blue);color:#fff;border:none;font-size:24px;box-shadow:0 4px 16px rgba(59,130,246,.4);cursor:pointer;z-index:49}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-top:1px solid var(--border);display:flex;z-index:150}
.bnav-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;padding:9px 6px;background:none;border:none;color:var(--text3);font-size:10px;font-weight:600;cursor:pointer;position:relative}
.bnav-item.active{color:var(--accent)}
.bnav-ico{font-size:22px}
.bnav-cnt{position:absolute;top:5px;right:calc(50% - 20px);background:var(--red);color:#fff;font-size:9px;padding:1px 5px;border-radius:8px}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:500;display:flex;align-items:flex-end}
.modal-box{background:var(--card);border-radius:22px 22px 0 0;width:100%;max-height:92vh;overflow-y:auto;padding:18px 18px 40px}
.modal-title{font-family:Unbounded,sans-serif;font-size:17px;font-weight:700;margin-bottom:4px}
.fg{margin-bottom:16px}
.fg label{display:block;font-size:13px;font-weight:700;margin-bottom:6px}
.fg input,.fg select,.fg textarea{width:100%;padding:11px 13px;border:2px solid var(--border);border-radius:10px;font-size:14px;background:var(--card);color:var(--text)}
.fg textarea{min-height:85px}
.toggle-row{display:flex;align-items:center;justify-content:space-between;padding:13px;background:var(--bg);border-radius:10px;margin-bottom:14px}
.toggle{width:46px;height:24px;background:var(--border);border-radius:12px;border:none;cursor:pointer;position:relative}
.toggle::after{content:'';position:absolute;width:18px;height:18px;background:#fff;border-radius:50%;top:3px;left:3px;transition:transform .2s}
.toggle.on{background:var(--green)}
.toggle.on::after{transform:translateX(22px)}
.empty{text-align:center;padding:48px 20px}
.empty-ico{font-size:52px;margin-bottom:12px;opacity:.35}
.empty-title{font-family:Unbounded,sans-serif;font-size:15px;font-weight:700;margin-bottom:7px}
.toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:var(--c1);color:#fff;padding:11px 20px;border-radius:12px;font-size:13px;font-weight:600;z-index:9999;animation:toastIn .25s ease}
@keyframes toastIn{from{transform:translate(-50%,-16px);opacity:0}to{transform:translate(-50%,0);opacity:1}}
.loading{text-align:center;padding:36px}
.spin{width:30px;height:30px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 10px}
@keyframes spin{to{transform:rotate(360deg)}}
.resume-selector{display:flex;gap:8px;margin-bottom:16px;overflow-x:auto}
.resume-tab{padding:8px 16px;border-radius:20px;border:2px solid var(--border);background:var(--card);font-size:12px;font-weight:600;cursor:pointer;white-space:nowrap}
.resume-tab.active{background:var(--accent);color:#fff;border-color:var(--accent)}
.prof-section{background:var(--bg);border-radius:12px;padding:12px;margin-bottom:14px}
.prof-label{font-size:11px;font-weight:700;color:var(--text3);margin-bottom:6px}
.prof-value{font-size:14px;font-weight:600}
.mod-badge{background:#fef3c7;color:#92400e;padding:8px;border-radius:8px;margin:16px;font-weight:700;text-align:center}
.admin-btn{position:fixed;bottom:16px;right:16px;width:54px;height:54px;border-radius:50%;background:linear-gradient(135deg,#7c3aed,#6d28d9);color:#fff;border:none;font-size:24px;box-shadow:0 4px 16px rgba(124,58,237,.4);cursor:pointer;z-index:48}
</style>
</head>
<body>
<div id="app">
<div id="welcomeScreen">
<div class="hero">
<div class="hero-logo">Good_<span>–í–∞—Ö—Ç–∞</span></div>
<div style="font-size:14px;color:var(--text2);margin-bottom:12px">–†–∞–±–æ—Ç–∞ –º–µ—á—Ç—ã ‚Äî –Ω–∞ –≤–∞—Ö—Ç–µ!</div>
<div class="theme-btns">
<button class="theme-btn active" onclick="setTheme('light')">‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è</button>
<button class="theme-btn" onclick="setTheme('dark')">üåô –¢—ë–º–Ω–∞—è</button>
</div>
</div>
<div class="role-grid">
<div class="role-card" onclick="goRole('employer')">
<div class="role-card-ico">üëî</div>
<div class="role-card-title">–†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å</div>
<div style="font-size:11px;color:var(--text2)">–ù–∞–π—Ç–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤</div>
</div>
<div class="role-card" onclick="goRole('worker')">
<div class="role-card-ico">üë∑</div>
<div class="role-card-title">–°–æ–∏—Å–∫–∞—Ç–µ–ª—å</div>
<div style="font-size:11px;color:var(--text2)">–ù–∞–π—Ç–∏ —Ä–∞–±–æ—Ç—É</div>
</div>
</div>
<button class="support-btn" onclick="showSupport()">üí¨</button>
<button class="admin-btn hidden" id="adminBtn" onclick="goAdmin()">üõ°</button>
</div>

<div id="employerScreen" class="hidden">
<div class="topbar">
<div style="display:flex;align-items:center;gap:10px">
<button class="topbar-back" onclick="goWelcome()">‚Üê</button>
<div>
<div class="topbar-title">Good_<span>–í–∞—Ö—Ç–∞</span></div>
<div class="topbar-role">üëî –†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å</div>
</div>
</div>
<button class="topbar-btn" onclick="openFavs()">‚ù§Ô∏è</button>
</div>
<div class="tabs-wrap">
<button class="tab-btn active" onclick="empTab('vac',this)">–í–∞–∫–∞–Ω—Å–∏–∏</button>
<button class="tab-btn" onclick="empTab('cand',this)">–ö–∞–Ω–¥–∏–¥–∞—Ç—ã</button>
<button class="tab-btn" onclick="empTab('in',this)">–í—Ö–æ–¥—è—â–∏–µ</button>
<button class="tab-btn" onclick="empTab('prof',this)">–ü—Ä–æ—Ñ–∏–ª—å</button>
</div>
<div id="empVacTab"><div class="list-wrap" id="empVacList"></div></div>
<div id="empCandTab" class="hidden"><div class="list-wrap" id="candList"></div></div>
<div id="empInTab" class="hidden"><div class="list-wrap" id="inList"></div></div>
<div id="empProfTab" class="hidden"><div id="empProfView"></div></div>
<button class="fab" onclick="createVac()">+</button>
<button class="support-btn" onclick="showSupport()">üí¨</button>
<div class="bottom-nav">
<button class="bnav-item active" onclick="empTab('vac',this)"><span class="bnav-ico">üíº</span><span>–í–∞–∫–∞–Ω—Å–∏–∏</span></button>
<button class="bnav-item" onclick="openFavs()"><span class="bnav-ico">‚ù§Ô∏è</span><span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span></button>
<button class="bnav-item" onclick="empTab('prof',this)"><span class="bnav-ico">üë§</span><span>–ü—Ä–æ—Ñ–∏–ª—å</span></button>
</div>
</div>

<div id="workerScreen" class="hidden">
<div class="topbar">
<div style="display:flex;align-items:center;gap:10px">
<button class="topbar-back" onclick="goWelcome()">‚Üê</button>
<div>
<div class="topbar-title">Good_<span>–í–∞—Ö—Ç–∞</span></div>
<div class="topbar-role">üë∑ –°–æ–∏—Å–∫–∞—Ç–µ–ª—å</div>
</div>
</div>
<button class="topbar-btn" onclick="openFavs()">‚ù§Ô∏è</button>
</div>
<div class="tabs-wrap">
<button class="tab-btn active" onclick="wrkTab('vac',this)">–í–∞–∫–∞–Ω—Å–∏–∏</button>
<button class="tab-btn" onclick="wrkTab('resp',this)">–ú–æ–∏ –æ—Ç–∫–ª–∏–∫–∏</button>
<button class="tab-btn" onclick="wrkTab('prof',this)">–ü—Ä–æ—Ñ–∏–ª—å</button>
</div>
<div id="wrkVacTab"><div class="list-wrap" id="vacList"></div></div>
<div id="wrkRespTab" class="hidden"><div class="list-wrap" id="respList"></div></div>
<div id="wrkProfTab" class="hidden"><div id="wrkProfView"></div></div>
<button class="support-btn" onclick="showSupport()">üí¨</button>
<div class="bottom-nav">
<button class="bnav-item active" onclick="wrkTab('vac',this)"><span class="bnav-ico">üíº</span><span>–í–∞–∫–∞–Ω—Å–∏–∏</span></button>
<button class="bnav-item" onclick="openFavs()"><span class="bnav-ico">‚ù§Ô∏è</span><span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span></button>
<button class="bnav-item" onclick="wrkTab('prof',this)"><span class="bnav-ico">üë§</span><span>–ü—Ä–æ—Ñ–∏–ª—å</span></button>
</div>
</div>
</div>

<script>
const tg=window.Telegram?.WebApp;if(tg){tg.ready();tg.expand()}
const BOT='8406340321:AAE6pjKfFflkF4V2peKKWZ6-vPljslWZjlA';
const SB_URL='https://zutiselchauekvvoirgw.supabase.co';
const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1dGlzZWxjaGF1ZWt2dm9pcmd3Iiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc3MTMyMTAzMiwiZXhwIjoyMDg2ODk3MDMyfQ.XghMDb_u3s1Yz9sg2XL22gW-UEjoyPmVRukq_vlxUwc';
const ADMIN='805705211';
const UID=String(tg?.initDataUnsafe?.user?.id||'demo_'+Math.random().toString(36).slice(2,8));
const UNAME=tg?.initDataUnsafe?.user?.first_name||'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
const TG_USER=tg?.initDataUnsafe?.user?.username||null;
const IS_ADMIN=UID===ADMIN;
let ROLE=null,pendingVac=null,currentResume=1;
const SPECS=['–°–≤–∞—Ä—â–∏–∫','–ú–æ–Ω—Ç–∞–∂–Ω–∏–∫','–≠–ª–µ–∫—Ç—Ä–∏–∫','–°–ª–µ—Å–∞—Ä—å','–¢–æ–∫–∞—Ä—å','–ú–∞–ª—è—Ä','–®—Ç—É–∫–∞—Ç—É—Ä','–ö–∞–º–µ–Ω—â–∏–∫'];
const SCHEDS=['15/15','30/30','45/15','60/30','2/2'];
const REGIONS=['–ú–æ—Å–∫–≤–∞','–°–ü–±','–¢—é–º–µ–Ω—Å–∫–∞—è','–•–ú–ê–û','–Ø–ù–ê–û','–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π','–ò—Ä–∫—É—Ç—Å–∫–∞—è','–Ø–∫—É—Ç–∏—è'];

// –ü–†–Ø–ú–û–ô –î–û–°–¢–£–ü –ö SUPABASE (–ë–ï–ó –ü–†–û–ö–°–ò!)
async function sbGet(t,i){
  try{
    const r=await fetch(`${SB_URL}/rest/v1/${t}?id=eq.${encodeURIComponent(i)}&select=*`,{
      headers:{'apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY,'Content-Type':'application/json'}
    });
    const d=await r.json();
    console.log(`sbGet ${t} ${i}:`,d);
    if(!d||!d[0])return null;
    return d[0].data;
  }catch(e){console.error('sbGet error:',e);return null}
}

async function sbSet(t,i,d){
  try{
    const r=await fetch(`${SB_URL}/rest/v1/${t}`,{
      method:'POST',
      headers:{'apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY,'Content-Type':'application/json','Prefer':'resolution=merge-duplicates'},
      body:JSON.stringify({id:i,data:d})
    });
    console.log(`sbSet ${t} ${i}:`,r.status);
    return await r.json();
  }catch(e){console.error('sbSet error:',e);return null}
}

async function sbList(t,p){
  try{
    const r=await fetch(`${SB_URL}/rest/v1/${t}?id=like.${encodeURIComponent(p)}%&select=*&order=id.desc`,{
      headers:{'apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY,'Content-Type':'application/json'}
    });
    const d=await r.json();
    console.log(`sbList ${t} ${p}:`,d.length,'–∑–∞–ø–∏—Å–µ–π',d);
    if(!Array.isArray(d))return[];
    return d.map(x=>x.data).filter(Boolean);
  }catch(e){console.error('sbList error:',e);return[]}
}

async function sbDel(t,i){try{await fetch(`${SB_URL}/rest/v1/${t}?id=eq.${i}`,{method:'DELETE',headers:{apikey:SB_KEY,Authorization:'Bearer '+SB_KEY}})}catch(e){console.error('sbDel error:',e)}}

async function loadFavs(){return await sbGet('favorites','favs_'+UID)||{vacancies:[],candidates:[]}}
async function saveFavs(f){await sbSet('favorites','favs_'+UID,f)}
async function toggleFav(type,id,e){if(e)e.stopPropagation();const f=await loadFavs();const l=type==='v'?f.vacancies:f.candidates;const i=l.indexOf(id);if(i>-1){l.splice(i,1);toast('–£–¥–∞–ª–µ–Ω–æ')}else{l.push(id);toast('‚ù§Ô∏è')}await saveFavs(f);if(ROLE==='employer')loadEmpVacs();else loadWrkVacs()}

function toast(m){const t=document.createElement('div');t.className='toast';t.textContent=m;document.body.appendChild(t);setTimeout(()=>t.remove(),2500)}
function timeAgo(iso){const d=Math.floor((new Date()-new Date(iso))/60000);if(d<1)return'—Å–µ–π—á–∞—Å';if(d<60)return d+'–º';if(d<1440)return Math.floor(d/60)+'—á';return Math.floor(d/1440)+'–¥'}
function salStr(a,b,h){let s='';if(a&&b)s=`${parseInt(a).toLocaleString()}‚Äî${parseInt(b).toLocaleString()}‚ÇΩ`;else if(a)s=`–æ—Ç ${parseInt(a).toLocaleString()}‚ÇΩ`;else s='‚Äî';if(h)s+=` | ${h}‚ÇΩ/—á`;return s}
async function sendBot(uid,txt){try{await fetch(`https://api.telegram.org/bot${BOT}/sendMessage`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({chat_id:uid,text:txt,parse_mode:'HTML'})})}catch{}}
function compress(file){return new Promise(r=>{const reader=new FileReader();reader.onload=e=>{const img=new Image();img.onload=()=>{const c=document.createElement('canvas');let w=img.width,h=img.height;const max=300;if(w>h){if(w>max){h=h*max/w;w=max}}else{if(h>max){w=w*max/h;h=max}}c.width=w;c.height=h;c.getContext('2d').drawImage(img,0,0,w,h);r(c.toDataURL('image/jpeg',.7))};img.src=e.target.result};reader.readAsDataURL(file)})}
async function getPhoto(id){return new Promise(r=>{const i=document.getElementById(id);if(!i?.files?.[0]){r(null);return}compress(i.files[0]).then(r)})}

function setTheme(t){document.body.className=t==='dark'?'dark':'';document.querySelectorAll('.theme-btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');localStorage.setItem('theme',t)}
function loadTheme(){const t=localStorage.getItem('theme')||'light';if(t==='dark'){document.body.className='dark';document.querySelectorAll('.theme-btn')[1]?.classList.add('active');document.querySelectorAll('.theme-btn')[0]?.classList.remove('active')}}

function hideAll(){['welcomeScreen','employerScreen','workerScreen'].forEach(i=>document.getElementById(i).classList.add('hidden'))}
function goWelcome(){hideAll();document.getElementById('welcomeScreen').classList.remove('hidden');ROLE=null;if(IS_ADMIN)document.getElementById('adminBtn').classList.remove('hidden')}
async function goRole(r){ROLE=r;hideAll();const bl=await sbGet('blacklist','bl_'+UID);if(bl?.banned){toast('–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');goWelcome();return}if(r==='employer'){document.getElementById('employerScreen').classList.remove('hidden');loadEmpVacs()}else{document.getElementById('workerScreen').classList.remove('hidden');loadWrkVacs()}loadFavs()}

function empTab(t,b){document.querySelectorAll('#employerScreen .tab-btn').forEach(x=>x.classList.remove('active'));if(b)b.classList.add('active');['empVacTab','empCandTab','empInTab','empProfTab'].forEach(i=>document.getElementById(i).classList.add('hidden'));if(t==='vac'){document.getElementById('empVacTab').classList.remove('hidden');loadEmpVacs()}else if(t==='cand'){document.getElementById('empCandTab').classList.remove('hidden');loadCands()}else if(t==='in'){document.getElementById('empInTab').classList.remove('hidden');loadIncoming()}else if(t==='prof'){document.getElementById('empProfTab').classList.remove('hidden');loadEmpProf()}}
function wrkTab(t,b){document.querySelectorAll('#workerScreen .tab-btn').forEach(x=>x.classList.remove('active'));if(b)b.classList.add('active');['wrkVacTab','wrkRespTab','wrkProfTab'].forEach(i=>document.getElementById(i).classList.add('hidden'));if(t==='vac'){document.getElementById('wrkVacTab').classList.remove('hidden');loadWrkVacs()}else if(t==='resp'){document.getElementById('wrkRespTab').classList.remove('hidden');loadMyResp()}else{document.getElementById('wrkProfTab').classList.remove('hidden');loadWrkProf()}}

async function loadEmpVacs(){
  const el=document.getElementById('empVacList');
  el.innerHTML='<div class="loading"><div class="spin"></div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
  const all=await sbList('vacancies','vac_');
  console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ –≤–∞–∫–∞–Ω—Å–∏–π:',all.length,all);
  const mine=all.filter(v=>v.eid===UID);
  if(!mine.length){el.innerHTML='<div class="empty"><div class="empty-ico">üìã</div><div class="empty-title">–ù–µ—Ç –≤–∞–∫–∞–Ω—Å–∏–π</div></div>';return}
  const favs=await loadFavs();
  el.innerHTML=mine.map(v=>`<div class="vcard" onclick="openVac('${v.id}','emp')"><div class="vcard-top"><div class="vcard-head"><div class="vcard-title">${v.specialty}</div><button class="vcard-fav" onclick="toggleFav('v','${v.id}',event)">${favs.vacancies.includes(v.id)?'‚ù§Ô∏è':'ü§ç'}</button></div><div class="vcard-company">${v.companyName||'–ö–æ–º–ø–∞–Ω–∏—è'}</div><div class="vcard-salary">${salStr(v.salFrom,v.salTo,v.hourlyRate)}</div><div class="vcard-tags"><span class="vtag vtag-blue">üìç${v.region}</span><span class="vtag">üìÖ${v.schedule}</span></div></div><div class="vcard-footer"><span>${timeAgo(v.createdAt)}</span><span>üëÅ${v.views||0}</span></div></div>`).join('');
}

async function loadCands(){
  const el=document.getElementById('candList');
  el.innerHTML='<div class="loading"><div class="spin"></div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
  const all=[];
  for(let i=1;i<=3;i++){all.push(...await sbList('profiles',`wrk${i}_`))}
  console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤:',all.length,all);
  if(!all.length){el.innerHTML='<div class="empty"><div class="empty-ico">üë•</div><div class="empty-title">–ù–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤</div></div>';return}
  const favs=await loadFavs();
  el.innerHTML=all.map(c=>`<div class="vcard" onclick="openCand('${c.uid}',${c.resumeNum||1})"><div class="vcard-top"><div class="vcard-head"><div class="vcard-title">${c.name}</div><button class="vcard-fav" onclick="toggleFav('c','${c.uid}',event)">${favs.candidates.includes(c.uid)?'‚ù§Ô∏è':'ü§ç'}</button></div><div style="font-size:13px;font-weight:700;color:var(--text2);margin-bottom:6px">${c.specialty}</div>${c.desiredSalary?`<div style="font-size:17px;font-weight:700;color:var(--green);margin-bottom:6px">–æ—Ç ${parseInt(c.desiredSalary).toLocaleString()} ‚ÇΩ</div>`:''}<div class="vcard-tags"><span class="vtag vtag-green">üìä${c.experience}–ª</span><span class="vtag vtag-blue">üìç${c.region||'‚Äî'}</span></div></div><div class="vcard-footer"><span>üìû${c.phone}</span></div></div>`).join('');
}

async function loadIncoming(){const el=document.getElementById('inList');el.innerHTML='<div class="loading"><div class="spin"></div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>';const resp=await sbList('responses','resp_');const vacs=await sbList('vacancies','vac_');const myVacIds=vacs.filter(v=>v.eid===UID).map(v=>v.id);const mine=resp.filter(r=>myVacIds.includes(r.vid));if(!mine.length){el.innerHTML='<div class="empty"><div class="empty-ico">üì¨</div><div class="empty-title">–û—Ç–∫–ª–∏–∫–æ–≤ –Ω–µ—Ç</div></div>';return}const profs=[];for(let i=1;i<=3;i++){profs.push(...await sbList('profiles',`wrk${i}_`))}el.innerHTML=mine.map(r=>{const p=profs.find(x=>x.uid===r.wid);const v=vacs.find(x=>x.id===r.vid);if(!p||!v)return'';return`<div class="vcard" onclick="openCand('${p.uid}',${p.resumeNum||1})"><div class="vcard-top"><div class="vcard-title">${p.name}</div><div style="font-size:12px;color:var(--text2)">–û—Ç–∫–ª–∏–∫ –Ω–∞: <b>${v.specialty}</b></div></div><div class="vcard-footer"><span>üìû${p.phone}</span><span>${timeAgo(r.createdAt)}</span></div></div>`}).join('')}
async function loadMyResp(){const el=document.getElementById('respList');el.innerHTML='<div class="loading"><div class="spin"></div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>';const resp=await sbList('responses','resp_');const mine=resp.filter(r=>r.wid===UID);if(!mine.length){el.innerHTML='<div class="empty"><div class="empty-ico">üìù</div><div class="empty-title">–ù–µ—Ç –æ—Ç–∫–ª–∏–∫–æ–≤</div></div>';return}const vacs=await sbList('vacancies','vac_');el.innerHTML=mine.map(r=>{const v=vacs.find(x=>x.id===r.vid);if(!v)return'';return`<div class="vcard" onclick="openVac('${v.id}','wrk')"><div class="vcard-top"><div class="vcard-title">${v.specialty}</div><div class="vcard-company">${v.companyName||'–ö–æ–º–ø–∞–Ω–∏—è'}</div></div><div class="vcard-footer"><span>${timeAgo(r.createdAt)}</span></div></div>`}).join('')}

async function loadEmpProf(){
  const el=document.getElementById('empProfView');
  const p=await sbGet('profiles','emp_'+UID);
  if(!p){el.innerHTML='<div class="empty"><div class="empty-ico">üè¢</div><div class="empty-title">–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å</div><button class="btn btn-primary" style="margin:20px" onclick="editEmpProf()">–°–æ–∑–¥–∞—Ç—å</button></div>';return}
  let badge='';
  if(p.moderationStatus==='pending')badge='<div class="mod-badge">‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>';
  else if(p.moderationStatus==='revision')badge='<div class="mod-badge">‚úèÔ∏è –ù–∞ –¥–æ—Ä–∞–±–æ—Ç–∫–µ</div>';
  el.innerHTML=`<div style="background:linear-gradient(135deg,var(--c1),var(--c2));padding:26px 20px;text-align:center;color:#fff"><div style="font-family:Unbounded;font-size:15px;font-weight:700">${p.companyName}</div></div>${badge}${p.moderationComment?`<div style="background:#fff7ed;border-left:4px solid #f59e0b;padding:12px;margin:16px;border-radius:8px"><div style="font-weight:700;margin-bottom:4px">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</div><div style="font-size:13px">${p.moderationComment}</div></div>`:''}<div style="padding:16px"><button class="btn btn-outline" onclick="editEmpProf()">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button></div>`;
}
async function editEmpProf(){const ex=await sbGet('profiles','emp_'+UID);openModal(`<div style="font-family:Unbounded;font-size:17px;font-weight:700;margin-bottom:18px">–ü—Ä–æ—Ñ–∏–ª—å –∫–æ–º–ø–∞–Ω–∏–∏</div><form onsubmit="saveEmpProf(event)"><div class="fg"><label>–ù–∞–∑–≤–∞–Ω–∏–µ<span style="color:var(--red)">*</span></label><input type="text" id="epName" value="${ex?.companyName||''}" required></div><div class="fg"><label>–ò–ù–ù<span style="color:var(--red)">*</span></label><input type="text" id="epInn" value="${ex?.inn||''}" required></div><div class="fg"><label>–ê–¥—Ä–µ—Å<span style="color:var(--red)">*</span></label><input type="text" id="epAddr" value="${ex?.address||''}" required></div><div class="fg"><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input type="tel" id="epPhone" value="${ex?.phone||''}"></div><div class="fg"><label>–û –∫–æ–º–ø–∞–Ω–∏–∏<span style="color:var(--red)">*</span></label><textarea id="epAbout" required>${ex?.about||''}</textarea></div><button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button></form>`)}
async function saveEmpProf(e){
  e.preventDefault();
  const ex=await sbGet('profiles','emp_'+UID);
  const needMod=!ex||ex.moderationStatus!=='approved';
  const p={
    uid:UID,
    companyName:document.getElementById('epName').value,
    inn:document.getElementById('epInn').value,
    address:document.getElementById('epAddr').value,
    phone:document.getElementById('epPhone').value,
    about:document.getElementById('epAbout').value,
    moderationStatus:needMod?'pending':'approved',
    moderationComment:ex?.moderationComment||''
  };
  await sbSet('profiles','emp_'+UID,p);
  if(needMod){
    await sendBot(ADMIN,`üè¢ –ó–∞—è–≤–∫–∞ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é\n\nüë§${p.companyName}\nüìã${p.inn}\nüìç${p.address}\n\nID: ${UID}\n\n–û–¥–æ–±—Ä–∏—Ç–µ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å`);
    toast('–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏')
  }else{toast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ‚úÖ')}
  closeModal();loadEmpProf()
}

async function loadWrkVacs(){
  const el=document.getElementById('vacList');
  el.innerHTML='<div class="loading"><div class="spin"></div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
  const all=await sbList('vacancies','vac_');
  console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ –≤–∞–∫–∞–Ω—Å–∏–π –¥–ª—è —Å–æ–∏—Å–∫–∞—Ç–µ–ª—è:',all.length,all);
  const filtered=all.filter(v=>v.status!=='closed'&&v.status!=='paused');
  if(!filtered.length){el.innerHTML='<div class="empty"><div class="empty-ico">üíº</div><div class="empty-title">–ù–µ—Ç –≤–∞–∫–∞–Ω—Å–∏–π</div></div>';return}
  const favs=await loadFavs();
  el.innerHTML=filtered.map(v=>`<div class="vcard" onclick="openVac('${v.id}','wrk')"><div class="vcard-top"><div class="vcard-head"><div class="vcard-title">${v.specialty}</div><button class="vcard-fav" onclick="toggleFav('v','${v.id}',event)">${favs.vacancies.includes(v.id)?'‚ù§Ô∏è':'ü§ç'}</button></div><div class="vcard-company">${v.companyName||'–ö–æ–º–ø–∞–Ω–∏—è'}</div><div class="vcard-salary">${salStr(v.salFrom,v.salTo,v.hourlyRate)}</div><div class="vcard-tags"><span class="vtag vtag-blue">üìç${v.region}</span><span class="vtag">üìÖ${v.schedule}</span></div></div><div class="vcard-footer"><span>${timeAgo(v.createdAt)}</span><span>üëÅ${v.views||0}</span></div></div>`).join('');
}

async function loadWrkProf(){
  const el=document.getElementById('wrkProfView');
  const p1=await sbGet('profiles','wrk1_'+UID);
  const p2=await sbGet('profiles','wrk2_'+UID);
  const p3=await sbGet('profiles','wrk3_'+UID);
  const profiles=[p1,p2,p3];
  const hasAny=profiles.some(p=>p);
  if(!hasAny){el.innerHTML='<div class="empty"><div class="empty-ico">üë§</div><div class="empty-title">–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å</div><button class="btn btn-primary" style="margin:20px" onclick="editWrkProf(1)">–°–æ–∑–¥–∞—Ç—å —Ä–µ–∑—é–º–µ</button></div>';return}
  let html='<div style="padding:16px"><div class="resume-selector">';
  for(let i=1;i<=3;i++){const p=profiles[i-1];html+=`<div class="resume-tab ${currentResume===i?'active':''}" onclick="switchResume(${i})">${p?`üìÑ –†–µ–∑—é–º–µ ${i}`:`‚ûï –†–µ–∑—é–º–µ ${i}`}</div>`}
  html+='</div>';
  const curr=profiles[currentResume-1];
  if(curr){
    html+=`<div style="background:linear-gradient(135deg,var(--c1),var(--c2));padding:26px 20px;text-align:center;color:#fff;border-radius:12px;margin-bottom:16px"><div style="font-family:Unbounded;font-size:15px;font-weight:700">${curr.name}</div><div style="font-size:12px;opacity:.65">${curr.specialty}</div></div>`;
    html+=`<div class="prof-section"><div class="prof-label">–ö–û–ù–¢–ê–ö–¢–´</div><div class="prof-value">üìû ${curr.phone}</div>${curr.tg?`<div class="prof-value">‚úàÔ∏è @${curr.tg}</div>`:''}</div>`;
    html+=`<div class="prof-section"><div class="prof-label">–û–ü–´–¢ –ò –†–ï–ì–ò–û–ù</div><div class="prof-value">üìä ${curr.experience} –ª–µ—Ç</div><div class="prof-value">üìç ${curr.region||'‚Äî'}</div></div>`;
    if(curr.desiredSalary)html+=`<div class="prof-section"><div class="prof-label">–ñ–ï–õ–ê–ï–ú–ê–Ø –ó–ü</div><div class="prof-value" style="color:var(--green);font-weight:700">–æ—Ç ${parseInt(curr.desiredSalary).toLocaleString()} ‚ÇΩ</div></div>`;
    if(curr.about)html+=`<div class="prof-section"><div class="prof-label">–û –°–ï–ë–ï</div><div class="prof-value">${curr.about}</div></div>`;
    html+=`<div class="btn-row"><button class="btn btn-outline" onclick="editWrkProf(${currentResume})">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button><button class="btn btn-danger btn-sm" onclick="delWrkProf(${currentResume})">üóë –£–¥–∞–ª–∏—Ç—å</button></div>`;
  }else{
    html+=`<div class="empty"><div class="empty-ico">üìÑ</div><div class="empty-title">–†–µ–∑—é–º–µ ${currentResume} –Ω–µ —Å–æ–∑–¥–∞–Ω–æ</div><button class="btn btn-primary" style="margin:20px" onclick="editWrkProf(${currentResume})">–°–æ–∑–¥–∞—Ç—å</button></div>`;
  }
  html+='</div>';
  el.innerHTML=html;
}
function switchResume(num){currentResume=num;loadWrkProf()}
async function editWrkProf(num){const ex=await sbGet('profiles',`wrk${num}_`+UID);openModal(`<div style="font-family:Unbounded;font-size:17px;font-weight:700;margin-bottom:18px">–†–µ–∑—é–º–µ ${num}</div><form onsubmit="saveWrkProf(event,${num})"><div class="fg"><label>–§–ò–û<span style="color:var(--red)">*</span></label><input type="text" id="wpName" value="${ex?.name||''}" required></div><div class="fg"><label>–¢–µ–ª–µ—Ñ–æ–Ω<span style="color:var(--red)">*</span></label><input type="tel" id="wpPhone" value="${ex?.phone||''}" required></div><div class="fg"><label>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å<span style="color:var(--red)">*</span></label><select id="wpSpec" required onchange="toggleCustomSpec()">${SPECS.map(s=>`<option value="${s}" ${ex?.specialty===s?'selected':''}>${s}</option>`).join('')}<option value="custom" ${ex?.specialty&&!SPECS.includes(ex.specialty)?'selected':''}>–î—Ä—É–≥–æ–µ</option></select></div><div class="fg ${ex?.specialty&&!SPECS.includes(ex.specialty)?'':'hidden'}" id="wpSpecCustom"><label>–£–∫–∞–∂–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</label><input type="text" id="wpSpecInput" value="${ex?.specialty&&!SPECS.includes(ex.specialty)?ex.specialty:''}"></div><div class="fg"><label>–û–ø—ã—Ç (–ª–µ—Ç)<span style="color:var(--red)">*</span></label><input type="number" id="wpExp" value="${ex?.experience||0}" min="0" required></div><div class="fg"><label>–ñ–µ–ª–∞–µ–º–∞—è –ó–ü (‚ÇΩ)<span style="color:var(--red)">*</span></label><input type="number" id="wpSalary" value="${ex?.desiredSalary||''}" required></div><div class="fg"><label>–†–µ–≥–∏–æ–Ω<span style="color:var(--red)">*</span></label><select id="wpRegion" required onchange="toggleCustomReg()">${REGIONS.map(r=>`<option value="${r}" ${ex?.region===r?'selected':''}>${r}</option>`).join('')}<option value="custom" ${ex?.region&&!REGIONS.includes(ex.region)?'selected':''}>–î—Ä—É–≥–æ–π</option></select></div><div class="fg ${ex?.region&&!REGIONS.includes(ex.region)?'':'hidden'}" id="wpRegCustom"><label>–£–∫–∞–∂–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω</label><input type="text" id="wpRegInput" value="${ex?.region&&!REGIONS.includes(ex.region)?ex.region:''}"></div><div class="fg"><label>Telegram</label><input type="text" id="wpTg" value="${ex?.tg||TG_USER||''}"></div><div class="fg"><label>–û —Å–µ–±–µ<span style="color:var(--red)">*</span></label><textarea id="wpAbout" required>${ex?.about||''}</textarea></div><button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button></form>`)}
function toggleCustomSpec(){document.getElementById('wpSpecCustom').classList.toggle('hidden',document.getElementById('wpSpec').value!=='custom')}
function toggleCustomReg(){document.getElementById('wpRegCustom').classList.toggle('hidden',document.getElementById('wpRegion').value!=='custom')}
async function saveWrkProf(e,num){e.preventDefault();let spec=document.getElementById('wpSpec').value;if(spec==='custom')spec=document.getElementById('wpSpecInput').value;let reg=document.getElementById('wpRegion').value;if(reg==='custom')reg=document.getElementById('wpRegInput').value;const p={uid:UID,resumeNum:num,name:document.getElementById('wpName').value,phone:document.getElementById('wpPhone').value,specialty:spec,experience:parseInt(document.getElementById('wpExp').value),desiredSalary:document.getElementById('wpSalary').value,region:reg,tg:document.getElementById('wpTg').value,about:document.getElementById('wpAbout').value};await sbSet('profiles',`wrk${num}_`+UID,p);toast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ‚úÖ');closeModal();loadWrkProf();if(pendingVac){openVac(pendingVac,'wrk');pendingVac=null}}
async function delWrkProf(num){if(!confirm(`–£–¥–∞–ª–∏—Ç—å —Ä–µ–∑—é–º–µ ${num}?`))return;await sbDel('profiles',`wrk${num}_`+UID);toast('–£–¥–∞–ª–µ–Ω–æ');loadWrkProf()}

async function createVac(){const p=await sbGet('profiles','emp_'+UID);if(!p||p.moderationStatus!=='approved'){if(!p){toast('–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å!');empTab('prof',document.querySelectorAll('#employerScreen .tab-btn')[3]);return}if(p.moderationStatus==='pending'){toast('–î–æ–∂–¥–∏—Ç–µ—Å—å –º–æ–¥–µ—Ä–∞—Ü–∏–∏!');return}if(p.moderationStatus==='revision'){toast('–î–æ—Ä–∞–±–æ—Ç–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å!');empTab('prof',document.querySelectorAll('#employerScreen .tab-btn')[3]);return}}openModal(`<div style="font-family:Unbounded;font-size:17px;font-weight:700;margin-bottom:18px">–ù–æ–≤–∞—è –≤–∞–∫–∞–Ω—Å–∏—è</div><form onsubmit="saveVac(event)"><div class="fg"><label>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å<span style="color:var(--red)">*</span></label><select id="vSpec" required onchange="toggleVacCustomSpec()">${SPECS.map(s=>`<option value="${s}">${s}</option>`).join('')}<option value="custom">–î—Ä—É–≥–æ–µ</option></select></div><div class="fg hidden" id="vSpecCustom"><label>–£–∫–∞–∂–∏—Ç–µ</label><input type="text" id="vSpecInput"></div><div class="fg"><label>–û –≤–∞–∫–∞–Ω—Å–∏–∏</label><input type="text" id="vDesc"></div><div class="fg" style="display:grid;grid-template-columns:1fr 1fr;gap:10px"><div><label>–ó–ü –æ—Ç<span style="color:var(--red)">*</span></label><input type="number" id="vSalF" required></div><div><label>–ó–ü –¥–æ</label><input type="number" id="vSalT"></div></div><div class="fg"><label>–ß–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ (‚ÇΩ/—á)</label><input type="number" id="vRate"></div><div class="fg"><label>–û–±—ä–µ–∫—Ç<span style="color:var(--red)">*</span></label><input type="text" id="vObj" required></div><div class="fg"><label>–†–µ–≥–∏–æ–Ω<span style="color:var(--red)">*</span></label><select id="vReg" required onchange="toggleVacCustomReg()">${REGIONS.map(r=>`<option value="${r}">${r}</option>`).join('')}<option value="custom">–î—Ä—É–≥–æ–π</option></select></div><div class="fg hidden" id="vRegCustom"><label>–£–∫–∞–∂–∏—Ç–µ</label><input type="text" id="vRegInput"></div><div class="fg"><label>–ì—Ä–∞—Ñ–∏–∫<span style="color:var(--red)">*</span></label><select id="vSched" required onchange="toggleVacCustomSched()">${SCHEDS.map(s=>`<option value="${s}">${s}</option>`).join('')}<option value="custom">–î—Ä—É–≥–æ–π</option></select></div><div class="fg hidden" id="vSchedCustom"><label>–£–∫–∞–∂–∏—Ç–µ</label><input type="text" id="vSchedInput"></div><button type="submit" class="btn btn-primary">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button></form>`)}
function toggleVacCustomSpec(){document.getElementById('vSpecCustom').classList.toggle('hidden',document.getElementById('vSpec').value!=='custom')}
function toggleVacCustomReg(){document.getElementById('vRegCustom').classList.toggle('hidden',document.getElementById('vReg').value!=='custom')}
function toggleVacCustomSched(){document.getElementById('vSchedCustom').classList.toggle('hidden',document.getElementById('vSched').value!=='custom')}
async function saveVac(e){e.preventDefault();const p=await sbGet('profiles','emp_'+UID);let spec=document.getElementById('vSpec').value;if(spec==='custom')spec=document.getElementById('vSpecInput').value;let reg=document.getElementById('vReg').value;if(reg==='custom')reg=document.getElementById('vRegInput').value;let sched=document.getElementById('vSched').value;if(sched==='custom')sched=document.getElementById('vSchedInput').value;const id='vac_'+Date.now();const v={id,eid:UID,companyName:p.companyName,specialty:spec,shortDesc:document.getElementById('vDesc').value,salFrom:document.getElementById('vSalF').value,salTo:document.getElementById('vSalT').value,hourlyRate:document.getElementById('vRate').value,object:document.getElementById('vObj').value,region:reg,schedule:sched,status:'active',views:0,createdAt:new Date().toISOString()};await sbSet('vacancies',id,v);toast('–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ‚úÖ');closeModal();loadEmpVacs()}

async function openVac(vid,from){const v=await sbGet('vacancies',vid);if(!v)return;v.views=(v.views||0)+1;await sbSet('vacancies',vid,v);const resp=await sbList('responses','resp_');const myResp=resp.find(r=>r.vid===vid&&r.wid===UID);let acts='';if(from==='wrk'){if(myResp){acts='<button class="btn btn-outline" disabled>‚úÖ –û—Ç–∫–ª–∏–∫–Ω—É–ª–∏—Å—å</button>'}else{acts=`<button class="btn btn-primary" onclick="sendResp('${vid}')">üì© –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è</button>`}}openModal(`<div style="font-family:Unbounded;font-size:16px;font-weight:700;margin-bottom:4px">${v.specialty}</div><div style="font-size:13px;color:var(--text2);margin-bottom:12px">${v.companyName||'–ö–æ–º–ø–∞–Ω–∏—è'}</div><div style="font-size:22px;font-weight:700;color:var(--green);margin-bottom:14px">${salStr(v.salFrom,v.salTo,v.hourlyRate)}</div><div style="background:var(--bg);border-radius:10px;padding:12px;margin-bottom:14px">üìç${v.region} ‚Ä¢ üìÖ${v.schedule}</div>${v.shortDesc?`<div style="background:var(--bg);border-radius:10px;padding:12px;margin-bottom:14px">${v.shortDesc}</div>`:''}${acts}`)}
async function sendResp(vid){const wp=await sbGet('profiles',`wrk${currentResume}_`+UID);if(!wp){pendingVac=vid;toast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å!');closeModal();wrkTab('prof',null);editWrkProf(currentResume);return}const r={id:'resp_'+Date.now(),vid,wid:UID,createdAt:new Date().toISOString()};await sbSet('responses',r.id,r);const v=await sbGet('vacancies',vid);if(v){await sendBot(v.eid,`üîî –ù–æ–≤—ã–π –æ—Ç–∫–ª–∏–∫!\n\nüë∑${wp.name}\nüîß${wp.specialty}\nüìû${wp.phone}\n\n–í–∞–∫–∞–Ω—Å–∏—è: ${v.specialty}`)}toast('–û—Ç–∫–ª–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω‚úÖ');closeModal()}

async function openCand(uid,num){const p=await sbGet('profiles',`wrk${num||1}_`+uid);if(!p)return;openModal(`<div style="font-family:Unbounded;font-size:16px;font-weight:700;margin-bottom:4px">${p.name}</div><div style="font-size:13px;color:var(--text2);margin-bottom:14px">${p.specialty}</div>${p.desiredSalary?`<div style="font-size:20px;font-weight:700;color:var(--green);margin-bottom:14px">–æ—Ç ${parseInt(p.desiredSalary).toLocaleString()} ‚ÇΩ</div>`:''}<div style="background:var(--bg);border-radius:10px;padding:12px;margin-bottom:14px">üìû ${p.phone}<br>üìä ${p.experience} –ª–µ—Ç<br>üìç ${p.region||'‚Äî'}</div>${p.about?`<div style="background:var(--bg);border-radius:10px;padding:12px;margin-bottom:14px">${p.about}</div>`:''}<a href="tel:${p.phone}" class="btn btn-green" style="text-decoration:none">üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å</a>`)}
async function openFavs(){openModal('<div style="font-family:Unbounded;font-size:17px;font-weight:700">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div><div class="empty"><div class="empty-ico">‚ù§Ô∏è</div><div class="empty-title">–ü—É—Å—Ç–æ</div></div>')}

function showSupport(){openModal(`<div style="font-family:Unbounded;font-size:17px;font-weight:700;margin-bottom:18px">üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞</div><form onsubmit="sendSupport(event)"><div class="fg"><label>–°–æ–æ–±—â–µ–Ω–∏–µ</label><textarea id="suppMsg" required></textarea></div><button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button></form>`)}
async function sendSupport(e){e.preventDefault();const msg=document.getElementById('suppMsg').value;await sendBot(ADMIN,`üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞\n\n–û—Ç: ${UNAME} (${UID})\n\n${msg}`);toast('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ‚úÖ');closeModal()}

async function goAdmin(){if(!IS_ADMIN)return;openModal(`<div style="font-family:Unbounded;font-size:17px;font-weight:700;margin-bottom:18px">üõ° –ê–¥–º–∏–Ω</div><div class="fg"><label>ID –∫–æ–º–ø–∞–Ω–∏–∏ –¥–ª—è –æ–¥–æ–±—Ä–µ–Ω–∏—è</label><input type="text" id="admApprove"></div><button class="btn btn-green btn-sm" onclick="admApprove()">–û–¥–æ–±—Ä–∏—Ç—å</button><div class="fg" style="margin-top:12px"><label>ID –∫–æ–º–ø–∞–Ω–∏–∏ –¥–ª—è –¥–æ—Ä–∞–±–æ—Ç–∫–∏</label><input type="text" id="admRevise"></div><div class="fg"><textarea id="admRevComment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..."></textarea></div><button class="btn btn-dark btn-sm" onclick="admRevise()">–ù–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É</button>`)}
async function admApprove(){const id=document.getElementById('admApprove').value;if(!id)return;const p=await sbGet('profiles','emp_'+id);if(!p){toast('–ù–µ –Ω–∞–π–¥–µ–Ω');return}p.moderationStatus='approved';p.moderationComment='';await sbSet('profiles','emp_'+id,p);await sendBot(id,'‚úÖ –í–∞—à–∞ –∫–æ–º–ø–∞–Ω–∏—è –æ–¥–æ–±—Ä–µ–Ω–∞!');toast('–û–¥–æ–±—Ä–µ–Ω–æ‚úÖ')}
async function admRevise(){const id=document.getElementById('admRevise').value;const comment=document.getElementById('admRevComment').value;if(!id||!comment)return;const p=await sbGet('profiles','emp_'+id);if(!p){toast('–ù–µ –Ω–∞–π–¥–µ–Ω');return}p.moderationStatus='revision';p.moderationComment=comment;await sbSet('profiles','emp_'+id,p);await sendBot(id,`‚úèÔ∏è –ù–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É\n\nüí¨ ${comment}`);toast('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ')}

function openModal(h){let m=document.getElementById('modal');if(!m){m=document.createElement('div');m.id='modal';m.className='modal';m.onclick=e=>{if(e.target===m)closeModal()};document.body.appendChild(m)}m.innerHTML=`<div class="modal-box">${h}</div>`;m.classList.remove('hidden')}
function closeModal(){const m=document.getElementById('modal');if(m)m.classList.add('hidden')}

document.addEventListener('DOMContentLoaded',()=>{loadTheme();document.getElementById('welcomeScreen').classList.remove('hidden');if(IS_ADMIN)document.getElementById('adminBtn').classList.remove('hidden')});
</script>
</body>
</html>
