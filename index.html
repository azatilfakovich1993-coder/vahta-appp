>${ava}<div class="profile-name">${p.name}</div><div class="profile-role">${p.specialty}</div></div>
    <div class="form-wrap">
      <div class="detail-section"><div class="detail-section-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
        <div class="detail-row"><span class="detail-ico">üìû</span><div class="detail-info"><div class="detail-label">–¢–µ–ª–µ—Ñ–æ–Ω</div><div class="detail-value">${p.phone}</div></div></div>
        <div class="detail-row"><span class="detail-ico">üìä</span><div class="detail-info"><div class="detail-label">–û–ø—ã—Ç</div><div class="detail-value">${p.experience} ${yrs(p.experience)} (${expRange(p.experience)})</div></div></div>
        <div class="detail-row"><span class="detail-ico">üìç</span><div class="detail-info"><div class="detail-label">–†–µ–≥–∏–æ–Ω</div><div class="detail-value">${p.region||'‚Äî'}</div></div></div>
        ${p.tg?`<div class="detail-row"><span class="detail-ico">‚úàÔ∏è</span><div class="detail-info"><div class="detail-label">Telegram</div><div class="detail-value">@${p.tg}</div></div></div>`:''}
      </div>
      ${p.about?`<div class="detail-section"><div class="detail-section-title">–û —Å–µ–±–µ</div><p style="font-size:14px;line-height:1.6;color:var(--text2)">${p.about}</p></div>`:''}
      ${p.docs?`<div class="detail-section"><div class="detail-section-title">–î–æ–∫—É–º–µ–Ω—Ç—ã</div><p style="font-size:14px;line-height:1.6;color:var(--text2)">${p.docs}</p></div>`:''}
      <div class="btn-row">
        <button class="btn btn-outline" onclick="showWrkProfileForm()">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
        <button class="btn btn-danger btn-sm" onclick="deleteWrkProfile()">üóë –£–¥–∞–ª–∏—Ç—å</button>
      </div>
    </div>`;
}
async function showWrkProfileForm(){
  const existing=await sbGet('profiles','wrk_'+UID);
  const specVal=existing?(SPECS.includes(existing.specialty)?existing.specialty:'custom'):'';
  const regVal=existing?.region||'';
  openModal(`<div class="modal-handle"></div><div class="modal-title">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</div>
    <form onsubmit="submitWrkProfile(event)"><div class="form-wrap">
      <div class="fg"><label>–§–æ—Ç–æ</label><div class="photo-upload-area" onclick="document.getElementById('wrkPhotoInput').click()"><img id="wrkPhotoPreview" style="width:70px;height:70px;border-radius:50%;object-fit:cover;margin:0 auto;display:${existing?.photo?'block':'none'};" src="${existing?.photo||''}"><div id="wrkPhotoPlaceholder" style="${existing?.photo?'display:none':''}">üì∑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</div><input type="file" id="wrkPhotoInput" accept="image/*" style="display:none" onchange="previewPhoto('wrkPhotoInput','wrkPhotoPreview','wrkPhotoPlaceholder')"></div></div>
      <div class="fg"><label>–§–ò–û<span class="req">*</span></label><input type="text" id="wpName" value="${existing?.name||''}" required></div>
      <div class="fg"><label>–¢–µ–ª–µ—Ñ–æ–Ω<span class="req">*</span></label><input type="tel" id="wpPhone" value="${existing?.phone||''}" required></div>
      <div class="fg"><label>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å<span class="req">*</span></label>
        <select id="wpSpec" required onchange="toggleWrkCustomSpec()">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
          ${SPECS.map(s=>`<option value="${s}" ${specVal===s?'selected':''}>${s}</option>`).join('')}
          <option value="custom" ${specVal==='custom'?'selected':''}>–î—Ä—É–≥–æ–µ</option>
        </select></div>
      <div class="fg ${specVal==='custom'?'':'hidden'}" id="wpSpecCustomWrap"><label>–£–∫–∞–∂–∏—Ç–µ<span class="req">*</span></label><input type="text" id="wpSpecCustom" value="${existing&&!SPECS.includes(existing.specialty)?existing.specialty:''}"></div>
      <div class="fg-row">
        <div class="fg"><label>–û–ø—ã—Ç (–ª–µ—Ç)<span class="req">*</span></label><input type="number" id="wpExp" value="${existing?.experience||0}" min="0" required></div>
        <div class="fg"><label>–†–µ–≥–∏–æ–Ω<span class="req">*</span></label>
          <select id="wpRegion" required>
            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
            ${REGIONS.map(r=>`<option value="${r}" ${regVal===r?'selected':''}>${r}</option>`).join('')}
          </select></div>
      </div>
      <div class="fg"><label>Telegram username</label><input type="text" id="wpTg" value="${existing?.tg||''}" placeholder="–±–µ–∑ @"></div>
      <div class="fg"><label>–û —Å–µ–±–µ<span class="req">*</span></label><textarea id="wpAbout" required>${existing?.about||''}</textarea></div>
      <div class="fg"><label>–î–æ–∫—É–º–µ–Ω—Ç—ã</label><textarea id="wpDocs">${existing?.docs||''}</textarea></div>
      <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div></form>`);
}
function toggleWrkCustomSpec(){document.getElementById('wpSpecCustomWrap').classList.toggle('hidden',document.getElementById('wpSpec').value!=='custom');}
async function submitWrkProfile(e){
  e.preventDefault();
  let spec=document.getElementById('wpSpec').value;if(spec==='custom')spec=document.getElementById('wpSpecCustom').value;
  const photo=await getPhotoData('wrkPhotoInput');
  const existing=await sbGet('profiles','wrk_'+UID);
  const p={uid:UID,name:document.getElementById('wpName').value,phone:document.getElementById('wpPhone').value,specialty:spec,experience:parseInt(document.getElementById('wpExp').value),region:document.getElementById('wpRegion').value,tg:document.getElementById('wpTg').value||TG_USERNAME||'',about:document.getElementById('wpAbout').value,docs:document.getElementById('wpDocs').value,photo:photo||existing?.photo};
  await sbSet('profiles','wrk_'+UID,p);
  closeModal();toast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úÖ');
  if(pendingVacancyId){const vid=pendingVacancyId;pendingVacancyId=null;setTimeout(()=>openVacancy(vid,'worker'),500);}
  else{loadWrkProfile();}
}
async function deleteWrkProfile(){if(!confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å?'))return;await sbDelete('profiles','wrk_'+UID);toast('–£–¥–∞–ª—ë–Ω');loadWrkProfile();}

// OPEN VACANCY
async function openVacancy(vid,viewAs){
  const v=await sbGet('vacancies',vid);if(!v)return;
  v.views=(v.views||0)+1;await sbSet('vacancies',vid,v);
  const profile=await sbGet('profiles','emp_'+v.eid);
  const rating=await sbGet('ratings','rating_'+v.eid)||{avg:0,cnt:0,reviews:[]};
  const allResp=await sbList('responses','resp_');
  const rc=allResp.filter(r=>r.vid===vid).length;
  const myResp=allResp.find(r=>r.vid===vid&&r.wid===UID);
  const favs=await loadFavs();
  const compAva=profile?.photo?`<img src="${profile.photo}" style="width:46px;height:46px;border-radius:50%;object-fit:cover">`:`<div style="width:46px;height:46px;border-radius:50%;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:22px">üè¢</div>`;
  let actions='';
  if(viewAs==='worker'){
    if(myResp)actions=`<button class="btn btn-outline" disabled>‚úÖ –í—ã –æ—Ç–∫–ª–∏–∫–Ω—É–ª–∏—Å—å</button>`;
    else actions=`<button class="btn btn-primary" onclick="sendResponse('${vid}')">üì© –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è</button>`;
    if(v.mgrPhone&&v.showPhone){
      actions+=`<div class="btn-row"><a href="tel:${v.mgrPhone}" class="btn btn-green" style="text-decoration:none">üìû ${v.mgrName||'–ü–æ–∑–≤–æ–Ω–∏—Ç—å'}</a>${v.allowTg&&v.mgrTg?`<a href="https://t.me/${v.mgrTg}" class="btn btn-blue" style="text-decoration:none" target="_blank">‚úàÔ∏è Telegram</a>`:''}</div>`;
    }
    actions+=`<button class="btn btn-outline btn-sm" style="margin-top:8px" onclick="reportVacancy('${vid}')">‚ö†Ô∏è –ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è</button>`;
  }else if(viewAs==='employer'){
    const isPaused=v.status==='paused';
    actions=`<div class="btn-row3"><button class="btn btn-outline btn-sm" onclick="showCreateVacancy('${vid}')">‚úèÔ∏è</button><button class="btn btn-warn btn-sm" onclick="pauseVacancy('${vid}')">${isPaused?'‚ñ∂Ô∏è':'‚è∏'}</button><button class="btn btn-danger btn-sm" onclick="deleteVacancy('${vid}')">üóë</button></div>`;
  }
  openModal(`<div class="modal-handle"></div>
    <div style="display:flex;gap:12px;align-items:start;margin-bottom:12px">
      ${compAva}
      <div style="flex:1">
        <div class="modal-title" style="font-size:15px;margin-bottom:2px">${v.specialty}${v.urgent?' üî•':''}</div>
        <div style="font-size:13px;font-weight:700;color:var(--text2);cursor:pointer" onclick="closeModal();openCompany('${v.eid}')">${v.companyName} ${v.verified?'‚úÖ':''}</div>
        ${rating.cnt?starsHtml(rating.avg,rating.cnt):''}
      </div>
      <button class="vcard-fav" onclick="toggleFav('v','${vid}',event)">${favs.vacancies.includes(vid)?'‚ù§Ô∏è':'ü§ç'}</button>
    </div>
    <div style="font-size:22px;font-weight:700;color:var(--green);margin-bottom:14px">${salStr(v.salFrom,v.salTo,v.hourlyRate)}</div>
    <div class="detail-section">
      <div class="detail-row"><span class="detail-ico">üìç</span><div class="detail-info"><div class="detail-label">–†–µ–≥–∏–æ–Ω</div><div class="detail-value">${v.region}</div></div></div>
      <div class="detail-row"><span class="detail-ico">üè¢</span><div class="detail-info"><div class="detail-label">–û–±—ä–µ–∫—Ç</div><div class="detail-value">${v.object}</div></div></div>
      <div class="detail-row"><span class="detail-ico">üìÖ</span><div class="detail-info"><div class="detail-label">–ì—Ä–∞—Ñ–∏–∫ –≤–∞—Ö—Ç—ã</div><div class="detail-value">${v.schedule}</div></div></div>
      ${v.workSchedule?`<div class="detail-row"><span class="detail-ico">‚è∞</span><div class="detail-info"><div class="detail-label">–ì—Ä–∞—Ñ–∏–∫ —Å–º–µ–Ω</div><div class="detail-value">${v.workSchedule}</div></div></div>`:''}
      <div class="detail-row"><span class="detail-ico">üë•</span><div class="detail-info"><div class="detail-label">–û—Ç–∫–ª–∏–∫–æ–≤ / –ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</div><div class="detail-value">${rc} / ${v.views||0}</div></div></div>
    </div>
    ${v.mgrName&&v.showPhone?`<div class="detail-section"><div class="detail-section-title">–ú–µ–Ω–µ–¥–∂–µ—Ä</div><div class="detail-row"><span class="detail-ico">üë§</span><div class="detail-info"><div class="detail-label">–§–ò–û</div><div class="detail-value">${v.mgrName}</div></div></div>${v.mgrPhone?`<div class="detail-row"><span class="detail-ico">üìû</span><div class="detail-info"><div class="detail-label">–¢–µ–ª–µ—Ñ–æ–Ω</div><div class="detail-value">${v.mgrPhone}</div></div></div>`:''}</div>`:''}
    ${v.desc?`<div class="detail-section"><div class="detail-section-title">–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è</div><p style="font-size:14px;line-height:1.6;color:var(--text2)">${v.desc}</p></div>`:''}
    ${v.housing?`<div class="detail-section"><div class="detail-section-title">–£—Å–ª–æ–≤–∏—è</div>${v.housing?`<div class="detail-row"><span class="detail-ico">üè†</span><div class="detail-info"><div class="detail-value">${v.housing}</div></div></div>`:''}</div>`:''}
    ${viewAs==='worker'?`<div class="detail-section"><div class="detail-section-title">–û—Ü–µ–Ω–∏—Ç—å —Ä–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è</div><div class="stars-row" id="ratingStars">${[1,2,3,4,5].map(i=>`<span class="star" onclick="rateEmployer('${v.eid}',${i})">‚òÜ</span>`).join('')}</div></div>`:''}
    <div style="padding-bottom:8px">${actions}</div>`);
}

// OPEN CANDIDATE
async function openCandidate(uid){
  const p=await sbGet('profiles','wrk_'+uid);if(!p)return;
  const ava=p.photo?`<img src="${p.photo}" style="width:70px;height:70px;border-radius:50%;object-fit:cover;margin:0 auto;display:block;border:3px solid var(--accent)">`:`<div class="avatar-placeholder" style="margin:0 auto">üë∑</div>`;
  const tgLink=p.tg?`<a href="https://t.me/${p.tg}" class="btn btn-blue" style="text-decoration:none" target="_blank">‚úàÔ∏è Telegram</a>`:'';
  openModal(`<div class="modal-handle"></div>
    <div style="text-align:center;margin-bottom:14px">${ava}<div class="modal-title" style="margin-top:10px">${p.name}</div><div style="font-size:13px;font-weight:700;color:var(--text2)">${p.specialty}</div></div>
    <div class="detail-section">
      <div class="detail-row"><span class="detail-ico">üìû</span><div class="detail-info"><div class="detail-label">–¢–µ–ª–µ—Ñ–æ–Ω</div><div class="detail-value">${p.phone}</div></div></div>
      <div class="detail-row"><span class="detail-ico">üìä</span><div class="detail-info"><div class="detail-label">–û–ø—ã—Ç</div><div class="detail-value">${p.experience} ${yrs(p.experience)}</div></div></div>
      <div class="detail-row"><span class="detail-ico">üìç</span><div class="detail-info"><div class="detail-label">–†–µ–≥–∏–æ–Ω</div><div class="detail-value">${p.region||'‚Äî'}</div></div></div>
      ${p.tg?`<div class="detail-row"><span class="detail-ico">‚úàÔ∏è</span><div class="detail-info"><div class="detail-label">Telegram</div><div class="detail-value">@${p.tg}</div></div></div>`:''}
    </div>
    ${p.about?`<div class="detail-section"><div class="detail-section-title">–û —Å–µ–±–µ</div><p style="font-size:14px;line-height:1.6;color:var(--text2)">${p.about}</p></div>`:''}
    ${p.docs?`<div class="detail-section"><div class="detail-section-title">–î–æ–∫—É–º–µ–Ω—Ç—ã</div><p style="font-size:14px;line-height:1.6;color:var(--text2)">${p.docs}</p></div>`:''}
    <div class="btn-row"><a href="tel:${p.phone}" class="btn btn-green" style="text-decoration:none">üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å</a>${tgLink}</div>
    ${ROLE==='employer'?`<button class="btn btn-primary" style="margin-top:10px" onclick="sendOffer('${uid}')">üì© –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>`:''}
    <div style="height:8px"></div>`);
}

// OPEN COMPANY
async function openCompany(eid){
  const profile=await sbGet('profiles','emp_'+eid);if(!profile)return;
  const rating=await sbGet('ratings','rating_'+eid)||{avg:0,cnt:0,reviews:[]};
  const ava=profile.photo?`<img src="${profile.photo}" style="width:70px;height:70px;border-radius:50%;object-fit:cover;margin:0 auto;display:block;border:3px solid var(--accent)">`:`<div class="avatar-placeholder" style="margin:0 auto">üè¢</div>`;
  openModal(`<div class="modal-handle"></div>
    <div style="text-align:center;margin-bottom:14px">${ava}<div class="modal-title" style="margin-top:10px">${profile.companyName} ${isVerified(profile)?'‚úÖ':''}</div><div style="font-size:13px;color:var(--text2)">${profile.sphere||'–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ'}</div>${rating.cnt?`<div style="margin-top:8px">${starsHtml(rating.avg,rating.cnt)}</div>`:''}</div>
    <div class="detail-section"><div class="detail-section-title">–†–µ–∫–≤–∏–∑–∏—Ç—ã</div>
      <div class="detail-row"><span class="detail-ico">üìã</span><div class="detail-info"><div class="detail-label">–ò–ù–ù</div><div class="detail-value">${profile.inn||'‚Äî'}</div></div></div>
      <div class="detail-row"><span class="detail-ico">üìç</span><div class="detail-info"><div class="detail-label">–ê–¥—Ä–µ—Å</div><div class="detail-value">${profile.address||'‚Äî'}</div></div></div>
    </div>
    ${profile.about?`<div class="detail-section"><div class="detail-section-title">–û –∫–æ–º–ø–∞–Ω–∏–∏</div><p style="font-size:14px;line-height:1.6;color:var(--text2)">${profile.about}</p></div>`:''}
    ${rating.reviews&&rating.reviews.length?`<div class="detail-section"><div class="detail-section-title">–û—Ç–∑—ã–≤—ã —Å–æ–∏—Å–∫–∞—Ç–µ–ª–µ–π</div>${rating.reviews.slice(0,5).map(rev=>`<div class="review-card"><div class="review-header"><span class="review-author">${rev.name}</span><span class="review-date">${timeAgo(rev.date)}</span></div><div class="review-stars">${'‚≠ê'.repeat(rev.rating)}</div>${rev.comment?`<div class="review-text">${rev.comment}</div>`:''}</div>`).join('')}</div>`:''}
    <div style="height:8px"></div>`);
}

// RESPONSES
async function sendResponse(vid){
  const wp=await sbGet('profiles','wrk_'+UID);
  if(!wp){pendingVacancyId=vid;toast('–°–Ω–∞—á–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å');closeModal();wrkTab('profile',null);return;}
  const r={id:'resp_'+Date.now(),vid,wid:UID,viewed:false,opened:false,createdAt:new Date().toISOString()};
  await sbSet('responses',r.id,r);
  const vac=await sbGet('vacancies',vid);
  if(vac){
    const kb={inline_keyboard:[[{text:'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å',url:`tel:${wp.phone}`},{text:'‚úàÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å',url:`https://t.me/${wp.tg||''}`}]]};
    await sendBotMsg(vac.eid,`üîî –ù–æ–≤—ã–π –æ—Ç–∫–ª–∏–∫!\n\nüë∑ ${wp.name}\nüîß ${wp.specialty}\nüìç ${wp.region||'‚Äî'}\nüìû ${wp.phone}\n\n–í–∞–∫–∞–Ω—Å–∏—è: ${vac.specialty}`,kb);
  }
  toast('–û—Ç–∫–ª–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! ‚úÖ');closeModal();
}
async function sendOffer(wid){
  const wp=await sbGet('profiles','wrk_'+wid);
  const ep=await sbGet('profiles','emp_'+UID);
  if(!wp||!ep)return;
  const kb={inline_keyboard:[[{text:'üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å',url:`tel:${ep.phone||''}`},{text:'‚úàÔ∏è Telegram',url:`https://t.me/${TG_USERNAME||''}`}]]};
  await sendBotMsg(wid,`üíº –í–∞–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ!\n\nüè¢ ${ep.companyName}\nüìû ${ep.phone||'‚Äî'}\n\n–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ`,kb);
  toast('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! ‚úÖ');closeModal();
}
async function reportVacancy(vid){const v=await sbGet('vacancies',vid);if(!v)return;await sendBotMsg(ADMIN_ID,`‚ö†Ô∏è –ñ–∞–ª–æ–±–∞!\n\nID: ${vid}\n${v.companyName}\n${v.specialty}\n–û—Ç: ${UID}`);toast('–ñ–∞–ª–æ–±–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞');closeModal();}
async function sendBotMsg(userId,text,replyMarkup){try{const body={chat_id:userId,text,parse_mode:'HTML'};if(replyMarkup)body.reply_markup=replyMarkup;await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)})}catch(e){}}

// RATING
async function rateEmployer(eid,score){
  document.querySelectorAll('#ratingStars .star').forEach((s,i)=>{s.textContent=i<score?'‚≠ê':'‚òÜ';});
  const comment=prompt('–û—Å—Ç–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):');
  let r=await sbGet('ratings','rating_'+eid)||{avg:0,cnt:0,sum:0,reviews:[]};
  r.sum=(r.sum||0)+score;r.cnt++;r.avg=r.sum/r.cnt;
  if(!r.reviews)r.reviews=[];
  r.reviews.unshift({name:UNAME,rating:score,comment:comment||'',date:new Date().toISOString()});
  await sbSet('ratings','rating_'+eid,r);
  toast(`–û—Ü–µ–Ω–∫–∞ ${score}‚≠ê —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!`);
}

// FAVS
async function openFavs(){
  let html='<div class="modal-handle"></div><div class="modal-title">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div>';
  const f=await loadFavs();let has=false;
  if(f.vacancies.length){
    html+='<div class="detail-section-title" style="margin:14px 0 8px">–í–∞–∫–∞–Ω—Å–∏–∏</div>';
    for(const vid of f.vacancies){const v=await sbGet('vacancies',vid);if(v){has=true;html+=`<div class="vcard" onclick="closeModal();openVacancy('${v.id}','${ROLE}')"><div class="vcard-top"><div class="vcard-title">${v.specialty}</div><div class="vcard-company">${v.companyName}</div><div class="vcard-salary">${salStr(v.salFrom,v.salTo,v.hourlyRate)}</div></div></div>`;}}
  }
  if(f.candidates.length&&ROLE==='employer'){
    html+='<div class="detail-section-title" style="margin:14px 0 8px">–ö–∞–Ω–¥–∏–¥–∞—Ç—ã</div>';
    for(const cid of f.candidates){const c=await sbGet('profiles','wrk_'+cid);if(c){has=true;html+=`<div class="vcard" onclick="closeModal();openCandidate('${c.uid}')"><div class="vcard-top"><div class="vcard-title">${c.name}</div><div class="vcard-company">${c.specialty}</div></div></div>`;}}
  }
  if(!has)html+=`<div class="empty"><div class="empty-ico">‚ù§Ô∏è</div><div class="empty-title">–ü—É—Å—Ç–æ</div></div>`;
  html+='<div style="height:20px"></div>';
  openModal(html);
}

// SUPPORT
function showSupport(){
  openModal(`<div class="modal-handle"></div><div class="modal-title">üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
    <form onsubmit="submitSupport(event)"><div class="form-wrap">
      <div class="fg"><label>–°–æ–æ–±—â–µ–Ω–∏–µ<span class="req">*</span></label><textarea id="supportMsg" required placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É –∏–ª–∏ –≤–æ–ø—Ä–æ—Å..."></textarea></div>
      <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div></form>`);
}
async function submitSupport(e){
  e.preventDefault();
  const msg=document.getElementById('supportMsg').value;
  await sendBotMsg(ADMIN_ID,`üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ç ${ROLE==='employer'?'üëî –†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è':'üë∑ –°–æ–∏—Å–∫–∞—Ç–µ–ª—è'}\n\nID: ${UID}\n–ò–º—è: ${UNAME}\n\n–°–æ–æ–±—â–µ–Ω–∏–µ:\n${msg}`);
  closeModal();toast('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! ‚úÖ');
}

// ADMIN
async function goAdmin(){
  if(!IS_ADMIN){toast('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞');return;}
  openModal(`<div class="modal-handle"></div><div class="modal-title">üõ° –ê–¥–º–∏–Ω</div>
    <div class="form-wrap">
      <div style="background:var(--purple);color:white;padding:14px;border-radius:10px;margin-bottom:14px">
        <div style="font-weight:700;margin-bottom:8px">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
        <div id="adminStats" style="font-size:13px;opacity:0.9">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      </div>
      <div style="margin-bottom:14px">
        <div style="font-size:13px;font-weight:700;margin-bottom:10px">üóë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
        <div class="fg"><label>ID –≤–∞–∫–∞–Ω—Å–∏–∏</label><input type="text" id="adminDelVac" placeholder="vac_..."></div>
        <button class="btn btn-danger btn-sm" onclick="adminDeleteVac()">–£–¥–∞–ª–∏—Ç—å</button>
        <div class="fg" style="margin-top:12px"><label>ID –ø—Ä–æ—Ñ–∏–ª—è</label><input type="text" id="adminDelProf" placeholder="wrk_... –∏–ª–∏ emp_..."></div>
        <button class="btn btn-danger btn-sm" onclick="adminDeleteProf()">–£–¥–∞–ª–∏—Ç—å</button>
        <div class="fg" style="margin-top:12px"><label>ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label><input type="text" id="adminBanId"></div>
        <button class="btn btn-warn btn-sm" onclick="adminBan()">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
      </div>
      <div style="margin-bottom:14px">
        <div style="font-size:13px;font-weight:700;margin-bottom:10px">üì¢ –†–∞—Å—Å—ã–ª–∫–∞</div>
        <div class="fg"><textarea id="adminMsgText" placeholder="–¢–µ–∫—Å—Ç..."></textarea></div>
        <div class="btn-row">
          <button class="btn btn-blue btn-sm" onclick="adminBroadcast('wrk')">üë∑ –°–æ–∏—Å–∫–∞—Ç–µ–ª—è–º</button>
          <button class="btn btn-dark btn-sm" onclick="adminBroadcast('emp')">üëî –†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è–º</button>
        </div>
      </div>
    </div>`);
  loadAdminStats();
}
async function loadAdminStats(){
  const vacs=await sbList('vacancies','vac_');
  const profs=await sbList('profiles','wrk_');
  const emps=await sbList('profiles','emp_');
  const resp=await sbList('responses','resp_');
  document.getElementById('adminStats').innerHTML=`üíº –í–∞–∫–∞–Ω—Å–∏–π: <b>${vacs.length}</b><br>üë∑ –°–æ–∏—Å–∫–∞—Ç–µ–ª–µ–π: <b>${profs.length}</b><br>üè¢ –†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–µ–π: <b>${emps.length}</b><br>üì© –û—Ç–∫–ª–∏–∫–æ–≤: <b>${resp.length}</b>`;
}
async function adminDeleteVac(){const id=document.getElementById('adminDelVac').value.trim();if(!id)return;await sbDelete('vacancies',id);toast('–£–¥–∞–ª–µ–Ω–æ');}
async function adminDeleteProf(){const id=document.getElementById('adminDelProf').value.trim();if(!id)return;await sbDelete('profiles',id);toast('–£–¥–∞–ª–µ–Ω–æ');}
async function adminBan(){const id=document.getElementById('adminBanId').value.trim();if(!id)return;await sbSet('blacklist','bl_'+id,{uid:id,banned:true,bannedAt:new Date().toISOString()});await sendBotMsg(id,'‚õî –ê–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–µ–π Good_–í–∞—Ö—Ç–∞.');toast('–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');}
async function adminBroadcast(role){
  const text=document.getElementById('adminMsgText').value.trim();if(!text){toast('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç');return;}
  const profiles=await sbList('profiles',role+'_');let sent=0;
  for(const p of profiles){if(p.uid){await sendBotMsg(p.uid,`üì¢ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç Good_–í–∞—Ö—Ç–∞:\n\n${text}`);sent++;await new Promise(r=>setTimeout(r,100));}}
  toast(`–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${sent}`);
}
async function pauseVacancy(vid){const v=await sbGet('vacancies',vid);if(!v)return;v.status=v.status==='paused'?'active':'paused';await sbSet('vacancies',vid,v);closeModal();toast(v.status==='paused'?'–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞':'–í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∞ ‚úÖ');loadEmpVacancies();}
async function deleteVacancy(vid){if(!confirm('–£–¥–∞–ª–∏—Ç—å?'))return;await sbDelete('vacancies',vid);closeModal();toast('–£–¥–∞–ª–µ–Ω–æ');loadEmpVacancies();}

// MODAL
function openModal(html){let m=document.getElementById('globalModal');if(!m){m=document.createElement('div');m.id='globalModal';m.className='modal';m.onclick=e=>{if(e.target===m)closeModal();};document.body.appendChild(m);}m.innerHTML=`<div class="modal-box">${html}</div>`;m.classList.remove('hidden');}
function closeModal(){const m=document.getElementById('globalModal');if(m)m.classList.add('hidden');}

// INIT
document.addEventListener('DOMContentLoaded',()=>{
  loadTheme();
  document.getElementById('welcomeScreen').classList.remove('hidden');
  loadWelcomeNotifs();
});
</script>
</body>
</html>
