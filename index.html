<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Good_–í–∞—Ö—Ç–∞</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@700;900&family=Manrope:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{--c1:#0f172a;--c2:#1e293b;--accent:#f97316;--green:#16a34a;--red:#ef4444;--blue:#2563eb;--gold:#f59e0b;--bg:#f8fafc;--card:#fff;--text:#0f172a;--text2:#475569;--text3:#94a3b8;--border:#e2e8f0;}
body.dark{--bg:#0f172a;--card:#1e293b;--text:#f1f5f9;--text2:#cbd5e1;--border:#334155;}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:Manrope,sans-serif;background:var(--bg);color:var(--text);transition:all .3s;}
.hidden{display:none!important;}
.topbar{background:linear-gradient(135deg,var(--c1),var(--c2));padding:14px 16px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:200;}
.topbar-back{background:rgba(255,255,255,.1);border:none;color:#fff;width:36px;height:36px;border-radius:50%;font-size:18px;cursor:pointer;}
.topbar-title{font-family:Unbounded,sans-serif;font-size:15px;font-weight:900;color:#fff;}
.topbar-title span{color:var(--accent);}
.topbar-role{background:rgba(255,255,255,.15);padding:3px 10px;border-radius:12px;font-size:11px;color:#fff;margin-top:2px;}
.topbar-btn{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.15);color:#fff;padding:7px 12px;border-radius:20px;font-size:13px;font-weight:600;cursor:pointer;}
.topbar-btn .cnt{background:var(--red);color:#fff;font-size:10px;padding:1px 5px;border-radius:8px;font-weight:700;}
.hero{background:var(--card);padding:32px 20px 24px;text-align:center;border-bottom:1px solid var(--border);}
.hero-logo{font-family:Unbounded,sans-serif;font-size:26px;font-weight:900;margin-bottom:6px;}
.hero-logo span{color:var(--accent);}
.theme-btns{display:flex;gap:8px;justify-content:center;margin-top:16px;}
.theme-btn{padding:8px 16px;border-radius:20px;border:2px solid var(--border);background:var(--card);color:var(--text2);font-size:12px;font-weight:600;cursor:pointer;}
.theme-btn.active{background:var(--accent);color:#fff;border-color:var(--accent);}
.role-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:20px 16px;}
.role-card{background:var(--card);border-radius:16px;padding:20px;text-align:center;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,.08);}
.role-card-ico{font-size:40px;margin-bottom:10px;}
.role-card-title{font-family:Unbounded,sans-serif;font-size:13px;font-weight:700;margin-bottom:5px;}
.role-card-desc{font-size:11px;color:var(--text2);}
.tabs-wrap{background:var(--card);border-bottom:1px solid var(--border);display:flex;position:sticky;top:58px;z-index:100;}
.tab-btn{flex:1;padding:13px 6px;background:none;border:none;color:var(--text3);font-size:12px;font-weight:700;cursor:pointer;border-bottom:3px solid transparent;position:relative;}
.tab-btn.active{color:var(--accent);border-bottom-color:var(--accent);}
.tab-btn .badge{position:absolute;top:8px;right:6px;background:var(--red);color:#fff;font-size:9px;padding:1px 4px;border-radius:6px;}
.search-bar{padding:12px 16px;background:var(--card);border-bottom:1px solid var(--border);}
.search-input{width:100%;padding:11px 42px 11px 14px;border:2px solid var(--border);border-radius:12px;font-size:14px;background:var(--card);color:var(--text);}
.filter-btn{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:var(--accent);border:none;color:#fff;width:28px;height:28px;border-radius:8px;cursor:pointer;}
.filter-panel{background:var(--bg);border-radius:12px;padding:12px;margin-top:8px;}
.fchip{padding:6px 12px;border-radius:20px;background:var(--card);border:2px solid var(--border);font-size:12px;font-weight:600;cursor:pointer;color:var(--text2);margin:4px;}
.fchip.on{background:var(--accent);color:#fff;border-color:var(--accent);}
.list-wrap{padding:12px 16px 90px;}
.vcard{background:var(--card);border-radius:14px;margin-bottom:12px;box-shadow:0 2px 8px rgba(0,0,0,.08);cursor:pointer;}
.vcard-top{padding:14px;}
.vcard-head{display:flex;justify-content:space-between;margin-bottom:6px;}
.vcard-title{font-family:Unbounded,sans-serif;font-size:13px;font-weight:700;flex:1;}
.vcard-fav{background:none;border:none;font-size:22px;cursor:pointer;}
.vcard-company{font-size:13px;color:var(--text2);margin-bottom:6px;font-weight:700;cursor:pointer;}
.vcard-company:hover{text-decoration:underline;}
.vcard-salary{font-size:19px;font-weight:700;color:var(--green);margin-bottom:8px;}
.vcard-tags{display:flex;flex-wrap:wrap;gap:5px;}
.vtag{background:var(--bg);padding:4px 9px;border-radius:7px;font-size:11px;font-weight:600;}
.vtag-blue{background:#dbeafe;color:#1d4ed8;}
.vtag-green{background:#dcfce7;color:#15803d;}
.vtag-orange{background:#fff7ed;color:#c2410c;}
.vtag-red{background:#fee2e2;color:#991b1b;}
.vcard-footer{padding:9px 14px;background:var(--bg);display:flex;justify-content:space-between;font-size:11px;color:var(--text3);}
.btn{padding:13px 20px;border-radius:12px;font-size:14px;font-weight:700;cursor:pointer;border:none;width:100%;text-align:center;}
.btn-primary{background:linear-gradient(135deg,var(--accent),#fb923c);color:#fff;}
.btn-green{background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff;}
.btn-blue{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;}
.btn-outline{background:transparent;border:2px solid var(--border);color:var(--text);}
.btn-danger{background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;}
.btn-sm{padding:9px 14px;font-size:12px;}
.btn-row{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px;}
.fab{position:fixed;bottom:80px;right:16px;width:54px;height:54px;border-radius:50%;background:linear-gradient(135deg,var(--accent),#fb923c);color:#fff;border:none;font-size:28px;box-shadow:0 4px 16px rgba(249,115,22,.4);cursor:pointer;z-index:50;}
.support-btn{position:fixed;bottom:150px;right:16px;width:54px;height:54px;border-radius:50%;background:var(--blue);color:#fff;border:none;font-size:24px;box-shadow:0 4px 16px rgba(59,130,246,.4);cursor:pointer;z-index:49;}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-top:1px solid var(--border);display:flex;z-index:150;}
.bnav-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;padding:9px 6px;background:none;border:none;color:var(--text3);font-size:10px;font-weight:600;cursor:pointer;position:relative;}
.bnav-item.active{color:var(--accent);}
.bnav-ico{font-size:22px;}
.bnav-cnt{position:absolute;top:5px;right:calc(50% - 20px);background:var(--red);color:#fff;font-size:9px;padding:1px 5px;border-radius:8px;}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:500;display:flex;align-items:flex-end;}
.modal-box{background:var(--card);border-radius:22px 22px 0 0;width:100%;max-height:92vh;overflow-y:auto;padding:18px 18px 40px;}
.modal-title{font-family:Unbounded,sans-serif;font-size:17px;font-weight:700;margin-bottom:4px;}
.fg{margin-bottom:16px;}
.fg label{display:block;font-size:13px;font-weight:700;margin-bottom:6px;}
.fg input,.fg select,.fg textarea{width:100%;padding:11px 13px;border:2px solid var(--border);border-radius:10px;font-size:14px;background:var(--card);color:var(--text);}
.fg textarea{min-height:85px;}
.toggle-row{display:flex;align-items:center;justify-content:space-between;padding:13px;background:var(--bg);border-radius:10px;margin-bottom:14px;}
.toggle{width:46px;height:24px;background:var(--border);border-radius:12px;border:none;cursor:pointer;position:relative;}
.toggle::after{content:'';position:absolute;width:18px;height:18px;background:#fff;border-radius:50%;top:3px;left:3px;transition:transform .2s;}
.toggle.on{background:var(--green);}
.toggle.on::after{transform:translateX(22px);}
.empty{text-align:center;padding:48px 20px;}
.empty-ico{font-size:52px;margin-bottom:12px;opacity:.35;}
.empty-title{font-family:Unbounded,sans-serif;font-size:15px;font-weight:700;margin-bottom:7px;}
.toast{position:fixed;top:20px;left:50%;transform:translateX(-50%);background:var(--c1);color:#fff;padding:11px 20px;border-radius:12px;font-size:13px;font-weight:600;z-index:9999;animation:toastIn .25s ease;}
@keyframes toastIn{from{transform:translate(-50%,-16px);opacity:0;}to{transform:translate(-50%,0);opacity:1;}}
.loading{text-align:center;padding:36px;}
.spin{width:30px;height:30px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 10px;}
@keyframes spin{to{transform:rotate(360deg);}}
</style>
</head>
<body>
<div id="app">
<div id="welcomeScreen">
<div class="hero">
<div class="hero-logo">Good_<span>–í–∞—Ö—Ç–∞</span></div>
<div style="font-size:14px;color:var(--text2);margin-bottom:12px">–†–∞–±–æ—Ç–∞ –º–µ—á—Ç—ã ‚Äî –Ω–∞ –≤–∞—Ö—Ç–µ!</div>
<div class="theme-btns">
<button class="theme-btn active" onclick="setTheme('light')">‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è</button>
<button class="theme-btn" onclick="setTheme('dark')">üåô –¢—ë–º–Ω–∞—è</button>
</div>
</div>
<div id="welcomeNotifs" style="padding:16px"></div>
<div class="role-grid">
<div class="role-card" onclick="goRole('employer')">
<div class="role-card-ico">üëî</div>
<div class="role-card-title">–†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å</div>
<div class="role-card-desc">–ù–∞–π—Ç–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤</div>
</div>
<div class="role-card" onclick="goRole('worker')">
<div class="role-card-ico">üë∑</div>
<div class="role-card-title">–°–æ–∏—Å–∫–∞—Ç–µ–ª—å</div>
<div class="role-card-desc">–ù–∞–π—Ç–∏ —Ä–∞–±–æ—Ç—É</div>
</div>
</div>
</div>

<div id="employerScreen" class="hidden">
<div class="topbar">
<div style="display:flex;align-items:center;gap:10px">
<button class="topbar-back" onclick="goWelcome()">‚Üê</button>
<div>
<div class="topbar-title">Good_<span>–í–∞—Ö—Ç–∞</span></div>
<div class="topbar-role">üëî –†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—å</div>
</div>
</div>
<button class="topbar-btn" onclick="openFavs()">‚ù§Ô∏è <span class="cnt" id="empFavCnt" style="display:none">0</span></button>
</div>
<div class="tabs-wrap">
<button class="tab-btn active" onclick="empTab('vac',this)">–í–∞–∫–∞–Ω—Å–∏–∏</button>
<button class="tab-btn" onclick="empTab('cand',this)">–ö–∞–Ω–¥–∏–¥–∞—Ç—ã</button>
<button class="tab-btn" onclick="empTab('in',this)">–í—Ö–æ–¥—è—â–∏–µ<span class="badge hidden" id="inBadge">0</span></button>
<button class="tab-btn" onclick="empTab('prof',this)">–ü—Ä–æ—Ñ–∏–ª—å</button>
</div>
<div id="empVacTab"><div class="list-wrap" id="empVacList"></div></div>
<div id="empCandTab" class="hidden">
<div class="search-bar" style="position:relative">
<input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫..." id="candSearch">
<button class="filter-btn" onclick="toggleFilters('cand')">‚öô</button>
<div id="candFilters" class="filter-panel hidden"></div>
</div>
<div class="list-wrap" id="candList"></div>
</div>
<div id="empInTab" class="hidden"><div class="list-wrap" id="inList"></div></div>
<div id="empProfTab" class="hidden"><div id="empProfView"></div></div>
<button class="fab" onclick="createVac()">+</button>
<button class="support-btn" onclick="showSupport()">üí¨</button>
<div class="bottom-nav">
<button class="bnav-item active" onclick="empTab('vac',this)"><span class="bnav-ico">üíº</span><span>–í–∞–∫–∞–Ω—Å–∏–∏</span></button>
<button class="bnav-item" onclick="openFavs()"><span class="bnav-ico">‚ù§Ô∏è</span><span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span><span class="bnav-cnt" id="empFavBadge" style="display:none">0</span></button>
<button class="bnav-item" onclick="empTab('prof',this)"><span class="bnav-ico">üë§</span><span>–ü—Ä–æ—Ñ–∏–ª—å</span></button>
</div>
</div>

<div id="workerScreen" class="hidden">
<div class="topbar">
<div style="display:flex;align-items:center;gap:10px">
<button class="topbar-back" onclick="goWelcome()">‚Üê</button>
<div>
<div class="topbar-title">Good_<span>–í–∞—Ö—Ç–∞</span></div>
<div class="topbar-role">üë∑ –°–æ–∏—Å–∫–∞—Ç–µ–ª—å</div>
</div>
</div>
<button class="topbar-btn" onclick="openFavs()">‚ù§Ô∏è <span class="cnt" id="wrkFavCnt" style="display:none">0</span></button>
</div>
<div class="tabs-wrap">
<button class="tab-btn active" onclick="wrkTab('vac',this)">–í–∞–∫–∞–Ω—Å–∏–∏</button>
<button class="tab-btn" onclick="wrkTab('resp',this)">–ú–æ–∏ –æ—Ç–∫–ª–∏–∫–∏<span class="badge hidden" id="respBadge">0</span></button>
<button class="tab-btn" onclick="wrkTab('prof',this)">–ü—Ä–æ—Ñ–∏–ª—å</button>
</div>
<div id="wrkVacTab">
<div class="search-bar" style="position:relative">
<input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫..." id="vacSearch">
<button class="filter-btn" onclick="toggleFilters('vac')">‚öô</button>
<div id="vacFilters" class="filter-panel hidden"></div>
</div>
<div class="list-wrap" id="vacList"></div>
</div>
<div id="wrkRespTab" class="hidden"><div class="list-wrap" id="respList"></div></div>
<div id="wrkProfTab" class="hidden"><div id="wrkProfView"></div></div>
<button class="support-btn" onclick="showSupport()">üí¨</button>
<div class="bottom-nav">
<button class="bnav-item active" onclick="wrkTab('vac',this)"><span class="bnav-ico">üíº</span><span>–í–∞–∫–∞–Ω—Å–∏–∏</span></button>
<button class="bnav-item" onclick="openFavs()"><span class="bnav-ico">‚ù§Ô∏è</span><span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span><span class="bnav-cnt" id="wrkFavBadge" style="display:none">0</span></button>
<button class="bnav-item" onclick="wrkTab('prof',this)"><span class="bnav-ico">üë§</span><span>–ü—Ä–æ—Ñ–∏–ª—å</span></button>
</div>
</div>
</div>

<script>
const tg=window.Telegram?.WebApp;if(tg){tg.ready();tg.expand();}
const BOT='8406340321:AAE6pjKfFflkF4V2peKKWZ6-vPljslWZjlA';
const SB_URL='https://zutiselchauekvvoirgw.supabase.co';
const SB_KEY='sb_publishable__IqzaQ_ICdfryInqnfmRZg_KK_aFton';
const ADMIN='805705211';
const UID=String(tg?.initDataUnsafe?.user?.id||'demo_'+Math.random().toString(36).slice(2,8));
const UNAME=tg?.initDataUnsafe?.user?.first_name||'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
const TG_USER=tg?.initDataUnsafe?.user?.username||null;
const IS_ADMIN=UID===ADMIN;
let ROLE=null,pendingVac=null,allVacs=[],allCands=[];
const SPECS=['–°–≤–∞—Ä—â–∏–∫','–ú–æ–Ω—Ç–∞–∂–Ω–∏–∫','–≠–ª–µ–∫—Ç—Ä–∏–∫','–°–ª–µ—Å–∞—Ä—å','–¢–æ–∫–∞—Ä—å','–ú–∞–ª—è—Ä','–®—Ç—É–∫–∞—Ç—É—Ä','–ö–∞–º–µ–Ω—â–∏–∫','–î—Ä—É–≥–æ–µ'];
const SCHEDS=['15/15','30/30','45/15','60/30','2/2','–î—Ä—É–≥–æ–π'];
const REGIONS=['–ú–æ—Å–∫–≤–∞','–°–ü–±','–¢—é–º–µ–Ω—Å–∫–∞—è','–•–ú–ê–û','–Ø–ù–ê–û','–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π','–ò—Ä–∫—É—Ç—Å–∫–∞—è','–Ø–∫—É—Ç–∏—è','–î—Ä—É–≥–æ–π'];

async function sb(t,i){try{const r=await fetch(`${SB_URL}/rest/v1/${t}?id=eq.${i}&select=data`,{headers:{apikey:SB_KEY,Authorization:'Bearer '+SB_KEY}});const d=await r.json();return d?.[0]?.data||null}catch{return null}}
async function sbSet(t,i,d){try{await fetch(`${SB_URL}/rest/v1/${t}`,{method:'POST',headers:{apikey:SB_KEY,Authorization:'Bearer '+SB_KEY,'Content-Type':'application/json',Prefer:'resolution=merge-duplicates'},body:JSON.stringify({id:i,data:d})})}catch{}}
async function sbList(t,p){try{const r=await fetch(`${SB_URL}/rest/v1/${t}?id=like.${p}%&select=data&order=id.desc`,{headers:{apikey:SB_KEY,Authorization:'Bearer '+SB_KEY}});const d=await r.json();return Array.isArray(d)?d.map(x=>x.data).filter(Boolean):[]}catch{return[]}}
async function sbDel(t,i){try{await fetch(`${SB_URL}/rest/v1/${t}?id=eq.${i}`,{method:'DELETE',headers:{apikey:SB_KEY,Authorization:'Bearer '+SB_KEY}})}catch{}}

async function loadFavs(){return await sb('favorites','favs_'+UID)||{vacancies:[],candidates:[]}}
async function saveFavs(f){await sbSet('favorites','favs_'+UID,f);updateFavUI(f)}
function updateFavUI(f){const c=f.vacancies.length+f.candidates.length;['empFavCnt','wrkFavCnt'].forEach(i=>{const e=document.getElementById(i);if(e){e.textContent=c;e.style.display=c>0?'inline':'none'}});['empFavBadge','wrkFavBadge'].forEach(i=>{const e=document.getElementById(i);if(e){e.textContent=c;e.style.display=c>0?'inline':'none'}})}
async function toggleFav(type,id,e){if(e)e.stopPropagation();const f=await loadFavs();const l=type==='v'?f.vacancies:f.candidates;const i=l.indexOf(id);if(i>-1){l.splice(i,1);toast('–£–¥–∞–ª–µ–Ω–æ')}else{l.push(id);toast('‚ù§Ô∏è –î–æ–±–∞–≤–ª–µ–Ω–æ')}await saveFavs(f);if(ROLE==='employer')loadEmpVacs();else loadWrkVacs()}

function toast(m){const t=document.createElement('div');t.className='toast';t.textContent=m;document.body.appendChild(t);setTimeout(()=>t.remove(),2500)}
function timeAgo(iso){const d=Math.floor((new Date()-new Date(iso))/60000);if(d<1)return'—Å–µ–π—á–∞—Å';if(d<60)return d+'–º';if(d<1440)return Math.floor(d/60)+'—á';return Math.floor(d/1440)+'–¥'}
function salStr(a,b,h){let s='';if(a&&b)s=`${parseInt(a).toLocaleString()}‚Äî${parseInt(b).toLocaleString()}‚ÇΩ`;else if(a)s=`–æ—Ç ${parseInt(a).toLocaleString()}‚ÇΩ`;else s='‚Äî';if(h)s+=` | ${h}‚ÇΩ/—á`;return s}
function starsSmall(r,c){return r&&c?`<span style="color:var(--gold);font-weight:700;font-size:12px">‚òÖ${parseFloat(r).toFixed(1)}</span><span style="font-size:11px;color:var(--text3)">(${c})</span>`:''}
async function sendBot(uid,text,kb){try{const body={chat_id:uid,text,parse_mode:'HTML'};if(kb)body.reply_markup=kb;await fetch(`https://api.telegram.org/bot${BOT}/sendMessage`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)})}catch{}}
function compress(file){return new Promise(r=>{const reader=new FileReader();reader.onload=e=>{const img=new Image();img.onload=()=>{const c=document.createElement('canvas');let w=img.width,h=img.height;const max=300;if(w>h){if(w>max){h=h*max/w;w=max}}else{if(h>max){w=w*max/h;h=max}}c.width=w;c.height=h;c.getContext('2d').drawImage(img,0,0,w,h);r(c.toDataURL('image/jpeg',.7))};img.src=e.target.result};reader.readAsDataURL(file)})}
async function getPhoto(id){return new Promise(r=>{const i=document.getElementById(id);if(!i?.files?.[0]){r(null);return}compress(i.files[0]).then(r)})}

function setTheme(t){document.body.className=t==='dark'?'dark':'';document.querySelectorAll('.theme-btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');localStorage.setItem('theme',t)}
function loadTheme(){const t=localStorage.getItem('theme')||'light';if(t==='dark'){document.body.className='dark';document.querySelectorAll('.theme-btn')[1].classList.add('active');document.querySelectorAll('.theme-btn')[0].classList.remove('active')}}

function toggleFilters(t){document.getElementById(t+'Filters').classList.toggle('hidden')}

function hideAll(){['welcomeScreen','employerScreen','workerScreen'].forEach(i=>document.getElementById(i).classList.add('hidden'))}
function goWelcome(){hideAll();document.getElementById('welcomeScreen').classList.remove('hidden');ROLE=null}
async function goRole(r){ROLE=r;hideAll();const bl=await sb('blacklist','bl_'+UID);if(bl?.banned){toast('–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω');goWelcome();return}const prof=r==='employer'?await sb('profiles','emp_'+UID):null;if(r==='employer'&&prof&&prof.moderationStatus==='pending'){toast('–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏');goWelcome();return}if(r==='employer'){document.getElementById('employerScreen').classList.remove('hidden');loadEmpVacs()}else{document.getElementById('workerScreen').classList.remove('hidden');loadWrkVacs()}loadFavs().then(f=>updateFavUI(f))}

function empTab(t,b){document.querySelectorAll('#employerScreen .tab-btn').forEach(x=>x.classList.remove('active'));if(b)b.classList.add('active');['empVacTab','empCandTab','empInTab','empProfTab'].forEach(i=>document.getElementById(i).classList.add('hidden'));if(t==='vac'){document.getElementById('empVacTab').classList.remove('hidden');loadEmpVacs()}else if(t==='cand'){document.getElementById('empCandTab').classList.remove('hidden');loadCands()}else if(t==='in'){document.getElementById('empInTab').classList.remove('hidden');loadIncoming()}else if(t==='prof'){document.getElementById('empProfTab').classList.remove('hidden');loadEmpProf()}}
function wrkTab(t,b){document.querySelectorAll('#workerScreen .tab-btn').forEach(x=>x.classList.remove('active'));if(b)b.classList.add('active');['wrkVacTab','wrkRespTab','wrkProfTab'].forEach(i=>document.getElementById(i).classList.add('hidden'));if(t==='vac'){document.getElementById('wrkVacTab').classList.remove('hidden');loadWrkVacs()}else if(t==='resp'){document.getElementById('wrkRespTab').classList.remove('hidden');loadMyResp()}else{document.getElementById('wrkProfTab').classList.remove('hidden');loadWrkProf()}}

async function loadEmpVacs(){const el=document.getElementById('empVacList');el.innerHTML='<div class="loading"><div class="spin"></div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>';const all=await sbList('vacancies','vac_');const mine=all.filter(v=>v.eid===UID);if(!mine.length){el.innerHTML='<div class="empty"><div class="empty-ico">üìã</div><div class="empty-title">–ù–µ—Ç –≤–∞–∫–∞–Ω—Å–∏–π</div></div>';return}const resp=await sbList('responses','resp_');const favs=await loadFavs();const rats={};for(const v of mine){if(!rats[v.eid]){const r=await sb('ratings','rating_'+v.eid);if(r)rats[v.eid]=r}}el.innerHTML=mine.map(v=>{const rc=resp.filter(r=>r.vid===v.id).length;const rat=rats[v.eid];return`<div class="vcard" onclick="openVac('${v.id}','emp')"><div class="vcard-top"><div class="vcard-head"><div class="vcard-title">${v.specialty}${v.urgent?' üî•':''}</div><button class="vcard-fav" onclick="toggleFav('v','${v.id}',event)">${favs.vacancies.includes(v.id)?'‚ù§Ô∏è':'ü§ç'}</button></div><div class="vcard-company" onclick="event.stopPropagation();openComp('${v.eid}')">${v.companyName||'–ö–æ–º–ø–∞–Ω–∏—è'}${rat?.cnt?starsSmall(rat.avg,rat.cnt):''}</div><div class="vcard-salary">${salStr(v.salFrom,v.salTo,v.hourlyRate)}</div><div class="vcard-tags"><span class="vtag vtag-blue">üìç${v.region}</span><span class="vtag">üìÖ${v.schedule}</span></div></div><div class="vcard-footer"><span>${timeAgo(v.createdAt)}</span><span>üë•${rc} ¬∑ üëÅ${v.views||0}</span></div></div>`}).join('')}

async function loadCands(){const el=document.getElementById('candList');el.innerHTML='<div class="loading"><div class="spin"></div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>';allCands=await sbList('profiles','wrk_');if(!allCands.length){el.innerHTML='<div class="empty"><div class="empty-ico">üë•</div><div class="empty-title">–ù–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤</div></div>';return}const favs=await loadFavs();el.innerHTML=allCands.map(c=>`<div class="vcard" onclick="openCand('${c.uid}')"><div class="vcard-top"><div class="vcard-head"><div class="vcard-title">${c.name}</div><button class="vcard-fav" onclick="toggleFav('c','${c.uid}',event)">${favs.candidates.includes(c.uid)?'‚ù§Ô∏è':'ü§ç'}</button></div><div style="font-size:13px;font-weight:700;color:var(--text2);margin-bottom:6px">${c.specialty}</div><div class="vcard-tags"><span class="vtag vtag-green">üìä${c.experience}–ª</span><span class="vtag vtag-blue">üìç${c.region||'‚Äî'}</span></div></div><div class="vcard-footer"><span>üìû${c.phone}</span></div></div>`).join('')}

async function loadIncoming(){const el=document.getElementById('inList');el.innerHTML='<div class="loading"><div class="spin"></div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>';const resp=await sbList('responses','resp_');const vacs=await sbList('vacancies','vac_');const myVacIds=vacs.filter(v=>v.eid===UID).map(v=>v.id);const mine=resp.filter(r=>myVacIds.includes(r.vid));for(const r of mine){if(!r.viewed){r.viewed=true;await sbSet('responses',r.id,r)}}if(!mine.length){el.innerHTML='<div class="empty"><div class="empty-ico">üì¨</div><div class="empty-title">–û—Ç–∫–ª–∏–∫–æ–≤ –Ω–µ—Ç</div></div>';return}const profs=await sbList('profiles','wrk_');el.innerHTML=mine.map(r=>{const p=profs.find(x=>x.uid===r.wid);const v=vacs.find(x=>x.id===r.vid);if(!p||!v)return'';return`<div class="vcard" onclick="markOpen('${r.id}');openCand('${p.uid}')"><div class="vcard-top"><div class="vcard-title">${p.name}</div><div style="font-size:12px;color:var(--text2)">–û—Ç–∫–ª–∏–∫ –Ω–∞: <b>${v.specialty}</b></div><div class="vcard-tags" style="margin-top:6px">${r.opened?'<span class="vtag vtag-green">üëÄ–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω</span>':'<span class="vtag">üì©–ù–æ–≤—ã–π</span>'}</div></div><div class="vcard-footer"><span>üìû${p.phone}</span><span>${timeAgo(r.createdAt)}</span></div></div>`}).join('')}
async function markOpen(rid){const r=await sb('responses',rid);if(r&&!r.opened){r.opened=true;await sbSet('responses',rid,r)}}

async function loadMyResp(){const el=document.getElementById('respList');el.innerHTML='<div class="loading"><div class="spin"></div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>';const resp=await sbList('responses','resp_');const mine=resp.filter(r=>r.wid===UID);if(!mine.length){el.innerHTML='<div class="empty"><div class="empty-ico">üìù</div><div class="empty-title">–ù–µ—Ç –æ—Ç–∫–ª–∏–∫–æ–≤</div></div>';return}const vacs=await sbList('vacancies','vac_');el.innerHTML=mine.map(r=>{const v=vacs.find(x=>x.id===r.vid);if(!v)return'';return`<div class="vcard" onclick="openVac('${v.id}','wrk')"><div class="vcard-top"><div class="vcard-title">${v.specialty}</div><div class="vcard-company">${v.companyName||'–ö–æ–º–ø–∞–Ω–∏—è'}</div><div class="vcard-tags">${r.opened?'<span class="vtag vtag-green">üëÄ–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω</span>':'<span class="vtag">üì©–û—Ç–ø—Ä–∞–≤–ª–µ–Ω</span>'}</div></div><div class="vcard-footer"><span>${timeAgo(r.createdAt)}</span></div></div>`}).join('')}

async function loadEmpProf(){const el=document.getElementById('empProfView');const p=await sb('profiles','emp_'+UID);if(!p){el.innerHTML='<div class="empty"><div class="empty-ico">üè¢</div><div class="empty-title">–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å</div><button class="btn btn-primary" style="margin:20px" onclick="editEmpProf()">–°–æ–∑–¥–∞—Ç—å</button></div>';return}let badge='';if(p.moderationStatus==='pending')badge='<div style="background:#fef3c7;color:#92400e;padding:8px;border-radius:8px;margin:16px;font-weight:700">‚è≥ –ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</div>';else if(p.moderationStatus==='revision')badge='<div style="background:#fff7ed;color:#c2410c;padding:8px;border-radius:8px;margin:16px;font-weight:700">‚úèÔ∏è –ù–∞ –¥–æ—Ä–∞–±–æ—Ç–∫–µ</div>';el.innerHTML=`<div style="background:linear-gradient(135deg,var(--c1),var(--c2));padding:26px 20px;text-align:center;color:#fff">${p.photo?`<img src="${p.photo}" style="width:70px;height:70px;border-radius:50%;object-fit:cover;margin:0 auto">`:'<div style="width:70px;height:70px;border-radius:50%;background:linear-gradient(135deg,var(--accent),#fb923c);display:flex;align-items:center;justify-content:center;font-size:28px;margin:0 auto">üè¢</div>'}<div style="font-family:Unbounded;font-size:15px;font-weight:700;margin-top:10px">${p.companyName}</div><div style="font-size:12px;opacity:.65">${p.sphere||'–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ'}</div></div>${badge}${p.moderationComment?`<div style="background:#fff7ed;border-left:4px solid #f59e0b;padding:12px;margin:16px;border-radius:8px"><div style="font-weight:700;margin-bottom:4px">üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</div><div style="font-size:13px">${p.moderationComment}</div></div>`:''}<div style="padding:16px"><button class="btn btn-outline" onclick="editEmpProf()">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>${IS_ADMIN?'<button class="btn btn-primary" style="margin-top:10px" onclick="goAdmin()">üõ° –ê–¥–º–∏–Ω</button>':''}</div>`}
async function editEmpProf(){const ex=await sb('profiles','emp_'+UID);openModal(`<div style="font-family:Unbounded;font-size:17px;font-weight:700;margin-bottom:18px">–ü—Ä–æ—Ñ–∏–ª—å –∫–æ–º–ø–∞–Ω–∏–∏</div><form onsubmit="saveEmpProf(event)"><div style="border:2px dashed var(--border);border-radius:12px;padding:20px;text-align:center;cursor:pointer;margin-bottom:16px" onclick="document.getElementById('empPhoto').click()"><img id="empPhotoPrev" style="width:70px;height:70px;border-radius:50%;object-fit:cover;display:${ex?.photo?'block':'none'};margin:0 auto" src="${ex?.photo||''}"><div id="empPhotoPlaceholder" style="${ex?.photo?'display:none':''}">üì∑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</div><input type="file" id="empPhoto" accept="image/*" style="display:none" onchange="prev('empPhoto','empPhotoPrev','empPhotoPlaceholder')"></div><div class="fg"><label>–ù–∞–∑–≤–∞–Ω–∏–µ<span style="color:var(--red)">*</span></label><input type="text" id="epName" value="${ex?.companyName||''}" required></div><div class="fg"><label>–ò–ù–ù<span style="color:var(--red)">*</span></label><input type="text" id="epInn" value="${ex?.inn||''}" required></div><div class="fg"><label>–ê–¥—Ä–µ—Å<span style="color:var(--red)">*</span></label><input type="text" id="epAddr" value="${ex?.address||''}" required></div><div class="fg"><label>–°—Ñ–µ—Ä–∞</label><input type="text" id="epSphere" value="${ex?.sphere||''}"></div><div class="fg"><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input type="tel" id="epPhone" value="${ex?.phone||''}"></div><div class="fg"><label>–û –∫–æ–º–ø–∞–Ω–∏–∏<span style="color:var(--red)">*</span></label><textarea id="epAbout" required>${ex?.about||''}</textarea></div><button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button></form>`)}
function prev(inp,prv,ph){const i=document.getElementById(inp);const f=i.files[0];if(!f)return;const r=new FileReader();r.onload=e=>{const p=document.getElementById(prv);p.src=e.target.result;p.style.display='block';document.getElementById(ph).style.display='none'};r.readAsDataURL(f)}
async function saveEmpProf(e){e.preventDefault();const photo=await getPhoto('empPhoto');const ex=await sb('profiles','emp_'+UID);const needMod=!ex||ex.moderationStatus!=='approved';const p={uid:UID,companyName:document.getElementById('epName').value,inn:document.getElementById('epInn').value,address:document.getElementById('epAddr').value,sphere:document.getElementById('epSphere').value,phone:document.getElementById('epPhone').value,about:document.getElementById('epAbout').value,photo:photo||ex?.photo,moderationStatus:needMod?'pending':'approved',moderationComment:ex?.moderationComment||''};await sbSet('profiles','emp_'+UID,p);if(needMod){const kb={inline_keyboard:[[{text:'‚úÖ–û–¥–æ–±—Ä–∏—Ç—å',callback_data:`approve_${UID}`},{text:'‚úèÔ∏è–î–æ—Ä–∞–±–æ—Ç–∫–∞',callback_data:`revise_${UID}`}]]};await sendBot(ADMIN,`üè¢ –ó–∞—è–≤–∫–∞ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é\n\nüë§${p.companyName}\nüìã${p.inn}\nüìç${p.address}\n\nID:${UID}`,kb);toast('–ù–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏')}else{toast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ‚úÖ')}closeModal();loadEmpProf()}

async function loadWrkVacs(){const el=document.getElementById('vacList');el.innerHTML='<div class="loading"><div class="spin"></div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>';allVacs=await sbList('vacancies','vac_');allVacs=allVacs.filter(v=>v.status!=='closed'&&v.status!=='paused');const myProf=await sb('profiles','wrk_'+UID);if(myProf?.specialty){const mySpec=myProf.specialty;const my=allVacs.filter(v=>v.specialty===mySpec);const other=allVacs.filter(v=>v.specialty!==mySpec);allVacs=[...my,...other]}if(!allVacs.length){el.innerHTML='<div class="empty"><div class="empty-ico">üíº</div><div class="empty-title">–ù–µ—Ç –≤–∞–∫–∞–Ω—Å–∏–π</div></div>';return}const favs=await loadFavs();const rats={};el.innerHTML=(await Promise.all(allVacs.map(async v=>{if(!rats[v.eid]){const r=await sb('ratings','rating_'+v.eid);rats[v.eid]=r||{avg:0,cnt:0}}const rat=rats[v.eid];return`<div class="vcard" onclick="openVac('${v.id}','wrk')"><div class="vcard-top"><div class="vcard-head"><div class="vcard-title">${v.specialty}${v.urgent?' üî•':''}</div><button class="vcard-fav" onclick="toggleFav('v','${v.id}',event)">${favs.vacancies.includes(v.id)?'‚ù§Ô∏è':'ü§ç'}</button></div><div class="vcard-company" onclick="event.stopPropagation();openComp('${v.eid}')">${v.companyName||'–ö–æ–º–ø–∞–Ω–∏—è'}${rat?.cnt?starsSmall(rat.avg,rat.cnt):''}</div><div class="vcard-salary">${salStr(v.salFrom,v.salTo,v.hourlyRate)}</div><div class="vcard-tags"><span class="vtag vtag-blue">üìç${v.region}</span><span class="vtag">üìÖ${v.schedule}</span></div></div><div class="vcard-footer"><span>${timeAgo(v.createdAt)}</span><span>üëÅ${v.views||0}</span></div></div>`}))).join('')}

async function loadWrkProf(){const el=document.getElementById('wrkProfView');const p=await sb('profiles','wrk_'+UID);if(!p){el.innerHTML='<div class="empty"><div class="empty-ico">üë§</div><div class="empty-title">–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å</div><button class="btn btn-primary" style="margin:20px" onclick="editWrkProf()">–°–æ–∑–¥–∞—Ç—å</button></div>';return}el.innerHTML=`<div style="background:linear-gradient(135deg,var(--c1),var(--c2));padding:26px 20px;text-align:center;color:#fff">${p.photo?`<img src="${p.photo}" style="width:70px;height:70px;border-radius:50%;object-fit:cover;margin:0 auto">`:'<div style="width:70px;height:70px;border-radius:50%;background:linear-gradient(135deg,var(--accent),#fb923c);display:flex;align-items:center;justify-content:center;font-size:28px;margin:0 auto">üë∑</div>'}<div style="font-family:Unbounded;font-size:15px;font-weight:700;margin-top:10px">${p.name}</div><div style="font-size:12px;opacity:.65">${p.specialty}</div></div><div style="padding:16px"><button class="btn btn-outline" onclick="editWrkProf()">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button></div>`}
async function editWrkProf(){const ex=await sb('profiles','wrk_'+UID);openModal(`<div style="font-family:Unbounded;font-size:17px;font-weight:700;margin-bottom:18px">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</div><form onsubmit="saveWrkProf(event)"><div style="border:2px dashed var(--border);border-radius:12px;padding:20px;text-align:center;cursor:pointer;margin-bottom:16px" onclick="document.getElementById('wrkPhoto').click()"><img id="wrkPhotoPrev" style="width:70px;height:70px;border-radius:50%;object-fit:cover;display:${ex?.photo?'block':'none'};margin:0 auto" src="${ex?.photo||''}"><div id="wrkPhotoPlaceholder" style="${ex?.photo?'display:none':''}">üì∑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</div><input type="file" id="wrkPhoto" accept="image/*" style="display:none" onchange="prev('wrkPhoto','wrkPhotoPrev','wrkPhotoPlaceholder')"></div><div class="fg"><label>–§–ò–û<span style="color:var(--red)">*</span></label><input type="text" id="wpName" value="${ex?.name||''}" required></div><div class="fg"><label>–¢–µ–ª–µ—Ñ–æ–Ω<span style="color:var(--red)">*</span></label><input type="tel" id="wpPhone" value="${ex?.phone||''}" required></div><div class="fg"><label>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å<span style="color:var(--red)">*</span></label><select id="wpSpec" required>${SPECS.map(s=>`<option value="${s}" ${ex?.specialty===s?'selected':''}>${s}</option>`).join('')}</select></div><div class="fg"><label>–û–ø—ã—Ç (–ª–µ—Ç)<span style="color:var(--red)">*</span></label><input type="number" id="wpExp" value="${ex?.experience||0}" min="0" required></div><div class="fg"><label>–†–µ–≥–∏–æ–Ω<span style="color:var(--red)">*</span></label><select id="wpRegion" required>${REGIONS.map(r=>`<option value="${r}" ${ex?.region===r?'selected':''}>${r}</option>`).join('')}</select></div><div class="fg"><label>Telegram</label><input type="text" id="wpTg" value="${ex?.tg||TG_USER||''}" placeholder="username"></div><div class="fg"><label>–û —Å–µ–±–µ<span style="color:var(--red)">*</span></label><textarea id="wpAbout" required>${ex?.about||''}</textarea></div><button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button></form>`)}
async function saveWrkProf(e){e.preventDefault();const photo=await getPhoto('wrkPhoto');const p={uid:UID,name:document.getElementById('wpName').value,phone:document.getElementById('wpPhone').value,specialty:document.getElementById('wpSpec').value,experience:parseInt(document.getElementById('wpExp').value),region:document.getElementById('wpRegion').value,tg:document.getElementById('wpTg').value,about:document.getElementById('wpAbout').value,photo};await sbSet('profiles','wrk_'+UID,p);toast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ‚úÖ');closeModal();loadWrkProf();if(pendingVac){openVac(pendingVac,'wrk');pendingVac=null}}

async function createVac(){const p=await sb('profiles','emp_'+UID);if(!p||p.moderationStatus!=='approved'){toast('–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å!');empTab('prof',document.querySelectorAll('#employerScreen .tab-btn')[3]);return}openModal(`<div style="font-family:Unbounded;font-size:17px;font-weight:700;margin-bottom:18px">–ù–æ–≤–∞—è –≤–∞–∫–∞–Ω—Å–∏—è</div><form onsubmit="saveVac(event)"><div class="fg"><label>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å<span style="color:var(--red)">*</span></label><select id="vSpec" required>${SPECS.map(s=>`<option value="${s}">${s}</option>`).join('')}</select></div><div class="fg"><label>–û –≤–∞–∫–∞–Ω—Å–∏–∏</label><input type="text" id="vDesc" placeholder="–ö—Ä–∞—Ç–∫–æ"></div><div class="fg" style="display:grid;grid-template-columns:1fr 1fr;gap:10px"><div><label>–ó–ü –æ—Ç<span style="color:var(--red)">*</span></label><input type="number" id="vSalF" required></div><div><label>–ó–ü –¥–æ</label><input type="number" id="vSalT"></div></div><div class="fg"><label>–ß–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ (‚ÇΩ/—á)</label><input type="number" id="vRate"></div><div class="fg"><label>–û–±—ä–µ–∫—Ç<span style="color:var(--red)">*</span></label><input type="text" id="vObj" required></div><div class="fg"><label>–†–µ–≥–∏–æ–Ω<span style="color:var(--red)">*</span></label><select id="vReg" required>${REGIONS.map(r=>`<option value="${r}">${r}</option>`).join('')}</select></div><div class="fg"><label>–ì—Ä–∞—Ñ–∏–∫ –≤–∞—Ö—Ç—ã<span style="color:var(--red)">*</span></label><select id="vSched" required>${SCHEDS.map(s=>`<option value="${s}">${s}</option>`).join('')}</select></div><div style="background:var(--bg);border-radius:10px;padding:14px;margin-bottom:14px"><div style="font-weight:700;margin-bottom:12px">üë§ –ú–µ–Ω–µ–¥–∂–µ—Ä</div><div class="fg"><label>–§–ò–û</label><input type="text" id="vMgrN"></div><div class="fg"><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input type="tel" id="vMgrP"></div><div class="fg"><label>Telegram username</label><input type="text" id="vMgrT" placeholder="–±–µ–∑ @"></div><div class="toggle-row"><span>–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω</span><button type="button" class="toggle" id="vShowP" onclick="this.classList.toggle('on')"></button></div><div class="toggle-row"><span>–†–∞–∑—Ä–µ—à–∏—Ç—å Telegram</span><button type="button" class="toggle" id="vAllowT" onclick="this.classList.toggle('on')"></button></div></div><div class="toggle-row"><span>üî• –°—Ä–æ—á–Ω–∞—è</span><button type="button" class="toggle" id="vUrg" onclick="this.classList.toggle('on')"></button></div><button type="submit" class="btn btn-primary">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button></form>`)}
async function saveVac(e){e.preventDefault();const p=await sb('profiles','emp_'+UID);const id='vac_'+Date.now();const v={id,eid:UID,companyName:p.companyName,specialty:document.getElementById('vSpec').value,shortDesc:document.getElementById('vDesc').value,salFrom:document.getElementById('vSalF').value,salTo:document.getElementById('vSalT').value,hourlyRate:document.getElementById('vRate').value,object:document.getElementById('vObj').value,region:document.getElementById('vReg').value,schedule:document.getElementById('vSched').value,mgrName:document.getElementById('vMgrN').value,mgrPhone:document.getElementById('vMgrP').value,mgrTg:document.getElementById('vMgrT').value,showPhone:document.getElementById('vShowP').classList.contains('on'),allowTg:document.getElementById('vAllowT').classList.contains('on'),urgent:document.getElementById('vUrg').classList.contains('on'),status:'active',views:0,createdAt:new Date().toISOString()};await sbSet('vacancies',id,v);toast('–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ‚úÖ');closeModal();loadEmpVacs()}

async function openVac(vid,from){const v=await sb('vacancies',vid);if(!v)return;v.views=(v.views||0)+1;await sbSet('vacancies',vid,v);const resp=await sbList('responses','resp_');const myResp=resp.find(r=>r.vid===vid&&r.wid===UID);const prof=await sb('profiles','emp_'+v.eid);const rat=await sb('ratings','rating_'+v.eid)||{avg:0,cnt:0};let acts='';if(from==='wrk'){if(myResp){acts='<button class="btn btn-outline" disabled>‚úÖ –û—Ç–∫–ª–∏–∫–Ω—É–ª–∏—Å—å</button>'}else{acts=`<button class="btn btn-primary" onclick="sendResp('${vid}')">üì© –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è</button>`}if(v.mgrPhone&&v.showPhone){acts+=`<div class="btn-row"><a href="tel:${v.mgrPhone}" class="btn btn-green" style="text-decoration:none">üìû${v.mgrName||'–ü–æ–∑–≤–æ–Ω–∏—Ç—å'}</a>${v.allowTg&&v.mgrTg?`<a href="https://t.me/${v.mgrTg}" class="btn btn-blue" style="text-decoration:none">‚úàÔ∏è Telegram</a>`:''}</div>`}}openModal(`<div style="font-family:Unbounded;font-size:16px;font-weight:700;margin-bottom:4px">${v.specialty}${v.urgent?' üî•':''}</div><div style="font-size:13px;color:var(--text2);margin-bottom:12px;font-weight:700;cursor:pointer" onclick="closeModal();openComp('${v.eid}')">${v.companyName||'–ö–æ–º–ø–∞–Ω–∏—è'}${rat.cnt?` ‚òÖ${rat.avg.toFixed(1)} (${rat.cnt})`:''}</div><div style="font-size:22px;font-weight:700;color:var(--green);margin-bottom:14px">${salStr(v.salFrom,v.salTo,v.hourlyRate)}</div><div style="background:var(--bg);border-radius:10px;padding:12px;margin-bottom:14px"><div style="font-size:12px;color:var(--text3);margin-bottom:8px">üìç${v.region} ‚Ä¢ üìÖ${v.schedule} ‚Ä¢ üëÅ${v.views||0}</div></div>${v.shortDesc?`<div style="background:var(--bg);border-radius:10px;padding:12px;margin-bottom:14px"><div style="font-size:13px">${v.shortDesc}</div></div>`:''}${v.mgrName&&v.showPhone?`<div style="background:var(--bg);border-radius:10px;padding:12px;margin-bottom:14px"><div style="font-size:11px;font-weight:700;color:var(--text3);margin-bottom:6px">–ú–ï–ù–ï–î–ñ–ï–†</div><div style="font-size:13px;font-weight:700">${v.mgrName}</div><div style="font-size:13px">üìû ${v.mgrPhone||'‚Äî'}</div></div>`:''}${from==='wrk'?`<div style="margin-bottom:14px"><div style="font-size:11px;font-weight:700;color:var(--text3);margin-bottom:6px">–û–¶–ï–ù–ò–¢–¨</div><div style="display:flex;gap:4px">${[1,2,3,4,5].map(i=>`<span style="font-size:24px;cursor:pointer" onclick="rate('${v.eid}',${i})">‚òÜ</span>`).join('')}</div></div>`:''}${acts}`)}
async function sendResp(vid){const wp=await sb('profiles','wrk_'+UID);if(!wp){pendingVac=vid;toast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å!');closeModal();wrkTab('prof',null);editWrkProf();return}const r={id:'resp_'+Date.now(),vid,wid:UID,viewed:false,opened:false,createdAt:new Date().toISOString()};await sbSet('responses',r.id,r);const v=await sb('vacancies',vid);if(v){const kb={inline_keyboard:[[{text:'üìû–ü–æ–∑–≤–æ–Ω–∏—Ç—å',url:`tel:${wp.phone}`},{text:'‚úàÔ∏èTelegram',url:`https://t.me/${wp.tg||''}`}]]};await sendBot(v.eid,`üîî –ù–æ–≤—ã–π –æ—Ç–∫–ª–∏–∫!\n\nüë∑${wp.name}\nüîß${wp.specialty}\nüìç${wp.region||'‚Äî'}\nüìû${wp.phone}\n\n–í–∞–∫–∞–Ω—Å–∏—è:${v.specialty}`,kb)}toast('–û—Ç–∫–ª–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω‚úÖ');closeModal()}
async function rate(eid,score){let r=await sb('ratings','rating_'+eid)||{avg:0,cnt:0,sum:0,reviews:[]};r.sum=(r.sum||0)+score;r.cnt++;r.avg=r.sum/r.cnt;await sbSet('ratings','rating_'+eid,r);toast(`–û—Ü–µ–Ω–∫–∞ ${score}‚≠ê —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞`)}

async function openCand(uid){const p=await sb('profiles','wrk_'+uid);if(!p)return;openModal(`<div style="font-family:Unbounded;font-size:16px;font-weight:700;margin-bottom:4px">${p.name}</div><div style="font-size:13px;color:var(--text2);margin-bottom:14px;font-weight:700">${p.specialty}</div><div style="background:var(--bg);border-radius:10px;padding:12px;margin-bottom:14px"><div style="font-size:13px">üìû ${p.phone}</div><div style="font-size:13px">üìä ${p.experience} –ª–µ—Ç</div><div style="font-size:13px">üìç ${p.region||'‚Äî'}</div>${p.tg?`<div style="font-size:13px">‚úàÔ∏è @${p.tg}</div>`:''}</div>${p.about?`<div style="background:var(--bg);border-radius:10px;padding:12px;margin-bottom:14px"><div style="font-size:13px">${p.about}</div></div>`:''}<div class="btn-row"><a href="tel:${p.phone}" class="btn btn-green" style="text-decoration:none">üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å</a>${p.tg?`<a href="https://t.me/${p.tg}" class="btn btn-blue" style="text-decoration:none">‚úàÔ∏è Telegram</a>`:''}</div>${ROLE==='employer'?`<button class="btn btn-primary" style="margin-top:10px" onclick="sendOffer('${uid}')">üì© –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>`:''}`);}
async function sendOffer(wid){const wp=await sb('profiles','wrk_'+wid);const ep=await sb('profiles','emp_'+UID);if(!wp||!ep)return;const kb={inline_keyboard:[[{text:'üìû–ü–æ–∑–≤–æ–Ω–∏—Ç—å',url:`tel:${ep.phone||''}`},{text:'‚úàÔ∏èTelegram',url:`https://t.me/${TG_USER||''}`}]]};await sendBot(wid,`üíº –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ!\n\nüè¢${ep.companyName}\nüìû${ep.phone||'‚Äî'}\n\n–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ`,kb);toast('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ‚úÖ');closeModal()}

async function openComp(eid){const p=await sb('profiles','emp_'+eid);if(!p)return;const r=await sb('ratings','rating_'+eid)||{avg:0,cnt:0,reviews:[]};openModal(`<div style="font-family:Unbounded;font-size:16px;font-weight:700;margin-bottom:4px">${p.companyName}</div><div style="font-size:13px;color:var(--text2);margin-bottom:14px">${p.sphere||'–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ'}</div>${r.cnt?`<div style="color:var(--gold);font-size:14px;font-weight:700;margin-bottom:14px">‚òÖ ${r.avg.toFixed(1)} (${r.cnt} –æ—Ç–∑—ã–≤–æ–≤)</div>`:''}<div style="background:var(--bg);border-radius:10px;padding:12px;margin-bottom:14px"><div style="font-size:13px">üìã –ò–ù–ù: ${p.inn||'‚Äî'}</div><div style="font-size:13px">üìç ${p.address||'‚Äî'}</div></div>${p.about?`<div style="background:var(--bg);border-radius:10px;padding:12px;margin-bottom:14px"><div style="font-size:13px">${p.about}</div></div>`:''}${r.reviews?.length?`<div style="margin-bottom:14px"><div style="font-size:11px;font-weight:700;color:var(--text3);margin-bottom:8px">–û–¢–ó–´–í–´</div>${r.reviews.slice(0,5).map(rev=>`<div style="background:var(--bg);border-radius:10px;padding:12px;margin-bottom:8px"><div style="display:flex;justify-content:space-between;margin-bottom:4px"><span style="font-weight:700;font-size:13px">${rev.name}</span><span style="font-size:11px;color:var(--text3)">${timeAgo(rev.date)}</span></div><div style="color:var(--gold);font-size:14px;margin-bottom:4px">${'‚≠ê'.repeat(rev.rating)}</div>${rev.comment?`<div style="font-size:13px">${rev.comment}</div>`:''}</div>`).join('')}</div>`:''}`)}

function showSupport(){openModal(`<div style="font-family:Unbounded;font-size:17px;font-weight:700;margin-bottom:18px">üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞</div><form onsubmit="sendSupport(event)"><div class="fg"><label>–°–æ–æ–±—â–µ–Ω–∏–µ</label><textarea id="suppMsg" required placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É..."></textarea></div><button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button></form>`)}
async function sendSupport(e){e.preventDefault();const msg=document.getElementById('suppMsg').value;await sendBot(ADMIN,`üí¨ –¢–µ—Ö.–ø–æ–¥–¥–µ—Ä–∂–∫–∞\n\n–û—Ç: ${UNAME} (${UID})\n–†–æ–ª—å: ${ROLE||'–≥–æ—Å—Ç—å'}\n\n${msg}`);toast('–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ‚úÖ');closeModal()}

async function openFavs(){const f=await loadFavs();let html='<div style="font-family:Unbounded;font-size:17px;font-weight:700;margin-bottom:18px">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div>';let has=false;if(f.vacancies.length){html+='<div style="font-size:11px;font-weight:700;color:var(--text3);margin:14px 0 8px">–í–ê–ö–ê–ù–°–ò–ò</div>';for(const vid of f.vacancies){const v=await sb('vacancies',vid);if(v){has=true;html+=`<div class="vcard" onclick="closeModal();openVac('${v.id}','${ROLE}')"><div class="vcard-top"><div class="vcard-title">${v.specialty}</div><div class="vcard-company">${v.companyName||'–ö–æ–º–ø–∞–Ω–∏—è'}</div><div class="vcard-salary">${salStr(v.salFrom,v.salTo)}</div></div></div>`}}}if(f.candidates.length&&ROLE==='employer'){html+='<div style="font-size:11px;font-weight:700;color:var(--text3);margin:14px 0 8px">–ö–ê–ù–î–ò–î–ê–¢–´</div>';for(const cid of f.candidates){const c=await sb('profiles','wrk_'+cid);if(c){has=true;html+=`<div class="vcard" onclick="closeModal();openCand('${c.uid}')"><div class="vcard-top"><div class="vcard-title">${c.name}</div><div class="vcard-company">${c.specialty}</div></div></div>`}}}if(!has)html+='<div class="empty"><div class="empty-ico">‚ù§Ô∏è</div><div class="empty-title">–ü—É—Å—Ç–æ</div></div>';openModal(html)}

function openModal(h){let m=document.getElementById('modal');if(!m){m=document.createElement('div');m.id='modal';m.className='modal';m.onclick=e=>{if(e.target===m)closeModal()};document.body.appendChild(m)}m.innerHTML=`<div class="modal-box">${h}</div>`;m.classList.remove('hidden')}
function closeModal(){const m=document.getElementById('modal');if(m)m.classList.add('hidden')}

async function goAdmin(){if(!IS_ADMIN)return;openModal(`<div style="font-family:Unbounded;font-size:17px;font-weight:700;margin-bottom:18px">üõ° –ê–¥–º–∏–Ω</div><div class="fg"><label>ID –≤–∞–∫–∞–Ω—Å–∏–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è</label><input type="text" id="admDelVac"></div><button class="btn btn-danger btn-sm" onclick="admDel('vac')">–£–¥–∞–ª–∏—Ç—å</button><div class="fg" style="margin-top:12px"><label>ID –ø—Ä–æ—Ñ–∏–ª—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è</label><input type="text" id="admDelProf"></div><button class="btn btn-danger btn-sm" onclick="admDel('prof')">–£–¥–∞–ª–∏—Ç—å</button><div class="fg" style="margin-top:12px"><label>ID –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏</label><input type="text" id="admBan"></div><button class="btn btn-danger btn-sm" onclick="admBanUser()">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button><div class="fg" style="margin-top:12px"><textarea id="admMsg" placeholder="–†–∞—Å—Å—ã–ª–∫–∞..."></textarea></div><div class="btn-row"><button class="btn btn-blue btn-sm" onclick="admBroadcast('wrk')">üë∑ –°–æ–∏—Å–∫–∞—Ç–µ–ª—è–º</button><button class="btn btn-primary btn-sm" onclick="admBroadcast('emp')">üëî –†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª—è–º</button></div>`)}
async function admDel(t){const id=t==='vac'?document.getElementById('admDelVac').value:document.getElementById('admDelProf').value;if(!id)return;await sbDel(t==='vac'?'vacancies':'profiles',id);toast('–£–¥–∞–ª–µ–Ω–æ')}
async function admBanUser(){const id=document.getElementById('admBan').value;if(!id)return;await sbSet('blacklist','bl_'+id,{uid:id,banned:true,bannedAt:new Date().toISOString()});await sendBot(id,'‚õî –í—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã');toast('–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω')}
async function admBroadcast(r){const msg=document.getElementById('admMsg').value;if(!msg)return;const profs=await sbList('profiles',r+'_');for(const p of profs){if(p.uid){await sendBot(p.uid,`üì¢ Good_–í–∞—Ö—Ç–∞:\n\n${msg}`);await new Promise(res=>setTimeout(res,100))}}toast(`–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ${profs.length}`)}

document.addEventListener('DOMContentLoaded',()=>{loadTheme();document.getElementById('welcomeScreen').classList.remove('hidden')});
</script>
</body>
</html>
